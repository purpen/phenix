/** # Semantic UI
* Version: 0.15.1
* http://github.com/purpen/semantic-ui
*
*
* Copyright 2014 Contributors
* Released under the MIT license
* http://opensource.org/licenses/MIT
*
* Release Date: 04/29/2014
*/
var phenix={visitor:{},url:{},redirect:function(a,b){setTimeout(function(){window.location=a},b)},show_error_note:function(a,b){phenix.show_notify_bar(a,"error",b)},show_ok_note:function(a,b){phenix.show_notify_bar(a,"ok",b)},show_notify_bar:function(a,b,c){var d;b&&"ok"!=b?(b="error",d="error"):(b="ok",d="success"),$.show_notify_bar({position:"top",removebutton:!0,message:a,time:c,class_name:d,container:"body"})}};phenix.show_error_message=function(a,b){var c='<ul class="list">';$.isArray(a)?$.each(a,function(a,b){c+="<li>"+b+"</li>"}):c+="<li>"+a+"</li>",c+="</ul>",$("<div/>").addClass("ui error message").html(c).prependTo(b)},phenix.show_ok_message=function(a){alert(a)},phenix.before_submit=function(){return $(".ui.submit.button").addClass("loading"),$(".ui.error.message").remove(),!0},phenix.after_submit=function(){return $(".ui.submit.button").removeClass("loading"),!0},phenix.initial=function(){var a=50,b=function(){return window.pageYOffset||document.documentElement.scrollTop};$(window).scroll(function(){var c=b();c>=a?$("header.main").addClass("shrink"):$("header.main").removeClass("shrink")}),$("a.confirm-request").livequery(function(){$(this).click(function(){return confirm("确认执行这个操作吗?")&&$.get($(this).attr("href")),!1})}),$("a.ajax-request").livequery(function(){$(this).click(function(){var a=$(this).attr("href");return phenix.visitor.is_login?($.get(a),!1):(phenix.show_login_box(a),!1)})}),$(".ui.pop").popup(),$(".ui.checkbox").checkbox(),$(".ui.selection.dropdown").dropdown(),$(".ui.dropdown").dropdown(),$(".ui.product.buttons .item").tab(),phenix.showbox()},phenix.show_login_box=function(a){$("#loginbox-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"输入你注册时填写的邮件"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"输入正确的登录密码"},{type:"length[6]",prompt:"登录密码为必须6位以上字符"}]}},{inline:!0,onSuccess:function(b){b.preventDefault(),$(this).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(c){phenix.after_submit(),c.is_error?($(b.target).addClass("error"),phenix.show_error_message(c.message,b.target)):($(".ui.loginbox.modal").modal("hide"),phenix.visitor=c.data,a&&$.get(a))}})}}),$(".ui.loginbox.modal").modal("show")},phenix.showbox=function(){$(".showbox").livequery(function(){$(this).click(function(){var a=this.hash&&this.hash.substr(1);return $("#"+a).toggle(),!1})})},phenix.build_auth_page=function(){$("#login-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"邮件格式不对,请输入您注册时填写的邮件"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"请输入正确的登录密码"},{type:"length[6]",prompt:"登录密码为必须6位以上字符"}]}},{inline:!0,onSuccess:function(a){a.preventDefault(),$(this).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(b){phenix.after_submit(),b.is_error?($(a.target).addClass("error"),phenix.show_error_message(b.message,a.target)):phenix.redirect(b.redirect_url)}})}}),$("#register-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"账户邮件不能为空"},{type:"email",prompt:"账户邮件格式不对"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"请输入正确的登录密码"},{type:"length[6]",prompt:"登录密码必须6位以上字符"}]},password_confirm:{identifier:"password_confirm",rules:[{type:"empty",prompt:"请输入正确的确认密码"},{type:"match[password]",prompt:"两次输入密码不一致"}]},invite_code:{identifier:"invite_code",rules:[{type:"empty",prompt:"请输入邀请码"},{type:"length[24]",prompt:"邀请码无效格式，核对后重试"}]}},{inline:!0,onSuccess:function(a){a.preventDefault(),$(a.target).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(b){phenix.after_submit(),b.is_error?($(a.target).addClass("error"),phenix.show_error_message(b.message,a.target)):phenix.redirect(b.redirect_url)}})}})},phenix.hook_product_topic=function(){$("#topic-form").form({title:{identifier:"title",rules:[{type:"empty",prompt:"标题不能为空"},{type:"maxLength[40]",prompt:"内容不超过40字符"}]},description:{identifier:"description",rules:[{type:"empty",prompt:"评论内容不能为空"},{type:"maxLength[140]",prompt:"评论内容不超过140字符"}]}},{inline:!0,onSuccess:function(a){a.preventDefault(),$(a.target).ajaxSubmit()}})},phenix.hook_comment_page=function(){$("#comment-form").form({content:{identifier:"content",rules:[{type:"empty",prompt:"评论内容不能为空"},{type:"maxLength[140]",prompt:"评论内容不超过140字符"}]}},{inline:!0,onSuccess:function(a){a.preventDefault(),$(a.target).ajaxSubmit()}}).find(".submit.button").ajaxStart(function(){$(".ui.submit.button").addClass("loading")}).ajaxSuccess(function(){$(".ui.submit.button").removeClass("loading")}),$(".ui.reply.form").form({content:{identifier:"content",rules:[{type:"empty",prompt:"评论内容不能为空"},{type:"maxLength[140]",prompt:"评论内容不超过140字符"}]}},{inline:!0,onSuccess:function(a){a.preventDefault(),$(a.target).ajaxSubmit()}})},phenix.rebuild_batch_assets=function(a){var b=$("#batch_assets").val();if(b){var c=b.split(",");-1==$.inArray(a,c)&&(c.push(a),$("#batch_assets").val(c.join(",")))}else $("#batch_assets").val(a)},phenix.bind_share_list=function(){var a=encodeURIComponent(document.location),b=encodeURIComponent(document.title.substring(0,76)),c=encodeURIComponent("网站名称"),d="share",e="http://www.example.com/",f=function(a,b){return["toolbar=0,status=0,resizable=1,width="+a+",height="+b+",left=",(screen.width-a)/2,",top=",(screen.height-b)/2].join("")};$("#sina-share").click(function(){var c="http://v.t.sina.com.cn/share/share.php?url="+a+"&title="+b,e=f(607,523);window.open(c,d,e)}),$("#tencent-share").click(function(){var c="http://v.t.qq.com/share/share.php?title="+b+"&url="+a+"&site="+e,g=f(634,668);window.open(c,d,g)}),$("#douban-share").click(function(){var c="http://www.douban.com/recommend/?url="+a+"&title="+b,e=f(450,350);window.open(c,d,e)}),$("#renren-share").click(function(){var c="http://share.renren.com/share/buttonshare?link="+a+"&title="+b,e=f(626,436);window.open(c,d,e)}),$("#kaixin001-share").click(function(){var c="http://www.kaixin001.com/repaste/share.php?rurl="+a+"&rcontent="+a+"&rtitle="+b,e=f(540,342);window.open(c,d,e)}),$("#netease-share").click(function(){var e="http://t.163.com/article/user/checkLogin.do?link="+a+"source="+c+"&info="+b+" "+a,g=f(642,468);window.open(e,d,g)}),$("#facebook-share").click(function(){var c="http://facebook.com/share.php?u="+a+"&t="+b,e=f(626,436);window.open(c,d,e)}),$("#twitter-share").click(function(){var c="http://twitter.com/share?url="+a+"&text="+b,e=f(500,375);window.open(c,d,e)}),$("#delicious-share").click(function(){var c="http://delicious.com/post?url="+a+"&title="+b,e=f(550,550);window.open(c,d,e)})};var wps_width=0,wps_height=0,wps_ratio=1,scale_width=480,scale_height=0,crop_width=0,crop_height=0;phenix.hook_imgarea_select=function(){scale_height=parseInt(wps_height*scale_width/wps_width),ias=$("img#avatar-photo").imgAreaSelect({aspectRatio:"1:1",x1:0,y1:0,x2:300,y2:300,handles:!0,parent:"#select-area",fadeSpeed:200,instance:!0,onSelectChange:phenix.preview,onSelectEnd:phenix.updateAreaSelect})},phenix.preview=function(a,b){b.width&&b.height&&($("#x1").val(b.x1),$("#y1").val(b.y1),$("#x2").val(b.x2),$("#y2").val(b.y2),$("#w").val(b.width),$("#h").val(b.height))},phenix.updateAreaSelect=function(){},$.extend($.imgAreaSelect.prototype,{animateSelection:function(a,b,c,d,e){var f=$.extend($("<div/>")[0],{ias:this,start:this.getSelection(),end:{x1:a,y1:b,x2:c,y2:d}});$(f).animate({cur:1},{duration:e,step:function(a,b){var c=b.elem.start,d=b.elem.end,e=Math.round(c.x1+(d.x1-c.x1)*a),f=Math.round(c.y1+(d.y1-c.y1)*a),g=Math.round(c.x2+(d.x2-c.x2)*a),h=Math.round(c.y2+(d.y2-c.y2)*a);b.elem.ias.setSelection(e,f,g,h),b.elem.ias.update()}})}}),function(a){a.fn.extend({insertAtCaret:function(b){var c=a(this)[0];if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=b,this.focus();else if(c.selectionStart||"0"==c.selectionStart){var d=c.selectionStart,e=c.selectionEnd,f=c.scrollTop;c.value=c.value.substring(0,d)+b+c.value.substring(e,c.value.length),this.focus(),c.selectionStart=d+b.length,c.selectionEnd=d+b.length,c.scrollTop=f}else this.value+=b,this.focus()}})}(jQuery);