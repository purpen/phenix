{%extends 'layout/column.html'%}

{% block page_css %}
<style type="text/css">
    
</style>
{% endblock %}
{% block jquery %}
	var s = e(window).width();
	e("#fixedslide > .ui.slide > .item").width(s);
	
	var $frame = $('#fixedslide');
	// Call Sly on frame
	$frame.sly({
		horizontal: 1,
		itemNav: 'basic',
		smart: 1,
		activateMiddle: 1,
		activateOn: 'click',
		
		// Automated cycling
		cycleBy: "items",
		cycleInterval: 3500,
		pauseOnHover: 1,
		
		// Dragging
		mouseDragging: 1,
		touchDragging: 1,
		releaseSwing: 1,
		
		prev: "#fixedslide .prev",
		next: "#fixedslide .next",
		
		pagesBar: $frame.find('.pages'),
		pageItem: 'items',
		activatePageOn: 'click',
		pageBuilder: function(index){
			return '<a href="javascript:void(0);">'+ (index + 1) +'</a>';
		},
		
		// Mixed options
		startAt: 0,
		speed: 300,
		elasticBounds: 1,
		easing: 'easeInOutExpo',
		dragHandle: 1,
		dynamicHandle: 1,
		clickBar: 1,
	});
	
	$(window).resize(function() {
		var s=$(window).width();
		e("#fixedslide > .ui.slide > .item").width(s);
		
		$frame.sly('reload');
	});
	
	$('.schedule .count[data-countdown]').each(function() {
		var $this = $(this), finalDate = $(this).data('countdown');
		$this.countdown(finalDate, function(event) {
			$this.html(event.strftime('%-D'));
		});
	});
	$('.vote .timer[data-countdown]').each(function() {
		var $this = $(this), finalDate = $(this).data('countdown');
		$this.countdown(finalDate, function(event) {
			$this.html(event.strftime('<div class="item"><div class="number">%D</div><div class="unit">天</div></div><div class="item"><div class="number">%H</div><div class="unit">时</div></div> <div class="item"><div class="number">%M</div><div class="unit">分</div></div><div class="green item"><div class="number">%S</div><div class="unit">秒</div></div>'));
		});
	});
	
	// 分享按钮
	phenix.bind_share_list();
	
	skrollr.init({
		forceHeight: false,
		mobileCheck:function(){},
		mobileDeceleration:0.004,
	});	
{% endblock %}

{% block content %}

<div id="homepage">
	<div id="fixedslide" class="frame">
		{% ad_list var:'adslide' page:1 size:6 state:2 name:'web_index_slide' %}
		<div class="ui slide">
			{% for ad in adslide.rows %}
			<div class="item">
				<div class="featured-vendor {{ ad.text_align }}" style="background-image: url('{{ ad.cover.fileurl }}'); background-color: {{ ad.bgcolor }};">
					{% if ad.mode == 2 %}
					<div class="overlay">
						{% if ad.cate_title %}
						<h3>{{ ad.cate_title }}</h3>
						{% endif %}
						<h1>{{ ad.title }}</h1>
						<p class="snippet">
							{{ ad.sub_title }}
						</p>
						<a class="ui big inverted button" href="{{ ad.view_url }}" target="_blank">{{ ad.btn_title }}</a>
					</div>
					{% else %}
					<a class="imglink" href="{{ ad.view_url }}" target="_blank"></a>	
					{% endif %}
				</div>
			</div>
			{% endfor %}
		</div>
		<div class="pages"></div>
		<a class="prev" href="#">
			<i class="angle left icon"></i>
		</a>
		<a class="next" href="#">
			<i class="angle right icon"></i>
		</a>
	</div>
    
    <div class="adstick list">
    	<div class="ui adverts responsive grid">
    		<div class="row">
    			<div class="column">
            		{% ad_list var:'adslide2' page:1 size:4 state:2 name:'web_index_product_stick_slide' %}
                    {% if adslide2.rows %}
                    <div class="ui four adverts cards">
                        {% for ad in adslide2.rows %}
                        <div class="card">
                            <div class="advblock">
                                <div class="image" style="background-image: url('{{ ad.cover.fileurl }}');padding:30% 0;">
                                    <a href="{{ ad.view_url }}" title="{{ ad.title }}" target="_blank"></a>
                                </div>
                                <div class="desc">
                                    <h3>
                                        {{ ad.title }}
                                    </h3>
                                    <!--<p>{{ ad.sub_title }}</p>-->
                                </div>
                                <a href="{{ ad.view_url }}" title="{{ ad.title }}" class="link wrap" target="_blank"></a>
                            </div>
                        </div>
                        {%endfor%}
                    </div>
                    {%endif%}
                </div>
            </div>
        </div>
    </div>
    
    <!--精选新品-->
	<section class="ui shoplist block">
    	<div class="ui newest responsive grid">
    		<div class="row">
    			<div class="column">
                    {% product_list var:'newest' page:1 type:5 only_onsale:1 size:8 sort:5 %}
                    {% if newest.rows %}
                    <div class="ui four products cards">
    					{% for product in newest.rows %}
    				  		{% include "block/product_card.html" %}
    				    {% endfor %}
                    </div>
    				{% endif %}
                </div>
            </div>
        </div>
	</section>
    
    <!--社区部分-->
	<div class="ui responsive grid">
		<div class="row">
			<div class="column">  
                <!--社区试用 活动-->
                {% ad_list var:'ads' page:1 size:2 state:2 name:'home_page_activity' %}
                {% if ads.rows %}
                <div class="ui two products cards">
                    {% for ad in ads.rows %}
                        <div class="card special">
                            <div class="problock">
                                <a title="{{ ad.title }}" href="{{ ad.view_url }}" style="background-image: url('{{ ad.cover.fileurl }}');" class="thumb" target="_blank"></a>
                                <h2>
                                    <a href="{{ ad.view_url }}" title="{{ ad.title }}" class="ui line" target="_blank">
                        			    {{ ad.title }}
                        		    </a>
                                </h2>
                                <div class="excerpt">
                                    <p>{{ ad.description }}</p>
                                </div>
                                <div class="cats">
                                    <span class="unit"></span>{{ ad.click_count }}
                                </div>
                                <span class="counter">
                                    <i class="heart icon"></i> 
                                </span>
                            </div>
                            <div class="speblock">
                                <div class="randomcats">
                                    <a class="catlink" href="{{ ad.view_url }}" style="background-image: url('{{ ad.cover.fileurl }}');" target="_blank">
                                        <h2><!--{{ active.title }}--></h2>
                                        <p><!--{{ active.sub_title }}--></p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!--精华话题-->
                {% topic_list var:'topics' published:1 type:2 page:1 size:4 %}
                <div class="ui socialstick stickcount four blocks">
            		{% for topic in topics.rows %}
                    <div class="block">
            			<div class="image" {% if topic.cover %}style="background-image: url('{{ topic.cover.thumbnails.hm.view_url }}');"{% endif %}>
                            <a class="transparent" href="{{ topic.view_url }}" target="_blank">
            					<div class="sub title">
            						<h3>{{ topic.short_title }}</h3>
            						<div class="extra count">
            							<i class="unhide icon"></i> <span>{{ topic.view_count }}</span> <i class="comments outline icon"></i> <span>{{ topic.comment_count }}</span>
            						</div>
            					</div>
                            </a>
            			</div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="ui four products topics cards">
                    <div class="card stick">
                        {% ad_list var:'ads' page:1 size:2 state:2 name:'home_page_topic' %}                        
                        <div class="ui socialstick one blocks">
                            {% for ad in ads.rows %}
                            <div class="block">
                    			<div class="image" {% if ad.cover %}style="background-image: url('{{ ad.cover.fileurl }}');"{% endif %}>
                                    <a class="transparent" href="{{ ad.view_url }}" target="_blank">
                    					<div class="sub title">
                    						<h3>{{ ad.title }}</h3>
                    					</div>
                                    </a>
                    			</div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="card group">
                        <!--推荐话题-->
                        {% topic_list var:'topics' published:1 sort:1 type:1 page:1 size:10 %}
                        <div class="problock">
        					{% for topic in topics.rows %}
        						{% if topic.published %}
                                    <div class="topicbox {% if loop.counter == 5 %}noborder{% endif %}">
                						{% if topic.cover %}
                                        <a href="{{ topic.view_url }}" title="{{ topic.title }}" class="ui cover line" target="_blank">
                						    <img class="ui image" src="{{ topic.cover.thumbnails.tiny.view_url }}" />
                                        </a>
                						{% endif %}
                                        <h2>
                                            <a href="{{ topic.view_url }}" title="{{ topic.title }}" class="ui line" target="_blank">
                                			    {{ topic.title|truncate, 32, '' }}
                                		    </a>
                                        </h2>
                    					<p class="description">
                    						{{ topic.strip_description|truncate 90 }}
                    					</p>
                        
                        				<p class="author">
                                            <i class="unhide icon"></i> <span>{{ topic.view_count }}</span> <i class="comments outline icon"></i> <span>{{ topic.comment_count }}</span>
                        				</p>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <div class="resultbox">
                    <a href="{{ app_url_topic }}" class="ui magenta inverted more button">
                       <i class="search icon"></i> 查看更多话题 
                    </a>
                </div>
                
                
            </div>
        </div>
    </div>
    
	
</div>
{% endblock %}
