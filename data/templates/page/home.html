{%extends 'layout/column.html'%}

{% block page_css %}
<style type="text/css">
    .fixed.button{
      display:none !important;
    }
</style>
{% endblock %}
{% block jquery %}
	var s = e(window).width();
	e("#fixedslide > .ui.slide > .item").width(s);
	
	var $frame = $('#fixedslide');
	// Call Sly on frame
	$frame.sly({
		horizontal: 1,
		itemNav: 'basic',
		smart: 1,
		activateMiddle: 1,
		activateOn: 'click',
		
		// Automated cycling
		cycleBy: "items",
		cycleInterval: 3500,
		pauseOnHover: 1,
		
		// Dragging
		mouseDragging: 1,
		touchDragging: 1,
		releaseSwing: 1,
		
		prev: "#fixedslide .prev",
		next: "#fixedslide .next",
		
		pagesBar: $frame.find('.pages'),
		pageItem: 'items',
		activatePageOn: 'click',
		pageBuilder: function(index){
			return '<a href="javascript:void(0);">'+ (index + 1) +'</a>';
		},
		
		// Mixed options
		startAt: 0,
		speed: 300,
		elasticBounds: 1,
		easing: 'easeInOutExpo',
		dragHandle: 1,
		dynamicHandle: 1,
		clickBar: 1,
	});
	
	$(window).resize(function() {
		var s=$(window).width();
		e("#fixedslide > .ui.slide > .item").width(s);
		
		$frame.sly('reload');
	});
	
	$('.schedule .count[data-countdown]').each(function() {
		var $this = $(this), finalDate = $(this).data('countdown');
		$this.countdown(finalDate, function(event) {
			$this.html(event.strftime('%-D'));
		});
	});
	$('.vote .timer[data-countdown]').each(function() {
		var $this = $(this), finalDate = $(this).data('countdown');
		$this.countdown(finalDate, function(event) {
			$this.html(event.strftime('<div class="item"><div class="number">%D</div><div class="unit">天</div></div><div class="item"><div class="number">%H</div><div class="unit">时</div></div> <div class="item"><div class="number">%M</div><div class="unit">分</div></div><div class="green item"><div class="number">%S</div><div class="unit">秒</div></div>'));
		});
	});
	
	skrollr.init({
		forceHeight: false,
		mobileCheck:function(){},
		mobileDeceleration:0.004,
	});	

		// 验证是否登录
		if (phenix.visitor.is_login){
      // 分享按钮
      // 链接，标题，网站名称，子窗口别称，网站链接
      var link = "{{ app_url_domain }}?user_invite_code={{ user_invite_code }}";
      var title = '我已成功注册跻身太火鸟英雄汇，这里林子好大，小伙伴们快来哇，成功邀请好友还有红包领取，快来注册并邀请身边好友吧！你们靠谱，我的红包也鼓~~';
      var source = encodeURIComponent('太火鸟'), windowName = 'tShare', site = 'http://www.taihuoniao.com/';
      var pic_url = '{{ app_url_packaged }}/images/promo/eginshare.jpg';
      var getParamsOfShareWindow = function(width, height) {
        return ['toolbar=0,status=0,resizable=1,width=' + width + ',height=' + height + ',left=',(screen.width-width)/2,',top=',(screen.height-height)/2].join('');
      }
      
      $('#wechat-share,#wechat-share-1').click(function() {
        $('.ui.qrcode.modal').modal('show');
        return false;
      });
      
      $('#sina-share,#sina-share-1').click(function() {
        var url = 'http://v.t.sina.com.cn/share/share.php?url=' + link + '&title=' + title + '&pic=' + pic_url;
        var params = getParamsOfShareWindow(607, 523);
        window.open(url, windowName, params);
        return false;
      });
      // 同一个页面出现2个
      $('#o-share-weibo').click(function() {
        var url = 'http://v.t.sina.com.cn/share/share.php?url=' + link + '&title=' + title + '&pic=' + pic_url;
        var params = getParamsOfShareWindow(607, 523);
        window.open(url, windowName, params);
        return false;
      });
      $('#tencent-share,#tencent-share-1').click(function() {
        var url = 'http://v.t.qq.com/share/share.php?title=' + title + '&url=' + link + '&site=' + site + '&pic=' + pic_url;
        var params = getParamsOfShareWindow(634, 668);
        window.open(url, windowName, params);
        return false;
      });
      $('#douban-share').click(function() {
        var url = 'http://www.douban.com/recommend/?url=' + link + '&title=' + title + '&pic=' + pic_url;
        var params = getParamsOfShareWindow(450, 350);
        window.open(url, windowName, params);
        return false;
      });
      $('#renren-share,#renren-share-1').click(function() {
        var url = 'http://share.renren.com/share/buttonshare?link=' + link + '&title=' + title + '&pic=' + pic_url;
        var params = getParamsOfShareWindow(626, 436);
        window.open(url, windowName, params);
        return false;
      });
      $('#kaixin001-share').click(function() {
        var url = 'http://www.kaixin001.com/repaste/share.php?rurl=' + link + '&rcontent=' + link + '&rtitle=' + title + '&pic=' + pic_url;
        var params = getParamsOfShareWindow(540, 342);
        window.open(url, windowName, params);
        return false;
      });








      // 生成二维码
      $('#qrcode').qrcode({width: 256, height: 256, text: '{{ app_url_wap }}/promo/request?user_id='+phenix.visitor.id});
		}

{% endblock %}

{% block content %}

<div id="homepage">
	<div id="fixedslide" class="frame">
        {% cache cache_key:'web_index_slide' ttl:600 disable_cache:app_disable_cached %}
        
		{% ad_list var:'adslide' page:1 size:6 state:2 name:'web_index_slide' %}
		<div class="ui slide">
			{% for ad in adslide.rows %}
			<div class="item">
				<div class="featured-vendor {{ ad.text_align }}" style="background-image: url('{{ ad.cover.fileurl }}'); background-color: {{ ad.bgcolor }};">
					{% if ad.mode == 2 %}
					<div class="overlay">
						{% if ad.cate_title %}
						<h3>{{ ad.cate_title }}</h3>
						{% endif %}
						<h1>{{ ad.title }}</h1>
						<p class="snippet">
							{{ ad.sub_title }}
						</p>
						<a class="ui big inverted button" href="{{ ad.view_url }}" target="_blank">{{ ad.btn_title }}</a>
					</div>
					{% else %}
					<a class="imglink" href="{{ ad.view_url }}" target="_blank"></a>	
					{% endif %}
				</div>
			</div>
			{% endfor %}
		</div>
		<div class="pages"></div>
		<a class="prev" href="#">
			<i class="angle left icon"></i>
		</a>
		<a class="next" href="#">
			<i class="angle right icon"></i>
		</a>
        
        {% endcache %}
	</div>
    
    <div class="adstick list">
    	<div class="ui adverts responsive grid">
    		<div class="row">
    			<div class="column">
                    {% cache cache_key:'web_index_product_stick_slide' ttl:600 disable_cache:app_disable_cached %}
                    
            		{% ad_list var:'adslide2' page:1 size:4 state:2 name:'web_index_product_stick_slide' %}
                    {% if adslide2.rows %}
                    <div class="ui four adverts cards">
                        {% for ad in adslide2.rows %}
                        <div class="card">
                            <div class="advblock">
                                <div class="image" style="background-image: url('{{ ad.cover.fileurl }}');padding:30% 0;">
                                    <a href="{{ ad.view_url }}" title="{{ ad.title }}" target="_blank"></a>
                                </div>
                                <div class="desc">
                                    <h4>
                                        {{ ad.title }}
                                    </h4>
                                    <!--<p>{{ ad.sub_title }}</p>-->
                                </div>
                                <a href="{{ ad.view_url }}" title="{{ ad.title }}" class="link wrap" target="_blank"></a>
                            </div>
                        </div>
                        {%endfor%}
                    </div>
                    {%endif%}
                    
                    {% endcache %}
                </div>
            </div>
        </div>
    </div>
    
    <!--精选新品-->
	<section class="ui shoplist block">
    	<div class="ui newest responsive grid">
    		<div class="row">
    			<div class="column">
                    {% cache cache_key:'web_index_newest_product' ttl:180 disable_cache:app_disable_cached %}
                    
                    {% product_list var:'newest' page:1 type:5 only_onsale:1 size:8 sort:5 %}
                    {% if newest.rows %}
                    <div class="ui four products cards">
    					{% for product in newest.rows %}
    				  		{% include "block/product_card.html" %}
    				    {% endfor %}
                    </div>
    				{% endif %}
                    
                    {% endcache %}
                </div>
            </div>
        </div>
	</section>
    
    <!--社区部分-->
	<div class="ui responsive grid">
		<div class="row">
			<div class="column">  
                {% cache cache_key:'home_page_activity' ttl:600 disable_cache:app_disable_cached %}
                
                <!--社区试用 活动-->
                {% ad_list var:'ads' page:1 size:2 state:2 name:'home_page_activity' %}
                {% if ads.rows %}
                <div class="ui two products cards">
                    {% for ad in ads.rows %}
                        <div class="card special">
                            <div class="problock">
                                <a title="{{ ad.title }}" href="{{ ad.view_url }}" style="background-image: url('{{ ad.cover.fileurl }}');" class="thumb" target="_blank"></a>
                                <h2>
                                    <a href="{{ ad.view_url }}" title="{{ ad.title }}" class="ui line" target="_blank">
                        			    {{ ad.title }}
                        		    </a>
                                </h2>
                                <div class="excerpt">
                                    <p>{{ ad.description }}</p>
                                </div>
                                <div class="cats">
                                    <span class="unit"></span>{{ ad.click_count }}
                                </div>
                                <span class="counter">
                                    <i class="heart icon"></i> 
                                </span>
                            </div>
                            <div class="speblock">
                                <div class="randomcats">
                                    <a class="catlink" href="{{ ad.view_url }}" style="background-image: url('{{ ad.cover.fileurl }}');" target="_blank">
                                        <h2><!--{{ active.title }}--></h2>
                                        <p><!--{{ active.sub_title }}--></p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                {% endcache %}
                
                <!--精华话题-->
                {% cache cache_key:'web_index_fine_topics' ttl:300 disable_cache:app_disable_cached %}
                
                {% topic_list var:'topics' published:1 type:2 page:1 size:4 %}
                <div class="ui socialstick stickcount four blocks">
            		{% for topic in topics.rows %}
                    <div class="block">
            			<div class="image" {% if topic.cover %}style="background-image: url('{{ topic.cover.thumbnails.hm.view_url }}');"{% endif %}>
                            <a class="transparent" href="{{ topic.view_url }}" target="_blank">
            					<div class="sub title">
            						<h3>{{ topic.short_title }}</h3>
            						<div class="extra count">
            							<i class="unhide icon"></i> <span>{{ topic.view_count }}</span> <i class="comments outline icon"></i> <span>{{ topic.comment_count }}</span>
            						</div>
            					</div>
                            </a>
            			</div>
                    </div>
                    {% endfor %}
                </div>
                
                {% endcache %}
                
                <div class="ui four products topics cards">
                    <div class="card stick">
                        {% cache cache_key:'home_page_topic' ttl:600 disable_cache:app_disable_cached %}
                        
                        {% ad_list var:'ads' page:1 size:3 state:2 name:'home_page_topic' %}                        
                        <div class="ui socialstick one blocks">
                            {% for ad in ads.rows %}
                            <div class="block">
                    			<div class="image" {% if ad.cover %}style="background-image: url('{{ ad.cover.fileurl }}');height:220px;"{% endif %}>
                                    <a class="transparent" href="{{ ad.view_url }}" target="_blank">
                    					<div class="sub title">
                    						<h3>{{ ad.title }}</h3>
                    					</div>
                                    </a>
                    			</div>
                            </div>
                            {% endfor %}

                        </div>
                        
                        {% endcache %}
                    </div>
                    <div class="card group">
                        {% cache cache_key:'web_index_stick_topics' ttl:180 disable_cache:app_disable_cached %}
                        
                        <!--推荐话题-->
                        {% topic_list var:'topics' published:1 sort:1 type:1 page:1 size:10 %}
                        <div class="problock">
        					{% for topic in topics.rows %}
        						{% if topic.published %}
                                    <div class="topicbox {% if loop.counter == 9 %}noborder{% endif %}">
                						{% if topic.cover %}
                                        <a href="{{ topic.view_url }}" title="{{ topic.title }}" class="ui cover line" target="_blank">
                						    <img class="ui image" src="{{ topic.cover.thumbnails.tiny.view_url }}" alt="{{ topic.title }}--太火鸟智能硬件社区"/>
                                        </a>
                						{% endif %}
                                        <h2>
                                            <a href="{{ topic.view_url }}" title="{{ topic.title }}" class="ui line" target="_blank">
                                			    {{ topic.title|truncate, 32, '' }}
                                		    </a>
                                        </h2>
                    					<p class="description">
                    						{{ topic.strip_description|truncate 90 }}
                    					</p>
                        
                        				<p class="author">
                                            <i class="unhide icon"></i> <span>{{ topic.view_count }}</span> <i class="comments outline icon"></i> <span>{{ topic.comment_count }}</span>
                        				</p>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        {% endcache %}
                        
                        <div class="resultbox">
                            <a href="{{ app_url_topic }}" class="ui magenta inverted large more button">
                               <i class="search icon"></i> 查看更多话题 
                            </a>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
	  
</div>
{% endblock %}
