{%extends 'layout/column.html'%}
{% block title %}{% endblock %}
{% block page_css %}
<style type="text/css">
    #subject {
        margin-bottom: 3rem;
    }
</style>
{% endblock %}

{% block jquery %}
	phenix.hook_product_topic();
	
	$('[data-countdown]').each(function() {
		var $this = $(this), finalDate = $(this).data('countdown');
		$this.countdown(finalDate, function(event) {
			$this.html(event.strftime('<div class="item"><div class="count">%D<span>天</span></div></div><div class="item"><div class="count">%H<span>时</span></div></div> <div class="item"><div class="count">%M<span>分</span></div></div><div class="magenta item"><div class="count">%S<span>秒</span></div></div>'));
		});
	});
{% endblock %}

{% block content %}
<div id="subject" class="ui social">
	<div class="ui responsive grid">
        
		<div class="middle aligned row">
			<div class="eleven wide column">
				<div class="ui medium breadcrumb">
				  	<a class="ui section link" href="{{ app_url_social }}">
						<i class="basic icon community"></i> 发现
					</a>
                    <i class="angle right icon divider"></i>
				  	<a class="ui section link" href="{{ app_url_topic }}">
						话题
					</a>
				  	<i class="angle right icon divider"></i>
				  	<a class="ui section link" href="{{ app_url_topic }}/c{{ parent_category._id }}">{{ parent_category.title }}</a>
				  	<i class="angle right icon divider"></i>
				  	<a class="ui section link" href="{{ app_url_topic }}/c{{ subject_category._id }}">{{ subject_category.title }}</a>
				  	<i class="angle right icon divider"></i>
				  	{{ product.title }}
				</div>
			</div>
			<div class="five wide right aligned column">
				<a href="{{ app_url_action_base }}/topic/submit?cid={{ subject_category._id }}" class="ui gray inverted button">
					<i class="edit icon"></i> 发表新话题
				</a>
			</div>
		</div>
		
		<div class="row">
			<div class="column">
				<div class="ui segment">
					<h3 class="ui dividing header">
						所属产品
					</h3>
					<div class="ui grid">
						<div class="row">
							<div class="two wide column">
								<a href="{{ product.view_url }}" title="{{ product.title }}">
						      		<img src="{{ product.cover.thumbnails.tiny.view_url }}" class="ui image" />
								</a>
							</div>
							<div class="eight wide column">
						      	<h4 class="ui header">
								  	<div class="content">
										<a href="{{ product.view_url }}" title="{{ product.title }}" class="ui line">
											{{ product.title }}
										</a>
										<div class="sub header">
											<label>设计师：</label> <a href="{{ product.designer.home_url }}" class="ui link" target="_blank">{{ product.designer.nickname|default '太火鸟' }}</a>
										</div>
								  	</div>
								</h4>
								<p class="summary">
									{{ product.summary }}
								</p>
							</div>
							{% if product.approved %}
								{% if product.stage == 1%}
								<div class="six wide column">
									<div class="ui danger message">
										<div class="ui header">
											<div class="picicon">
												<i class="thumbs up outline icon"></i>
											</div>
											<div class="content">
												投票截止时间
												<div class="sub header">
														<div class="ui divided horizontal timer list" data-countdown="{{ product.voted_finish_time|date 'Y/m/d H:i:s' }}"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								{% endif %}
							{% endif %}
						</div>
					</div>
					
				</div>
			</div>
		</div>
		
		<div class="row">
			<div class="column">
				<h3 class="ui header">
					话题列表
				</h3>
				{% topic_list var:'list' page:page target_id:id %}
				<div class="ui segment">
					<table class="ui basic sortable topic table">
						<thead>
							<tr>
								<th>发布者</th>
								<th>主题</th>
								<th>最后回应</th>
								<th>浏览数</th>
							</tr>
						</thead>
						<tbody class="ui topic list">
							{% for topic in list.rows %}
								<!-- 判断话题是否可以显示 -->
								{% if topic.published %}
									{% include "block/topic_item.html" %}
								{% endif %}
							{% endfor %}
						</tbody>
					</table>
				</div>
				<a name="newtopic"></a>
				
				{% if list.total_rows %}
				<div class="ui pagination">
					{% pager url:pager_url,total_rows:list.total_rows,total_page:list.total_page,current_page:page,var:'pager',pager_size:9 %}
					{%include 'block/pager.html'%}
				</div>
				{% endif %}
				
				<div class="ui big reply segment">
					<div class="post comment">
						<h3 class="ui header">发表新话题</h3>
				
						<form class="ui reply form" action="{{ app_url_topic }}/ajax_save" method="post" id="topic-form">
							<input type="hidden" name="_id" />
							<input type="hidden" name="target_id" value="{{ id }}" />
							<input type="hidden" name="type" value="1" />
                            {% if evaluating %}
							<input type="hidden" name="evaluating" value="1" />
                            {%endif%}
							
							<div class="field">
                                <label>标题</label>
								<input type="text" name="title" class="topic title" />
							</div>
							<div class="field">
                                <label>描述</label>
								<textarea name="description" class="small topic content"></textarea>
							</div>
							<div class="right aligned column">
								<input type="submit" class="ui twopad magenta inverted button" value="确认提交" />
							</div>
					
						</form>
					</div>
				</div>
				
			</div>
			
		</div>
	</div>
</div>
{% endblock %}
