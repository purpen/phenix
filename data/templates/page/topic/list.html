{%extends 'layout/column.html'%}
{% block title %}{{ current_category.title }}-{% endblock %}
{% block page_css %}
<style type="text/css">
	
</style>
{% endblock %}

{% block jquery %}
	
{% endblock %}

{% block content %}
<div class="shop submenu">
	<div class="ui responsive grid">
		<div class="row">
			<div class="column">
				{%include 'block/find_nav.html'%}
			</div>
		</div>
	</div>
</div>

<div class="topics catemenu masthead" style="background-image:url('{{ app_url_packaged }}/images/topicbg/tp-{%if is_top%}{{ current_category.name }}{%else%}{{ parent_category.name }}{%endif%}.jpg');">
	<div class="ui responsive grid">
		<div class="row">
			<div class="twelve wide column">
				{% if is_top %}
					<h1 class="block title">
						<a href="{{ app_url_topic }}/c{{current_category._id}}" class="active cate">
							{{ current_category.title }}
						</a>
					</h1>
					{% category_list var:'category' only_open:1 domain:domain pid:cid current:cid %}
				{% else %}
					<h1 class="block title">
						<a href="{{ app_url_topic }}/c{{parent_category._id}}" class="cate">
							{{ parent_category.title }}
						</a>
					</h1>
					{% category_list var:'category' only_open:1 domain:domain pid:parent_category._id current:cid %}
				{% endif %}
				<p>{{ current_category.summary }}</p>
				<hr>
			</div>
			<div class="right aligned four wide column">
				<div class="stast">
					<div class="ui horizontal bulleted list">
						<span class="item">话题</span>
						<span class="item">
							{{ current_category.total_count|default 0 }} 
						</span>
					</div>
					<span class="space"> / </span>
					<div class="ui horizontal bulleted list">
						<span class="item">回帖</span>
						<span class="item">
							{{ current_category.reply_count|default 0 }} 
						</span>
					</div>
				</div>
				
				{% if visitor.is_login %}
					<a href="{{ app_url_topic }}/submit?cid={{ cid }}" class="ui inverted button" target="_blank">
						<i class="edit icon"></i>发表新话题
					</a>
				{% else %}
					<a href="{{ app_url_login }}" class="ui inverted pop button" data-content="先登录后，可发表话题" target="_blank">
						发表新话题
					</a>
				{% endif %}
			</div>
		</div>
		<div class="row">
			<div class="column">
				<div class="children">
					{% for cate in category.rows %}
						<a href="{{ cate.view_url }}" class="ui inverted white {{ cate.active }} button">
							<i class="flat s_{{ cate.name }} icon"></i> {{ cate.title }}
						</a>
					{% endfor %}
				</div>
			</div>
		</div>
	</div>
</div>

<div class="social sortby actions">
	<div class="ui responsive grid">
		<div class="row">
			<div class="column">
				<div class="ui horizontal bulleted list">
				  <a class="ui link {{ css_type_fine }} item" href="{{ links.fine_url }}">
				    精华
				  </a>
				  <a class="ui link {{ css_type_stick }} item" href="{{ links.stick_url }}">
				    推荐
				  </a>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="ui social page" id="topiclist">
	<div class="ui responsive grid">
		<div class="row">
			<div class="column">
				<div class="ui segment hide" id="advanced-filter-topic">
					<div class="ui grid">
						<div class="row">
							<div class="sixteen wide column">
								<div class="ui horizontal list">
									<label class="item">类别：</label>
								  	<a class="ui {{ css_type_stick }} item link" href="{{ links.stick_url }}">推荐</a>
								  	<a class="ui {{ css_type_fine }} item link" href="{{ links.fine_url }}">精华</a>
								</div>
							</div>
							<div class="sixteen wide column">
								<div class="ui horizontal list"> 
									<label class="item">时间：</label>
								  	<a class="ui {{ css_time_all }} item link" href="{{ links.time_all_url }}">全部</a>
								  	<a class="ui {{ css_time_day }} item link" href="{{ links.time_day_url }}">一天之内</a>
								  	<a class="ui {{ css_time_week }} item link" href="{{ links.time_week_url }}">一周之内</a>
									<a class="ui {{ css_time_mouth }} item link" href="{{ links.time_mouth_url }}">一个月内</a>
									<a class="ui {{ css_time_year }} item link" href="{{ links.time_year_url }}">近一年内</a>
								</div>
							</div>
							<div class="sixteen wide column">
								<div class="ui horizontal list">
									<label class="item">排序：</label>
								  	<a class="ui {{ css_sort_default }} item link" href="{{ links.sort_default_url }}">默认</a>
								  	<a class="ui {{ css_sort_update }} item link" href="{{ links.sort_updated_url }}">发帖时间</a>
								  	<a class="ui {{ css_sort_comment }} item link" href="{{ links.sort_comment_url }}">回复最多</a>
									<a class="ui {{ css_sort_favorite }} item link" href="{{ links.sort_favorite_url }}">收藏最多</a>
									<a class="ui {{ css_sort_love }} item link" href="{{ links.sort_laud_url }}">最赞主题</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			
				<div class="ui stacked segment">
					<table class="ui basic topic table">
						<thead>
							<tr>
								<th>发布者</th>
								<th>主题</th>
								<th>最后回应</th>
								<th class="center aligned">浏览数</th>
							</tr>
						</thead>
						<tbody>
						{% if dig_list %}
							{% for dig in dig_list %}
								{% if dig %}
								<tr>
									<td class="hide-on-mobile author">
										<a class="ui small avatar image" href="{{ dig.user.home_url }}">
								      		<img src="{{ dig.user.small_avatar_url }}" alt="{{ dig.user.nickname }}" />
										</a>
									</td>
									<td class="nine wide">
								      	<h3 class="title">
											<a href="{{ dig.view_url }}" title="{{ dig.title }}" class="ui line"><i class="basic pin icon"></i>{{ dig.title|truncate 60 }}</a>
										</h3>
								      	<div class="content">
											<div class="attribute">
												<span class="category"><a href="{{ dig.category.view_url }}" class="ui link">{{ dig.category.title }}</a></span> | 
												<span class="author">
													<a href="{{ dig.user.home_url }}" class="ui link">@{{ dig.user.nickname }}</a>  <i class="time icon"></i>于{{ dig.created_on|relative_datetime }}发表
												</span>
											</div>
											{% if !dig.asset_count %}
												<div class="description">
													{{ dig.strip_description|truncate 70 }}
												</div>
											{% else %}
												{% asset_list var:'assets' parent_id:dig._id size:6 asset_type:55 sort:'positive' %}
												<!--展示图片-->
												<div class="ui mini images">
													{% if dig.cover %}
													<img class="ui image" src="{{ dig.cover.thumbnails.tiny.view_url }}" />
													{% endif %}
													{% for asset in assets.rows %}
														{% if dig.cover._id != asset._id %}
													  	<img class="ui image" src="{{ asset.thumbnails.tiny.view_url }}" />
														{% endif %}
													{% endfor %}
												</div>
											{% endif %}
								      	</div>
									</td>
									<td class="hide-on-mobile four wide">
										{% if dig.last_user %}
										<a class="ui link" href="{{ dig.last_user.home_url }}" title="{{ dig.last_user.nickname }}">
									  		<img src="{{ dig.last_user.mini_avatar_url }}" class="ui avatar image" alt="{{ dig.last_user.nickname }}" />
										</a>
										回复于{{ dig.last_reply_time|relative_datetime }}
										{% endif %}
									</td>
									<td class="hide-on-mobile two wide center aligned">
										<a href="{{ dig.view_url }}#comment" class="dot-irecommend">
											<span class="dot-irecommend-count">{{ dig.view_count }}</span> 
											<span class="dot-irecommend-suffix"></span>
										</a>
									</td>
								</tr>
								{% endif %}
							{% endfor %}
						{% endif %}
					
						{% topic_list var:'list' category_id:category_id is_top:is_top type:type time:time sort:sort page:page %}
						{% for topic in list.rows %}
							{% if !topic.top %}<!--过滤置顶帖子-->
								{% include "block/topic_item.html" %}
							{% endif %}
						{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="column">
				{% if list.total_page > 1 %}
				<div class="ui pagination">
					{% pager url:pager_url,total_rows:list.total_rows,total_page:list.total_page,current_page:page,var:'pager',pager_size:9 %}
					{% include 'block/pager.html' %}
				</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>

<div class="section breadcrumb">
	<div class="ui responsive grid">
		<div class="row">
			<div class="column">
				<div class="ui medium breadcrumb">
				  	<a class="ui section link" href="{{ app_url_domin }}">
						<i class="home icon"></i> 首页
					</a>
                    <i class="angle right icon divider"></i>
				  	<a class="ui section link" href="{{ app_url_social }}">
						发现
					</a>
					<i class="angle right icon divider"></i>
				  	<a class="ui section link" href="{{ app_url_topic }}">
						话题
					</a>
				  	<i class="angle right icon divider"></i>
					{% if !is_top %}
				  	<a class="ui section link" href="{{ app_url_topic }}/c{{ parent_category._id }}">{{ parent_category.title }}</a>
				  	<i class="angle right icon divider"></i>
					{% endif %}
					<div class="active section">{{ current_category.title }}</div>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock %}