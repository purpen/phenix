{%extends 'layout/sns.html'%}
{% block title %}创新想法-{% endblock %}
{% block page_css %}
<style type="text/css">
	.ui.tophead {
	    background: url("{{ app_url_packaged }}/images/lisawatch-banner.jpg") no-repeat scroll center center / cover rgba(0, 0, 0, 0);
	    color: #ffffff;
	    height: 240px;
	    text-align: center;
	}
	.masthead .introduction .actions {
		margin-top: 1.5em;
	}
	
	.topic .title {
		margin: 0.5em 0;
	}
	.topic .content .attribute {
		margin: 0 0 0.75em;
		font-size: 0.925em;
		color: rgba(0, 0, 0, 0.4);
	}
	.topic .content .attribute a {
		color: rgba(0, 0, 0, 0.4);
	}
	.topic .content .description {
		color: rgba(0, 0, 0, 0.7);
	}
</style>
{% endblock %}
{% block jquery %}
	
{% endblock %}


{% block tophead %}
<div class="ui tophead">
	{% include "block/social/sub_menu.html" %}
</div>
{% endblock %}

{% block content %}
<div class="ui social">
	<div class="ui responsive grid">
		<div class="column">
			<div class="ui magenta tiered menu">
			  	<div class="menu">
					{% if is_top %}
						{% category_list var:'category' only_open:1 domain:domain show_all:1 current:cid %}
					{% else %}
						{% category_list var:'category' only_open:1 domain:domain show_all:1 current:pid %}
					{% endif %}
					
					{% for cat in category.rows %}
				  	<a class="ui {{ cat.active }} item" href="{{ cat.view_url }}">{{ cat.title }}</a>
					{% endfor %}
					
					<a class="ui item" href="{{ app_url_try }}" target="_blank">产品公测</a>
					
			    	<div class="right menu">
						<a class="ui showbox magenta item" href="#advanced-filter-topic">
							<i class="list layout icon"></i>
						</a>
			    	</div>
			  	</div>
				{% if category_id %}
					{% if is_top %}
						{% category_list var:'children' page:1 only_open:1 domain:domain pid:cid %}
					{% else %}
						{% category_list var:'children' page:1 only_open:1 domain:domain pid:pid %}
					{% endif %}
					
					{% if children.total_rows %}
				  	<div class="ui sub menu">
						<div class="ui labels">
							{% for child in children.rows %}
							{% if child._id == category_id %}
							<a class="ui label magenta link" href="{{ child.view_url }}">
								{{ child.title }}
								{% if child.total_count %}
								<div class="detail">{{ child.total_count }}</div>
								{% endif %}
							</a>
							{% else %}
							<a class="ui label black link" href="{{ child.view_url }}">
								{{ child.title }}
								{% if child.total_count %}
								<div class="detail">{{ child.total_count }}</div>
								{% endif %}
							</a>
							{% endif %}
							{% endfor %}
						</div>
				  	</div>
					{% endif %}
				{% endif %}
			</div>
		</div>
	</div>
	
	<div class="ui responsive grid">
		
		<div class="row">
			<div class="column">
				<div class="ui segment hide" id="advanced-filter-topic">
					<div class="ui grid">
						<div class="row">
							<div class="sixteen wide column">
								<div class="ui horizontal list">
									<label class="item">类别：</label>
								  	<a class="ui {{ css_type_stick }} item link" href="{{ links.stick_url }}">推荐</a>
								  	<a class="ui {{ css_type_fine }} item link" href="{{ links.fine_url }}">精华</a>
								</div>
							</div>
							<div class="sixteen wide column">
								<div class="ui horizontal list"> 
									<label class="item">时间：</label>
								  	<a class="ui {{ css_time_all }} item link" href="{{ links.time_all_url }}">全部</a>
								  	<a class="ui {{ css_time_day }} item link" href="{{ links.time_day_url }}">一天之内</a>
								  	<a class="ui {{ css_time_week }} item link" href="{{ links.time_week_url }}">一周之内</a>
									<a class="ui {{ css_time_mouth }} item link" href="{{ links.time_mouth_url }}">一个月内</a>
									<a class="ui {{ css_time_year }} item link" href="{{ links.time_year_url }}">近一年内</a>
								</div>
							</div>
							<div class="sixteen wide column">
								<div class="ui horizontal list">
									<label class="item">排序：</label>
								  	<a class="ui {{ css_sort_default }} item link" href="{{ links.sort_default_url }}">默认</a>
								  	<a class="ui {{ css_sort_update }} item link" href="{{ links.sort_updated_url }}">发帖时间</a>
								  	<a class="ui {{ css_sort_comment }} item link" href="{{ links.sort_comment_url }}">回复最多</a>
									<a class="ui {{ css_sort_favorite }} item link" href="{{ links.sort_favorite_url }}">收藏最多</a>
									<a class="ui {{ css_sort_love }} item link" href="{{ links.sort_laud_url }}">最赞主题</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="ui stacked segment">
					<table class="ui basic sortable topic table">
						<thead>
							<tr>
								<th>发布者</th>
								<th>主题</th>
								<th>最后回应</th>
								<th>回复数</th>
							</tr>
						</thead>
						{% topic_list var:'list' category_id:category_id is_top:is_top type:type time:time sort:sort page:page %}
						{% for topic in list.rows %}
							<tr>
								<td>
									<a class="ui small avatar image" href="{{ topic.user.home_url }}">
							      		<img src="{{ topic.user.small_avatar_url }}" />
									</a>
								</td>
								<td class="ten wide">
						          	<h3 class="title">
										<a href="{{ topic.view_url }}" title="{{ topic.title }}" class="ui link">{{ topic.title }}</a>
									</h3>
							      	<div class="content">
										<div class="attribute">
											<span class="category"><a href="{{ topic.category.view_url }}" class="ui link">{{ topic.category.title }}</a></span> | 
											<span class="author">
												<a href="{{ topic.user.home_url }}" class="ui link">{{ topic.user.nickname }}</a>  <i class="time icon"></i> 于 {{ topic.created_on|relative_time }} 发表
											</span>
										</div>
										{% if !topic.asset_count %}
											<div class="description">
												{{ topic.strip_description|truncate 70 }}
											</div>
										{% else %}
											{% asset_list var:'assets' parent_id:topic._id size:6 asset_type:55 %}
											<!--展示图片-->
											<div class="ui small images">
												{% for asset in assets.rows %}
											  	<img class="ui image" src="{{ asset.thumbnails.tiny.view_url }}" />
												{% endfor %}
											</div>
										{% endif %}
							      	</div>
								</td>
								<td>
									{% if topic.last_user %}
									<a class="ui link" href="{{ topic.last_user.home_url }}" title="{{ topic.last_user.nickname }}">
								  		<img src="{{ topic.last_user.mini_avatar_url }}" class="ui avatar image" />
									</a>
									最后回复 {{ topic.last_reply_time|relative_time}}
									{% endif %}
								</td>
								<td>
									<a href="{{ topic.view_url }}#comment" class="dot-irecommend">
										<span class="dot-irecommend-count">{{ topic.comment_count }}</span> 
										<span class="dot-irecommend-suffix"></span>
									</a>
								</td>
							</tr>
						{% endfor %}
						
						
					</table>
					
					<div class="ui divided topic-list list">
						{% if dig_list %}
							{% for dig in dig_list %}
								<div class="item">
									<div class="ui grid">
										<div class="two wide hide-on-mobile column">
											<a class="ui small avatar image" href="{{ dig.user.home_url }}">
									      		<img src="{{ dig.user.small_avatar_url }}" />
											</a>
										</div>
										<div class="twelve wide column">
									      	<div class="content">
									          	<h3 class="link header">
													[置顶] <a href="{{ dig.view_url }}" title="{{ dig.title }}" class="ui link">{{ dig.title }}</a>
												</h3>
												<div class="description">
													{{ dig.strip_description|truncate 70 }}
												</div>
												{% if dig.asset_count %}
													<!--展示图片-->
													<div class="ui small images">
														{% asset_list var:'assets' parent_id:dig._id size:6 asset_type:55 %}
														{% for asset in assets.rows %}
													  	<img class="ui image" src="{{ asset.thumbnails.tiny.view_url }}" />
														{% endfor %}
													</div>
												{% endif %}
												
												<div class="ui divided horizontal list">
												  	<div class="small item">
														<a href="{{ dig.category.view_url }}" class="ui link">
															{{ dig.category.title }}
														</a>
													</div>
												  	<div class="small item"><a href="{{ dig.user.home_url }}" class="ui link">{{ dig.user.nickname }}</a> <i class="time icon"></i>{{ dig.created_on|relative_time }}</div>
													{% if topic.last_user %}
													<div class="small item"><a href="{{ dig.user.home_url }}" class="ui link">{{ dig.last_user.nickname }}</a> <i class="time icon"></i>{{ dig.last_reply_time|relative_time }}回复</div>
													{% endif %}
												</div>
							
									      	</div>
										</div>
										<div class="right aligned two wide hide-on-mobile column comment-counter">
											<a href="{{ topic.view_url }}#comment" class="dot-irecommend">
												<span class="dot-irecommend-count">{{ dig.comment_count }}</span> 
												<span class="dot-irecommend-suffix"></span>
											</a>
								      	</div>
									</div>
							  	</div>
							{% endfor %}
						{% endif %}
						
						{% if !subject_category %}
							
						{% else %}
							<!--产品话题专区-->
							{% product_list var:'list' page:page only_subject:1 %}
							{% for product in list.rows %}
								{% include "block/product_subject_item.html" %}
							{% endfor %}
						{% endif %}
					</div>
					
				</div>
				
				{% if list.total_page %}
				<div class="ui pagination">
					{% pager url:pager_url,total_rows:list.total_rows,total_page:list.total_page,current_page:page,var:'pager',pager_size:9 %}
					{% include 'block/pager.html' %}
				</div>
				{% endif %}
				
			</div>
			
			
		</div>
	</div>
</div>
{% endblock %}