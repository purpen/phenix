{%extends 'layout/sns.html'%}
{% block title %}{{ current_category.title }}-{% endblock %}
{% block page_css %}
<style type="text/css">
	.ui.tophead {
	    background: url("{{ app_url_packaged }}/images/bg-banner.jpg") no-repeat scroll center center / cover rgba(0, 0, 0, 0);
	}
</style>
{% endblock %}

{% block jquery %}
	
{% endblock %}


{% block tophead %}
<div class="ui tophead">
	{% include "block/social/sub_menu.html" %}
</div>
{% endblock %}

{% block content %}
<div class="ui social" id="topiclist">
	<div class="ui responsive grid">
		<div class="middle aligned row">
			<div class="eleven wide column">
				<div class="ui medium breadcrumb">
				  	<a class="ui section link" href="{{ app_url_topic }}">
						<i class="basic icon community"></i> 社区
					</a>
				  	<i class="angle right icon divider"></i>
					{% if !is_top %}
				  	<a class="ui section link" href="{{ app_url_topic }}/c{{ parent_category._id }}">{{ parent_category.title }}</a>
				  	<i class="angle right icon divider"></i>
					{% endif %}
				  	<a class="ui section link" href="{{ app_url_topic }}/c{{ current_category._id }}">{{ current_category.title }}</a>
				</div>
			</div>
			<div class="five wide right aligned column">
				<a href="{{ app_url_action_base }}/topic/submit?cid={{ current_category._id }}" class="ui gray hide button">
					<i class="add icon"></i> 发表话题
				</a>
			</div>
		</div>
		
		<div class="row">
			<div class="column">
				<div class="ui magenta tiered menu">
				  	<div class="menu">
						{% if is_top %}
							{% category_list var:'category' page:1 only_open:1 show_all:1 domain:domain pid:cid current:cid %}
						{% else %}
							{% category_list var:'category' page:1 only_open:1 show_all:1 domain:domain pid:parent_category._id current:cid %}
						{% endif %}
						
						{% for cat in category.rows %}
							{% if cat._id == 0 %}
								<a class="ui {% if is_top %}active{% endif %} item" href="{{ parent_category.view_url }}">{{ cat.title }}</a>
							{% else %}
								<a class="ui {{ cat.active }} item" href="{{ cat.view_url }}">{{ cat.title }} <small>({{ cat.total_count }})</small></a>
							{% endif %}
						{% endfor %}
				    	<div class="right menu">
							<a class="ui showbox magenta item" href="#advanced-filter-topic">
								<i class="list layout icon"></i>
							</a>
				    	</div>
				  	</div>
				</div>
				
				<div class="ui segment hide" id="advanced-filter-topic">
					<div class="ui grid">
						<div class="row">
							<div class="sixteen wide column">
								<div class="ui horizontal list">
									<label class="item">类别：</label>
								  	<a class="ui {{ css_type_stick }} item link" href="{{ links.stick_url }}">推荐</a>
								  	<a class="ui {{ css_type_fine }} item link" href="{{ links.fine_url }}">精华</a>
								</div>
							</div>
							<div class="sixteen wide column">
								<div class="ui horizontal list"> 
									<label class="item">时间：</label>
								  	<a class="ui {{ css_time_all }} item link" href="{{ links.time_all_url }}">全部</a>
								  	<a class="ui {{ css_time_day }} item link" href="{{ links.time_day_url }}">一天之内</a>
								  	<a class="ui {{ css_time_week }} item link" href="{{ links.time_week_url }}">一周之内</a>
									<a class="ui {{ css_time_mouth }} item link" href="{{ links.time_mouth_url }}">一个月内</a>
									<a class="ui {{ css_time_year }} item link" href="{{ links.time_year_url }}">近一年内</a>
								</div>
							</div>
							<div class="sixteen wide column">
								<div class="ui horizontal list">
									<label class="item">排序：</label>
								  	<a class="ui {{ css_sort_default }} item link" href="{{ links.sort_default_url }}">默认</a>
								  	<a class="ui {{ css_sort_update }} item link" href="{{ links.sort_updated_url }}">发帖时间</a>
								  	<a class="ui {{ css_sort_comment }} item link" href="{{ links.sort_comment_url }}">回复最多</a>
									<a class="ui {{ css_sort_favorite }} item link" href="{{ links.sort_favorite_url }}">收藏最多</a>
									<a class="ui {{ css_sort_love }} item link" href="{{ links.sort_laud_url }}">最赞主题</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="ui stacked segment">
					<table class="ui basic sortable topic table">
						<thead>
							<tr>
								<th>发布者</th>
								<th>主题</th>
								<th>最后回应</th>
								<th>回复数</th>
							</tr>
						</thead>
						<tbody>
						{% if dig_list %}
							{% for dig in dig_list %}
								<tr>
									<td>
										<a class="ui small avatar image" href="{{ dig.user.home_url }}">
								      		<img src="{{ dig.user.small_avatar_url }}" alt="{{ dig.user.nickname }}" />
										</a>
									</td>
									<td class="ten wide">
								      	<h3 class="title">
											<a href="{{ dig.view_url }}" title="{{ dig.title }}" class="ui line link">[置顶] {{ dig.title }}</a>
										</h3>
								      	<div class="content">
											<div class="attribute">
												<span class="category"><a href="{{ dig.category.view_url }}" class="ui link">{{ dig.category.title }}</a></span> | 
												<span class="author">
													<a href="{{ dig.user.home_url }}" class="ui link">{{ dig.user.nickname }}</a>  <i class="time icon"></i> 于 {{ dig.created_on|relative_datetime }} 发表
												</span>
											</div>
											{% if !dig.asset_count %}
												<div class="description">
													{{ dig.strip_description|truncate 70 }}
												</div>
											{% else %}
												{% asset_list var:'assets' parent_id:dig._id size:6 asset_type:55 %}
												<!--展示图片-->
												<div class="ui mini images">
													{% for asset in assets.rows %}
												  	<img class="ui image" src="{{ asset.thumbnails.tiny.view_url }}" />
													{% endfor %}
												</div>
											{% endif %}
								      	</div>
									</td>
									<td>
										{% if dig.last_user %}
										<a class="ui link" href="{{ dig.last_user.home_url }}" title="{{ dig.last_user.nickname }}">
									  		<img src="{{ dig.last_user.mini_avatar_url }}" class="ui avatar image" alt="{{ dig.last_user.nickname }}" />
										</a>
										回复于 {{ dig.last_reply_time|relative_datetime }}
										{% endif %}
									</td>
									<td>
										<a href="{{ dig.view_url }}#comment" class="dot-irecommend">
											<span class="dot-irecommend-count">{{ dig.comment_count }}</span> 
											<span class="dot-irecommend-suffix"></span>
										</a>
									</td>
								</tr>
							{% endfor %}
						{% endif %}
						
						{% topic_list var:'list' category_id:category_id is_top:is_top type:type time:time sort:sort page:page %}
						{% for topic in list.rows %}
							{% if !topic.top %}<!--过滤置顶帖子-->
								{% include "block/topic_item.html" %}
							{% endif %}
						{% endfor %}
						</tbody>
					</table>
				</div>
				
				{% if list.total_page %}
				<div class="ui pagination">
					{% pager url:pager_url,total_rows:list.total_rows,total_page:list.total_page,current_page:page,var:'pager',pager_size:9 %}
					{% include 'block/pager.html' %}
				</div>
				{% endif %}
				
			</div>
		</div>

	</div>
</div>
{% endblock %}