{%extends 'layout/column.html'%}
{% block title %}{% endblock %}
{% block page_css %}
<style type="text/css">
font{
    display: none;
}
</style>
{% endblock %}

{% block layout_js %}
<script type="text/javascript" >
    function ajax_load_more(page, type, time, sort){
        var url = '{{ app_url_topic }}/ajax_fetch_more?rand='+Math.random();
        if(page != 'no'){
            $.get(url, { page:page, type:type, time:time, sort:sort }, function(rs){
                rs.data['phenix'] = phenix.url;
                var rendered = phenix.ajax_render_result('#fetch_more_topics_tpl', rs.data);
                $('#topic-more').before(rendered);
                if (rs.data.nex_page != 'no'){
                    $('#topic-more').data('status', 0);
                }
                $('#topic-more').data('page', page);
                //$('#topic-more').hide();
                $('.ui.more.button').html('<i class="search icon"></i> 查看更多话题');
            }, 'json');
        }else{
            $(this).text('没有更多了~');
        }
    }

</script>
{% endblock %}

{% block jquery %} 
    $('#minslider').flexslider({
        animation: "fade",
        controlNav: false,
        slideshow: true,
		slideshowSpeed: 4500,
		animationDuration: 800,
    });
	
    // ajax加载签到数据
    phenix.signin();
    
	// 加载更多动态
    $('.ui.more.button').bind('click',function(){
        var stat = $('#topic-more').data('status');
        var page = parseInt($('#topic-more').data('page')) + 1;
        var type = parseInt($('#topic-more').data('type')), time = parseInt($('#topic-more').data('time')), sort = parseInt($('#topic-more').data('sort'));
        if(stat == 0){
            $('#topic-more').data('status', 1);
            $('.ui.more.button').html('加载中...')
            ajax_load_more(page,type,time,sort);
        }
    })
    
    $('.mentors > .avatar a')
      .popup({
        hoverable: true,
        position : 'top center',
      });

{% endblock %}

{% block content %}
<div class="ui topicnew-nav page">
    <div class="ui responsive grid">
        <div class="row">
            <div class="ui center aligned column">
                <div class="ui horizontal list">
                    <div class="item">
                        <a href="{{ app_url_topic }}" class="ui active link">话题</a>
                    </div>
                    <div class="item">
                        <a href="{{ app_url_try }}" class="ui link">免费试用</a>
                    </div>
                    <div class="item">
                        <a href="{{ app_url_active }}" class="ui  link">活动</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="ui topicnew page">
    <div class="ui responsive grid slidebox">
        <div class="row pt-0">
            <div class="column">
                {% ad_list var:'adslide' page:1 size:3 state:2 name:'find_home_slide' %}
                <div id="minslider" class="flexslider flex-single">
                    <ul class="slides">                    
                        {% for ad in adslide.rows %}
                            <li style="background-image: url('{{ ad.cover.fileurl }}');">
                                <a href="{{ ad.view_url }}" title="{{ ad.title }}" alt="{{ ad.title }}" target="_blank">
                                    <img src="{{ ad.cover.fileurl }}" alt="{{ ad.title }}" style="display: none;" />
                                </a>
                            </li>
                        {% endfor %}
                      </ul>
                </div>
                <div class="controls-dots"></div>
            </div>
        </div>
    </div>
    <div class="ui responsive grid">
        <div class="row">
            <div class="column">
                <div class="ui inverted secondary pointing menu">
                <!--
                    {% category_list var:'category' only_open:1 domain:2 pid:topic_category_comprehensive size:15 %}
                    {% for cat in category.rows %}
                        {% if cat.pid %}
                        <a class="item" href="{{ cat.view_url }}">
                            {{ cat.title }}
                        </a>
                        {% endif %}
                    {% endfor %}
                    -->
                    <a class="item active">最新话题</a>
                    <a class="item">深度解析</a>
                    <a class="item">行业资讯</a>
                    <a class="item">热门活动</a>
                    <a class="item">产品评测</a>
                    <a class="item">七嘴八舌</a>
                </div>
            </div>
        </div>
    </div>
    <div class="ui responsive grid">
        <div class="row">
            <div class="column">
                <div class="ui containermain">
                    <div class="conleft">
                        {% if dig_list %}
                            {% for topic in dig_list %}
                                {% if topic %}
                                    <!-- 判断话题是否可以显示 -->
                                    {% if topic.published %}
                                        {% include "block/topic_item.html" %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
            
                        {% for topic in list.rows %}
                            {% if !topic.top==1 %}<!--过滤置顶帖子-->
                                {% include "block/topic_item.html" %}
                            {% endif %}
                        {% endfor %}

                        
                            <div id="topic-more" data-page="1" data-status="0" data-type="{{ type }}" data-time="{{ time }}" data-sort="{{ sort }}">
                                <div class="resultbox">
                                    <a href="javascript:void(0);" class="ui magenta inverted large more button">
                                       <i class="search icon"></i> 查看更多话题 
                                    </a>
                                </div>
                            </div>
                       
                        
                    </div>
                    <div class="conright">
                        {% include "page/topic/usersign.html" %}
                        {% include "page/topic/login_user.html" %}
                        {% include "page/topic/rightbar.html" %}
                        {% include "page/topic/right_active.html" %}
                        {% include "page/topic/top_user.html" %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block templates %}
{% mustache id:'user_sign_box_tpl' tpl:'mustache/user_sign_box.mustache' %}
{% mustache id:'fetch_more_topics_tpl' tpl:'mustache/fetch_more_topicbox.mustache' %}
{% endblock %}
