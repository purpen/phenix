{%extends 'layout/column.html'%}
{% block title %}{% endblock %}
{% block page_css %}
<style type="text/css">
.ui.topics.segment {
    padding: 0;
    margin-top: 1.5em;
}
.ui.topics.segment .ui.table {
    border: none;
}

</style>
{% endblock %}

{% block jquery %}
    //ajax加载签到数据
    $.get('{{ app_url_user }}/ajax_fetch_user_sign', {type:1});

    //每日签到点击
    $('#sign-in-btn').livequery(function(){
      $(this).click(function(){
        // 所有ajax请求，验证是否登录
        if (!phenix.visitor.is_login){
          phenix.show_login_box();
          return false;
        }
        //ajax加载签到事件
        $.post('{{ app_url_user }}/ajax_sign_in', {type:1});

      });
    });
    
	// 加载更多动态
	$('.ui.more.button').bind('click', function(){
		var page = $(this).data('page');
        if(page != 'no'){
            $.get('{{ app_url_topic }}/ajax_fetch_more', { page:page });
        }else{
            $(this).text('没有更多了~');
        }
	});
    $('.mentors > .avatar a')
      .popup({
        inline: true
      });
{% endblock %}

{% block content %}
<div class="mainwrap social" id="topics">
    <div class="mainleftwrap">
        <div class="mainleft">
            
            <!-- 话题推荐位 -->
            {% topic_list var:'featurelist' type:1 size:3 %}
            <div class="social topstick">
                {% if featurelist.total_rows %}
				<div class="ui socialstick stickcount three blocks">
                    {% for ft in featurelist.rows %}
						<!-- 判断话题是否可以显示 -->
						{% if ft.published %}
							<div class="block">
								<div class="image" {% if ft.cover %}style="background-image: url('{{ ft.cover.thumbnails.medium.view_url }}');"{% endif %}>
									<a class="transparent" href="{{ ft.view_url }}" target="_blank">
										<div class="sub title">
											{{ ft.title }}
											<div class="extra count">
												<i class="unhide icon"></i> <span>{{ ft.view_count }}</span> <i class="comment outline icon"></i> <span>{{ ft.comment_count }}</span>
											</div>
										</div>
									</a>
								</div>
							</div>
						{% endif %}
					{% endfor %}
				</div>
                {% endif %}
            </div>
            
            <!--精选话题-->
            <div class="ui topics segment">
				{% topic_list var:'list' is_top:1 time:time sort:sort page:1 size:15 %}
				<div class="ui computer tablet only block">
					<table class="ui basic topic table">
						<thead>
							<tr>
								<th>发布者</th>
								<th>主题</th>
								<th>最后回应</th>
								<th class="center aligned">浏览数</th>
							</tr>
						</thead>
                        <tbody id="topic_list_box">
						{% if dig_list %}
							{% for topic in dig_list %}
								{% if topic %}
									<!-- 判断话题是否可以显示 -->
									{% if topic.published %}
										{% include "block/topic_item.html" %}
									{% endif %}
								{% endif %}
							{% endfor %}
						{% endif %}   
                        
						{% for topic in list.rows %}
							{% if !topic.top %}<!--过滤置顶帖子-->
								<!-- 判断话题是否可以显示 -->
								{% if topic.published %}
									{% include "block/topic_item.html" %}
								{% endif %}
							{% endif %}
						{% endfor %}
                        </tbody>
					</table>
				</div>
			
				<div class="ui mobile only block">
					<table class="ui basic table">
						{% for topic in list.rows %}
							<tr>
								<td class="{%if topic.t_color==1%}topic-title-color-red{%endif%}{%if topic.t_color==2%}topic-title-color-blue{%endif%}{%if topic.t_color==3%}topic-title-color-green{%endif%}{%if topic.t_color==4%}topic-title-color-yellow{%endif%}">
						          	<a href="{{ topic.view_url }}" title="{{ topic.title }}" class="ui link">{{ topic.title }}</a>
								</td>
							</tr>
						{% endfor %}
					</table>
				</div>
                
                {% if list.total_page > 1 %}
                <div class="auto loading">
                    <div class="ui gray more inverted button" data-page="{{ list.next_page }}">
                        <i class="chevron circle down icon"></i> 查看下一页
                    </div>
                </div>
                {% endif %}
			</div>
            
            <!-- 发表话题 -->
            <div class="social submitbox">
            	<div class="ui responsive grid">
            		<div class="row">
            			<div class="center aligned column">
            				<h2 class="ui header">
            					去发现、去支持、去分享
            				</h2>
            				<p>无论您是谁，让我们用创意和梦想，去改变这个平凡无奇的世界</p>
            				<a href="{{ app_url_topic }}/submit" class="ui inverted share magenta button">
            					<i class="edit icon"></i> 发表新话题
            				</a>
            			</div>
            		</div>
            	</div>
            </div>
            
        </div>
        
    </div>
    <div class="mainright">
        {% include "page/topic/rightbar.html" %}
    </div>
</div>
{% endblock %}
