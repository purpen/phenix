{%extends 'layout/column.html'%}
{% block title %}{% endblock %}
{% block page_css %}
<style type="text/css">
.ui.topics.segment .ui.table {
    border: none;
}

#minslider.flexslider .slides {
    height: 350px;
}
#minslider.flexslider .slides > li {
    height: 350px;
    border-radius: 4px;
}
#minslider.flexslider .slides > li > a {
    height: 350px;
}
#minslider.flexslider .flex-direction-nav {
    display:block;
    height:auto;
}
#minslider.flexslider .flex-direction-nav a {
    top: 50%;
}
#minslider.flexslider:hover .flex-direction-nav .flex-prev {
    left: 30px;
}
#minslider.flexslider:hover .flex-direction-nav .flex-next {
    right: 30px;
}
</style>
{% endblock %}

{% block jquery %}
    //ajax加载签到数据
    $.get('{{ app_url_user }}/ajax_fetch_user_sign', {type:1});

    //每日签到点击
    $('#sign-in-btn').livequery(function(){
      $(this).click(function(){
        // 所有ajax请求，验证是否登录
        if (!phenix.visitor.is_login){
          phenix.show_login_box();
          return false;
        }
        //ajax加载签到事件
        $.post('{{ app_url_user }}/ajax_sign_in', {type:1});

      });
    });
 
    $('#minslider').flexslider({
        animation: "slide",
        controlNav: false,
        slideshow: false,
    });
    
	// 加载更多动态
	$('.ui.more.button').bind('click', function(){
		var page = $(this).data('page');
        if(page != 'no'){
            $.get('{{ app_url_topic }}/ajax_fetch_more', { page:page });
        }else{
            $(this).text('没有更多了~');
        }
	});
    $('.mentors > .avatar a')
      .popup({
        inline: true
      });
{% endblock %}

{% block content %}
<!-- 话题推荐位 -->
<div class="mainwrap social" id="topics">
    <div class="social topstick">
        <div class="slidebox">
            
            {% ad_list var:'adslide' page:1 size:3 state:2 name:'find_home_slide' %}
            <div id="minslider" class="flexslider flex-single">
                <ul class="slides">                    
	                {% for ad in adslide.rows %}
                        <li style="background-image: url('{{ ad.cover.fileurl }}');">
                            <a href="{{ asset.thumbnails.huge.view_url }}" title="{{ ad.title }}" alt="{{ ad.title }}">
                                <img src="{{ ad.cover.fileurl }}" alt="{{ ad.title }}" style="display: none;" />
                            </a>
                        </li>
					{% endfor %}
                  </ul>
            </div>
            <div class="controls-dots"></div>
            
		</div>
    </div>
    
    <div class="mainleftwrap">
        <div class="mainleft">
            <!--精选话题-->
            <div class="ui topics segment">
				{% topic_list var:'list' is_top:1 time:time sort:sort page:1 size:15 %}
				<div class="ui computer tablet only block">
					<table class="ui basic topic table">
						<thead>
							<tr>
								<th>发布者</th>
								<th>主题</th>
								<th>最后回应</th>
								<th class="center aligned">浏览数</th>
							</tr>
						</thead>
                        <tbody id="topic_list_box">
						{% if dig_list %}
							{% for topic in dig_list %}
								{% if topic %}
									<!-- 判断话题是否可以显示 -->
									{% if topic.published %}
										{% include "block/topic_item.html" %}
									{% endif %}
								{% endif %}
							{% endfor %}
						{% endif %}   
            
						{% for topic in list.rows %}
							{% if !topic.top %}<!--过滤置顶帖子-->
								<!-- 判断话题是否可以显示 -->
								{% if topic.published %}
									{% include "block/topic_item.html" %}
								{% endif %}
							{% endif %}
						{% endfor %}
                        </tbody>
					</table>
				</div>

				<div class="ui mobile only block">
					<table class="ui basic table">
						{% for topic in list.rows %}
							<tr>
								<td class="{%if topic.t_color==1%}topic-title-color-red{%endif%}{%if topic.t_color==2%}topic-title-color-blue{%endif%}{%if topic.t_color==3%}topic-title-color-green{%endif%}{%if topic.t_color==4%}topic-title-color-yellow{%endif%}">
						          	<a href="{{ topic.view_url }}" title="{{ topic.title }}" class="ui link">{{ topic.title }}</a>
								</td>
							</tr>
						{% endfor %}
					</table>
				</div>
    
                {% if list.total_page > 1 %}
                <div class="auto loading">
                    <div class="ui gray more inverted button" data-page="{{ list.next_page }}">
                        <i class="chevron circle down icon"></i> 查看下一页
                    </div>
                </div>
                {% endif %}
			</div>

        </div>

    </div>
    <div class="mainright">
        {% include "page/topic/rightbar.html" %}
        {% include "page/topic/hotpeople.html" %}
        {% include "page/topic/adwrap.html" %}
    </div>
</div>
{% endblock %}
