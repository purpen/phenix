{%extends 'layout/column.html'%}
{% block title %}{% endblock %}
{% block layout_css %}
	{% if css_use_bundle %}
        <link rel="stylesheet" href="{{ app_url_packaged }}/css/froala_editor.min.{{ css_bundle_version }}.css" type="text/css" />
	{% else %}
        <link rel="stylesheet" href="{{ app_url_packaged }}/css/froala_editor.min.css" type="text/css" />
	{% endif %}
{% endblock %}
{% block page_css %}
<style type="text/css">
.start{
    background: url({{ active.banner.fileurl }}) no-repeat center center;
    background-size: cover;
	color: #fff;
	padding: 100px 0% 40px;
    position: relative;
}
.start h2.ui.header {
	font-weight: 400;
}
.start h2.ui.header .content {
	text-align:left;
}
.start .row {
	padding-top: 248px !important;
	margin:0;
}
.start h2.ui.header span,.start .row:nth-child(2) h2.ui.header{
	font-size:30px !important;
}
.start .row:first-child h2.ui.header{
	font-size:60px !important;
}



.rundown-timeline-container {
	height: auto;
	margin: 0 auto;
	max-width: 1000px;
	position: relative;
	width: 100%;
}
.rundown-timeline-container:before {
	background: none repeat scroll 0 0 #DCDEE1;
	content: "";
	height: 90px;
	left: 49%;
	position: absolute;
	top: 29px;
	width: 3px;
}
.rundown-timeline-container.bottom:before{
	height:0;
}
.timeline-red-dot {
	background-color: #00b6ae;
	border-radius: 14px 14px 14px 14px;
	height: 13px;
	left: 49%;
	margin-left: -5px;
	position: absolute;
	top: 23px;
	width: 13px;
	border: 7px solid #cdf5f3;
}
.timeline-block {
    height: 100px;
    margin: 0;
    position: relative;
    top: -5px;
}
.timeline-content.right {
    float: right;
}
.timeline-content {
    float: right;
    width: 46%;
}
.timeline-content.right .time {
    font-weight: normal;
    top: 14px;
    min-width: 90px;
    text-align: center;
}
.timeline-content .time {
    font-size: 16px;
    font-weight: bold;
    left: 34%;
    line-height: 38px !important;
    position: absolute;
}
.timeline-content .name {
    font-size: 17px;
    font-weight: bold;
    line-height: 16px;
    margin-top: 25px !important;
    margin-bottom: 0;
    color: #222;
}
.timeline-content .name.top{
	margin-top: 25px !important;
	font-size: 20px;
}
.timeline-content .title {
    font-size: 14px;
    line-height: 16px;
    margin: 9px 0 5px !important;
}
.title img {
	display: block;
	margin: 0 auto;
	width: 3em;
	height: 3em;
	border-radius: 500px;
	float: left;
}
.title .content {
	padding-top: .25em;
	margin-left: 3.5em;
	font-size:14px;
	color:#666;
}
.text {
    margin: .25em 0 .5em;
    word-wrap: break-word;
    line-height: 1.325em;
    font-size:14px;
}




.position.row h4.ui.header{
	font-size:1em;
	font-weight:400;
	padding-bottom:1rem;
	height: 21px;
}
h4.ui.header .map-advantage {
	font-size: 1em;
	font-weight: 400;
	color:#666;
	display: inline-block;
	float: right;
}
.position.row{
	position:absolute;
	top:40px;
	width:360px;
	text-align: left;
	right:3%;
}
.position.row .item{
	-webkit-box-shadow: 0 3px 5px rgba(0,0,0,0.4) !important;
	box-shadow: 0 3px 5px rgba(0,0,0,0.4) !important;
}
.position.row .image img{
	width:100%;
}
.position.row .one.items{
	background:#fff;
}
.position.row .content{
	padding:1.2em 1em 1.8em;
}
.icon-place:before {
  content: "\f124";
	color:#f36;
	font-size: 1.5em;
}
.icon-place.icon{
	opacity:1;
}

/*@media only screen and (max-width: 1350px){
    .position.row{
		left:60%;
	}
  }
@media only screen and (max-width: 1250px){
    .position.row{
		left:58%;
	}
  }
@media only screen and (max-width: 1100px){
    .position.row{
		left:54%;
	}
  }*/




</style>
{% endblock %}

{% block layout_js %}
  <script src="{{ app_url_packaged }}/javascript/jquery.flexslider.js"></script>

  {% if active.map_info %}
  <!--引用百度地图API-->
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=N8Y86jHulT4qDOAmLb47vU7y"></script>
  {%endif%}
  <script type="text/javascript" >
  {% if active.map_info %}
		var map = new BMap.Map("map");
		var point = new BMap.Point({{ active.map_info.x }},{{ active.map_info.y }});
		map.centerAndZoom(point, {{ active.map_info.matter }});
		var marker = new BMap.Marker(point);  // 创建标注
		map.addOverlay(marker);               // 将标注添加到地图中
		//marker.setAnimation(BMAP_ANIMATION_BOUNCE);	//动画定位
		
		map.addControl(new BMap.MapTypeControl());	//地图 卫星 三维
		map.addControl(new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT}));	//标尺
		map.addControl(new BMap.NavigationControl());	//放大 移动
		
		var opts = {
			  position : point,    // 指定文本标注所在的地理位置
			  offset   : new BMap.Size(5, -50)    //设置文本偏移量
			}
			var label = new BMap.Label("{{ active.map_info.title }}", opts);  // 创建文本标注对象
				label.setStyle({
					 color : "#666",
					 fontSize : "14px",
					 height : "20px",
					 lineHeight : "20px",
					 fontFamily:"微软雅黑",
					 border:"1px solid #ccc",
					 padding:"0 5px"
				 });
			map.addOverlay(label);

	{%endif%}

  //ajax获取报名列表
  function fetch_signup_avatar(){
    var url = '{{ app_url_active }}/ajax_fetch_signup';
    var target_id = {{ active._id }};
    $.get(url, { target_id: target_id, evt:1, from:'site' });
  }

  //评论分页
  var per_page = 10, sort = 0;
  function fetch_comment(current_page, per_page){
    var url = '{{ app_url_comment }}/ajax_fetch_comment_site';
    $.get(url, {target_id: '{{ active.topic_ids.0 }}', type: 2, page: current_page, sort: sort, per_page: per_page});
  }

  </script>
{% endblock %}

{% block js %}
{% endblock %}
{% block jquery %}
  //ajax加载评论
  fetch_comment(1, per_page, sort);
  
  phenix.hook_comment_page();

  //分享
  phenix.bind_share_list('{{ active.cover.thumbnails.resp.view_url }}');
	// 生成二维码
	$('#qrcode').qrcode({width: 256, height: 256, text: '{{ active.wap_view_url }}'});
	
	$('.ui.tabox').smint({
    	'scrollSpeed': 1000,
		'mySelector' : 'section'
    });

  //报名按钮
	$('.ui.attend.button').click(function(){
		// 所有ajax请求，验证是否登录
		if (!phenix.visitor.is_login){
			phenix.show_login_box();
			return false;
		}
    $('.ui.user-info-box.modal').modal('show');
    return false; 
    //验证用户信息齐全
    /**
    $.get('{{ app_url_domain }}/user/ajax_check_userinfo', {}, function(result){
      if(result=='true'){
        //ajax报名
        $.get('{{ app_url_action_base }}/active/ajax_attend', { target_id: {{ active._id }} });
      }else if(result=='false'){

      }
    });
    **/

	});

  //取消报名弹出框
	$('.ui.deny.button').click(function(){
		$('.ui.user-info-box.modal').modal('hide');
	});

	$('#user-info-form').livequery(function(){
		$(this).form({
			realname: {
				identifier  : 'realname',
				rules: [
					{
						type   : 'empty',
						prompt : '姓名不能为空'
					}
				]
			},
			phone: {
				identifier  : 'phone',
				rules: [
					{
						type   : 'empty',
						prompt : '电话不能为空'
					}
				]
			},
			address: {
				identifier  : 'address',
				rules: [
					{
						type   : 'empty',
						prompt : '地址不能为空'
					}
				]
			},
			job: {
				identifier  : 'job',
				rules: [
					{
						type   : 'empty',
						prompt : '职位不能为空'
					}
				]
			}
		}, {
			inline : true,
			onSuccess: function(event){
				event.preventDefault();
				$(this).ajaxSubmit();
			}
		});
	});

	$('.flexslider').flexslider({
	      animation: "slide",
	      controlNav: false, 
	});
	
	skrollr.init({
		forceHeight: false,
		mobileCheck:function(){},
		mobileDeceleration:0.004,
	});

  //ajax获取报名列表头像
  fetch_signup_avatar();

{% endblock %}

{% block content %}
<section class="start banner">
    <div class="ui responsive grid">
        {% if active.step_stat == 1 %}
        <div class="row">
            <div class="center aligned column attend-box">
                {% if is_attend %}
                <div class="ui big inverted active white button">
                    <span><i class="smile icon"></i> 已报名，感谢参与！</span>
                </div>
                {% else %}
                <a class="ui big white inverted attend button" href="javascript:void(0);">
                    <i class="ticket icon"></i> 立即报名
                </a>
                {%endif%}
            </div>
        </div>
        {%endif%}
        
        {% if active.step_stat == 2 %}
        <div class="row">
            {% if active.report_url %}
            <div class="center aligned column">
                <a class="ui big white inverted button" href="{{ active.report_url }}" target="_blank">
                      <span>活动报道</span>
                </a>
            </div>
            {%else%}
            <div class="center aligned column attend-box" style="height:50px;"></div>
            {%endif%}
        </div>
        {%endif%}
    </div>
</section>

<div class="activity summary">
    <span><i class="time icon"></i> {{ active.begin_time|date 'Y/m/d H:i' }}</span> <span><i class="marker icon"></i> {{ active.address }}</span> <span><i class="users icon"></i> 活动人数：{{ active.max_number_count }}人</span>
</div>
          
<div class="mainwrap" id="activitypage">
    <div class="mainleftwrap">
        <div class="mainleft">
            <div class="container">
                <div class="product activity overview">
                    <p>
                        {{ active.content }}
                    </p>
                </div>
                
                <div class="bar"></div>
                <div class="activity people">
                	<div class="block title">
                		活动嘉宾
                    </div>
                    {% if active.process %}
                        {% for p in active.process %}
                        <div class="rundown-timeline-container">
                            <div class="timeline-block">
                                <div class="timeline-red-dot"></div>
                                <div class="timeline-content right">
                                    <div class="time">{{ p.time }}</div>
                                    <p class="name">{{ p.title }}</p>
                                    <div class="title">
                                        {% if p.img %}
                                        <img src="{{ p.img }}" alt="{{ p.name }}" />
                                        {% endif %}
                                        <div class="content">
                                            {{ p.name }}  
                                            <div class="text">
                                                {{ p.position }}
                                            </div>
                                        </div>	
                                    </div>
                                </div>
                            </div>
                        </div>
                        {%endfor%}
                        
              			<div class="rundown-timeline-container bottom">
              				<div class="timeline-block">
              					<div class="timeline-red-dot"></div>
              				</div>
              			</div>
                    {%endif%}
                </div>
                
                {% if active.step_stat == 2 %}
                <div class="bar"></div>
                <div class="activity pictures">
                	<div class="block title">
                		现场照片
                    </div>
                    {% asset_list var:'assets' parent_id:active._id asset_type:67 size:30 %}
                    
          	      	<div class="flexslider">
                        <ul class="slides">
                            {% for asset in assets.rows %}
                            <li>
                                <img src="{{ asset.thumbnails.big.view_url }}" />
                                <p>&nbsp;&nbsp;{{ asset.desc }}</p>
                            </li>
                            {%endfor%}
                        </ul>
          	        </div>
                </div>
                {% endif %}
                
                <div class="bar"></div>
                <div class="activity people">
                	<div class="block title">
                		活动报道
                    </div>
                    
                    
                </div>
                
                <div class="bar"></div>
                
                <div class="activity report">
                	<div class="block title">
                		活动报名
                    </div>
                    <!--ajax获取报名者头像-->
                    <div id="signup-avatar">
                        {% for i in avatar_loop %}
                        <div class="image avatar-list">
                            <img src="http://frstatic.qiniudn.com/images/avatar_default_small.jpg">
                        </div>
                        {% endfor %}
                    </div>
                    <div class="aettend-box">
                        {% if !active.step_stat == 1 %}
                            <a class="ui active grey inverted button" href="javascript:void(0);">
                                <span>活动结束</span>
                            </a>
                        {% else %}
      			          {% if is_attend %}
      			            <a class="ui big magenta active inverted button" href="javascript:void(0);">
      			                <i class="smile icon"></i> 已报名，感谢参与！
      			            </a>
      			          {% else %}
      			            <a class="ui big magenta attend inverted button" href="javascript:void(0);">
      			                <i class="ticket icon"></i> 立即报名
      			            </a>
      			          {% endif %}
              		    {% endif %}
                        <p>共有 <span>{{ active.signup_count }}</span> 人报名</p>
                    </div>
                </div>
                
                <div class="bar"></div>
                
                <div class="product activity reviews">
                	<div class="block title">
                		活动讨论
                    </div>
                    {% if active.topic_ids %}
                        <!--ajax comment-->
                        <div class="ui big reply segment" id="comment-list">
                            <div class="ui threaded comments is-comment"></div>
                            <div class="morepages" id="load-more-btn"></div>
                        </div>
                        {% include "block/comment_box_site.html" %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="mainright">
        
        <div class="sellwrap">
        	<div class="block title">
        		合作品牌
            </div>
			<div class="tryfirm">
                {% if active.partner %}
                    {% for p in active.partner %}
                    <a href="{{ p.url }}" title="{{ p.title }}" target="_blank">
                        <img src="{{ p.img }}" alt="{{ p.title }}" />
                    </a>
                    {%endfor%}
                {%endif%}
			</div>
        </div>
        
        <!--
        <div class="sellwrap">
        	<div class="block title">
        		礼品赞助
            </div>
        </div>
        
        <div class="sellwrap">
        	<div class="block title">
        		活动场地
            </div>
        </div>
        -->
        
        <!--百度地图容器-->
        <div class="sellwrap">
        	<div class="block title">
        		活动地址
            </div>
            <div class="rbox">
    		    <div style="height:300px;border:#ccc solid 1px;" id="map"></div>
                <p>{{ active.map_info.title }}</p>
			    <p><i class="map icon"></i>{{ active.address }}</p>
            </div>
        </div>
        
        <div class="sellwrap">
        	<!--分享-->
            <div class="rbox">
    		    {% include "block/big-circel-share.html" %}
            </div>
        </div>
        
    </div>
</div>
{% include "block/attend_user_info.html" %}
{% include "block/qrcode.html" %}
{% endblock %}
