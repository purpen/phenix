{%extends 'layout/column.html'%}
{% block title %}{{ product.title }}-{% endblock %}
{% block page_css %}
<style type="text/css">
	#votepage {
		padding-top: 1em;
		padding-bottom: 3em;
		background-color: #fff;
	}
	.product.params {
		padding: 1.5em 0;
	}
	#votepage .product.reviews {
		margin-bottom: 2em;
	}
	
	#votepage .ui.rules.grid > .column {
	    margin-bottom: 0;
		font-size: 0.875rem;
		color: rgba(0,0,0,0.6);
	}
	
	.vote.box {
	    margin-bottom: 1em;
	}
	.vote.box > .ui.timer.list,
	.vote.box > .ui.vote.buttons {
		text-align: center;
	}
	.vote.box > .ui.timer.list > .item {
	    padding: 0.2em;
	    line-height: 2.25em;
	}
	.vote.box > .ui.timer.list > .item.magenta {
	    color:#ff3366;
	}
	.vote.box > .ui.timer.list > .item > .count {
	    margin-right: 0.5em;
		margin-left: 0.5em;
	    font-size: 1.6em;
	}
	.vote.box > .ui.timer.list > .item:first-child > .count {
		margin-left: 0em;
	}
	.vote.box > .ui.timer.list > .item > .count > span {
		font-size: 0.5em;
		color: rgba(0,0,0,0.6);
		margin-left: 0.35em;
	}
	.vote.box > .ui.timer.list > .item > .number {
	    margin-right: 0.5em;
	    font-size: 1.5em;
	}
	.vote.box > .ui.timer.list > .item > .unit {
	    font-size: 0.875em;
	}
	
	.vote.box .ui.vote.buttons {
		float: right;
	}
	.vote.box .ui.vote.buttons .button {
		padding: 0.8em 3em;
	}
	
	
	
	ul li {
	    float: left;
	    margin-right: 10px;
		list-style: none inside none;
	}
	.notesite {
	    cursor: default;
	    display: inline-block;
	    font-size: 70px;
	    height: 1em;
	    position: relative;
	    width: 1em;
	}
	.notesite > .percent {
	    font-size: 25px;
	    left: 0;
	    position: absolute;
	    text-align: center;
	    top: 20px;
	    width: 100%;
	    z-index: 2;
	}
	.notesite > .percent .dec {
	    font-size: 15px;
	}
	.notesite > #slice {
	    clip: rect(0px, 1em, 1em, 0.5em);
	    height: 1em;
	    position: absolute;
	    width: 1em;
	}
	.notesite > #slice.gt50 {
	    clip: rect(auto, auto, auto, auto);
	}
	.notesite > #slice > .pie {
	    border: 0.1em solid #444444;
	    border-radius: 0.5em;
	    clip: rect(0em, 0.5em, 1em, 0em);
	    height: 0.8em;
	    position: absolute;
	    width: 0.8em;
	}
	.design .notesite > #slice > .pie {
	    border-color: #DF6C4F;
	}
	.creativity .notesite > #slice > .pie {
	    border-color: #3C948B;
	}
	.usability .notesite > #slice > .pie {
	    border-color: #ECD06F;
	}
	.content .notesite > #slice > .pie {
	    border-color: #1A99AA;
	}
	.notesite > #slice > .pie.fill {
	    transform: rotate(180deg) !important;
	}
	.notesite.fill > .percent {
	    display: none;
	}
	.notesite:after {
	    background: none repeat scroll 0 0 #F8F8F8;
	    border-radius: 0.5em;
	    content: "";
	    display: block;
	    height: 0.8em;
	    left: 0.1em;
	    position: absolute;
	    top: 0.1em;
	    width: 0.8em;
	    z-index: 1;
	}
	.notesite:before {
	    border-radius: 0.5em;
	    content: "";
	    display: block;
	    height: 1em;
	    opacity: 0.5;
	    position: absolute;
	    width: 1em;
	    z-index: 0;
	}
	.design .notesite:before {
	    background: none repeat scroll 0 0 #DF6C4F;
	}
	.creativity .notesite:before {
	    background: none repeat scroll 0 0 #3C948B;
	}
	.usability .notesite:before {
	    background: none repeat scroll 0 0 #ECD06F;
	}
	.content .notesite:before {
	    background: none repeat scroll 0 0 #1A99AA;
	}
	.total .notesite:before {
	    background: none repeat scroll 0 0 #CFD1D0;
	}
	
	.expert-assess {
		
	}
	.assess-point {
		clear:both;
	}
	
	.ui.point .button {
		background-color: #666666;
	    color: #FFFFFF;
	    cursor: pointer;
	    display: inline-block;
	    line-height: 16px;
	    margin-top: 3px;
		opacity: 0.8;
	    padding: 5px 10px;
		transition: all 0.25s ease 0s;
	}
	.ui.green.point .button {
		background-color: #58CB73;
	}
	.ui.green.point .button:hover {
		background-color: #58CB73;
		opacity: 1;
	}
	.ui.point .two.button {
		padding: 5px 6px;
	}
	.product.designer {
	    font-size: 0.875em;
	}
	.fever-view .wide.cover.column {
    	padding-right: 0;
	}
	.ui.laud.link {
		float: right;
	}
	.ui.clearing.divider {
		margin-top: 0.5em;
	}
	
	
	
	
	
	
	
	#product-vote {
		float: right;
	}
	
	#product-vote  > .button {
		padding: 0.8em 3em;
	}
	
	#product-vote  > .button > .icon {
		margin: 0;
	}
	
</style>
{% endblock %}

{% block jquery %}

	phenix.hook_product_topic();
	phenix.bind_share_list();
	
	var score = {};
	$('.ui.point > .button').click(function(){
		var point = $(this).attr('data-value');
		
		score.id = {{ product._id }};
		score.design = $('#score_design').val();
		score.usability = $('#score_usability').val();
		score.creativity = $('#score_creativity').val();
		score.content = $('#score_content').val();
		
		$.get('{{ app_url_fever }}/expert_point', score);
	});
	
	$('.ui.product.buttons .item').tab();
	
	$('[data-countdown]').each(function() {
		var $this = $(this), finalDate = $(this).data('countdown');
		$this.countdown(finalDate, function(event) {
			$this.html(event.strftime('<div class="item"><div class="count">%D<span>天</span></div></div><div class="item"><div class="count">%H<span>时</span></div></div> <div class="item"><div class="count">%M<span>分</span></div></div><div class="magenta item"><div class="count">%S<span>秒</span></div></div>'));
		});
	});
	
    $('.ui.tabox').smint({
    	'scrollSpeed' : 1000
    });
	
	// 分享
	$('.ui.share.button').bind('click', function(){
		$('.ui.share.modal').modal('show');
	});
	
{% endblock %}

{% block content %}
<div id="votepage" class="ui social">
	<div class="ui responsive grid">
		<div class="middle aligned row">
			<div class="eleven wide column">
				<div class="ui medium breadcrumb">
				  	<a class="ui section link" href="{{ app_url_domain }}">
						<i class="home icon"></i> 首页
					</a>
				  	<i class="angle right icon divider"></i>
				  	<a class="ui section link" href="{{ app_url_fever }}">创意投票</a>
				  	<i class="angle right icon divider"></i>
				  	<div class="active section">{{ product.title }}</div>
				</div>
			</div>
			
			<div class="five wide right aligned column">
				<div class="ui pop icon black share button" data-content="分享" data-variation="inverted">
					<i class="share icon"></i>
				</div>
				{% if visitor.is_admin %}
				<div class="ui black top right pointing dropdown icon button">
				  	<i class="ellipsis vertical icon"></i>
				  	<div class="menu">
			          	<a class="item ajax" href="{{ app_url_fever }}/ajax_approved?id={{ product._id }}">
							<i class="checkmark icon"></i> 通过审核
						</a>
			          	<a class="item" href="{{ app_url_fever }}/edit?id={{ product._id }}">
							<i class="edit icon"></i> 编辑创意
						</a>
			          	<a class="item" href="{{ app_url_fever }}/edit?id={{ product._id }}">
							<i class="remove icon"></i> 删除创意
						</a>
				  	</div>
				</div>
				{% endif %}
			</div>
		</div>
	</div>
	
	<div class="product params">
		<div class="ui responsive grid">
			<div class="row fever-view">
				<div class="eight wide cover column">
					<img src="{{ product.cover.thumbnails.large.view_url }}" alt="{{ product.title }}" />
				</div>
				
				<div class="eight wide column">
					<h2 class="ui dividing header">
						<div class="content">
							{{ product.title }}
							<div class="sub header">
								<a href="{{ product.user.home_url }}" class="ui link" title="{{ product.user.nickname }}">
									{{ product.user.nickname }}
								</a>
							</div>
						</div>
					</h2>
				
					{% if !product.expert_assess %}
					<div class="vote box">
						<div class="ui divided horizontal timer list" data-countdown="{{ product.voted_finish_time|date 'Y/m/d H:i:s' }}"></div>
						<div class="ui vote buttons">
							<div href="{{ app_url_fever }}/ajax_favor?id={{ product._id }}" class="ui active green button">
								<i class="flat support icon"></i>
							</div>
							
							<div class="ui dropdown green button">
							  	<i class="flat oppose icon"></i>
							  	<div class="menu">
									<a href="{{ app_url_fever }}/ajax_oppose?id={{ product._id }}&r=1" class="item ajax">
										没有兴趣
									</a>
									<a href="{{ app_url_fever }}/ajax_oppose?id={{ product._id }}&r=2" class="item ajax">
										有类似的产品和创意
									</a>
									<a href="{{ app_url_fever }}/ajax_oppose?id={{ product._id }}&r=3" class="item ajax">
										不是一个消费产品
									</a>
							  	</div>
							</div>
						</div>
						
						<div class="ui clearing divider"></div>
						<!--最新投票者列表-->
						<div class="vote people">
							<div class="avatars" id="product-vote-people">
								{% vote_list var:'votelist' target_id:product._id size:8 %}
								{% for vote in votelist.rows  %}
								<a class="ui small avatar image" href="{{ vote.user.home_url }}" title="{{ vote.user.nickname }}">
									<img src="{{ vote.user.small_avatar_url }}" alt="{{ vote.user.nickname }}" />
								</a>
								{% endfor %}
							</div>
							<div class="ui rules grid">
								<div class="left floated eight wide column">
									<span id="product-vote-count">{{ product.vote_count }}</span>人已投票
								</div>
								<div class="right aligned floated eight wide column">
									<a href="{{ app_url_helper }}/rule" class="ui link">投票及评分规则</a>
								</div>
							</div>
						</div>
						
					</div>
					
					
					
					{% else %}			
					<div class="ui middle aligned grid">
						<div class="eleven wide column">
							<div class="ui horizontal list">
								<div class="design item">
									<div data-note="{{ product.score.design }}" id="note_0" class="notesite">
										<div class="percent">
											<span class="int">{{ product.score.design_int }}</span>
											<span class="dec">.{{ product.score.design_dec }}</span>
										</div>
										<div class="gt50" id="slice">
											<div class="pie" style="transform: rotate({{ product.score.design_deg }}deg);"></div>
											<div class="pie fill" style="transform: rotate({{ product.score.design_deg }}deg);"></div>
										</div>
									</div>
								</div>
							
								<div class="usability item">
									<div data-note="{{ product.score.usability }}" id="note_2" class="notesite">
										<div class="percent">
											<span class="int">{{ product.score.usability_int }}</span>
											<span class="dec">.{{ product.score.usability_dec }}</span>
										</div>
										<div class="gt50" id="slice">
											<div class="pie" style="transform: rotate({{ product.score.usability_deg }}deg);"></div>
											<div class="pie fill" style="transform: rotate({{ product.score.usability_deg }}deg);"></div>
										</div>
									</div>
								</div>
							
								<div class="creativity item">
									<div data-note="{{ product.score.creativity }}" id="note_1" class="notesite">
										<div class="percent">
											<span class="int">{{ product.score.creativity_int }}</span>
											<span class="dec">.{{ product.score.creativity_dec }}</span>
										</div>
										<div class="gt50" id="slice">
											<div class="pie" style="transform: rotate({{ product.score.creativity_deg }}deg);"></div>
											<div class="pie fill" style="transform: rotate({{ product.score.creativity_deg }}deg);"></div>
										</div>
									</div>
								</div>
							
								<div class="content item">
									<div data-note="{{ product.score.content }}" id="note_3" class="notesite">
										<div class="percent">
											<span class="int">{{ product.score.content_int }}</span>
											<span class="dec">.{{ product.score.content_dec }}</span>
										</div>
										<div class="gt50" id="slice">
											<div class="pie" style="transform: rotate({{ product.score.content_deg }}deg);"></div>
											<div class="pie fill" style="transform: rotate({{ product.score.content_deg }}deg);"></div>
										</div>
									</div>
								</div>
							
							</div>
							<div class="ui horizontal list-legend list">
						        <div class="design item">设计</div>
						        <div class="usability item">可用</div>
						        <div class="creativity item">创意</div>
						        <div class="content item">功能</div>
						        <div class="total bold item">平均分</div>
							</div>
						
						</div>
						<div class="five wide column">
							<input type="hidden" name="design" id="score_design" value="7" />
							<input type="hidden" name="usability" id="score_usability" value="8" />
							<input type="hidden" name="creativity" id="score_creativity" value="9" />
							<input type="hidden" name="content" id="score_content" value="10" />
						
							<div class="ui fluid active green button">评分</div>
						
							<div class="ui point title">设计评分</div>
							<div class="ui green point">
								<label class="button" data-value="1">1</label>
								<label class="button" data-value="2">2</label>
								<label class="button" data-value="3">3</label>
								<label class="button" data-value="4">4</label>
								<label class="button" data-value="5">5</label>
								<label class="button" data-value="6">6</label>
								<label class="button" data-value="7">7</label>
								<label class="button" data-value="8">8</label>
								<label class="button" data-value="9">9</label>
								<label class="two button" data-value="10">10</label>
							</div>
						
						</div>
					</div>
					{% endif %}
					
					<div class="ui clearing divider"></div>
					{% if product.tags_s %}
					<div class="vote highlight">
						<h4>创意亮点</h4>
						{% for tag in product.tags %}
						<label class="ui black label">{{ tag }}</label>
						{% endfor %}
					</div>
					{% endif %}
					
				</div>
			</div>	
		</div>
	</div>
	
	<div class="product promotion">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<div class="ui danger message">
						<i class="flat close icon"></i>
						<div class="ui header">
							<div class="picicon">
								<i class="bullhorn icon"></i>
							</div>
							<div class="content">
								关于投票成功与失败：
								<p class="sub header">
									这个项目必须在{{ product.voted_finish_time|date 'Y年m月d日 H:i' }}之前得到用户100个投票才能进入专家评估环节，否则视为失败。
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="ui tabox">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<div class="ui four tabs">
					  	<a class="active tab" href="#overview">创意介绍</a>
					  	<a class="tab" href="#inventor">设计者</a>
						<a class="tab" href="#reviews">讨论话题 ({{ product.topic_count }})</a>
						<a class="tab" href="#supporter">支持者 ({{ product.vote_count }})</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="product overview">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<div class="product content clearfix">
						{{ product.content }}
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="product inventor">
		<div class="ui responsive grid">
			<div class="row">
				<div class="nine wide column">
					<div class="inventor info">
						<h3 class="ui header">
							设计者
						</h3>
						<h4 class="ui header">
							<div class="content">
								{{ product.user.nickname }}
								<div class="sub header">
									{{ product.user.city }} {{ product.user.profile.job }}
								</div>
							</div>
						</h4>
						<div class="summary">
							{{ product.user.summary }}
						</div>
					</div>
				</div>
				<div class="one wide column"></div>
				<div class="six wide center aligned column">
					<div class="inventor avatar">
						<a href="{{ product.user.home_url }}" class="ui huge avatar image" >
							<img src="{{ product.user.big_avatar_url }}" alt="{{ product.user.nickname }}" />
						</a>
						<div class="actions">
							<button class="ui small white button">
								关注 
							</button>
							<button class="ui small white button">
								私信 
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="product reviews">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<h3 class="ui dividing header">
						讨论话题 <small>（{{ product.comment_count }}）</small>
					</h3>
					{% include "block/product_topic.html" %}
				</div>
			</div>
			<div class="row">
				<div class="center aligned column">
					<a href="{{ product.subject_view_url }}" class="ui black btn-4 btn-4c icon-arrow-right btn">
						查看更多
					</a>
					<a href="{{ product.subject_view_url }}#newtopic" class="ui magenta btn-4 btn-4c icon-arrow-right btn">
						发表新话题
					</a>
				</div>
			</div>
		</div>
	</div>
	
	<div class="product supporter">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					
					<!--最新投票者列表-->
					<h3 class="ui dividing header">
						支持者 <small>（{{ product.vote_count }}）</small>
					</h3>
					<div class="avatars" id="product-vote-people">
						{% vote_list var:'votelist' target_id:product._id size:8 %}
					    <div class="ui horizontal list">
							{% for vote in votelist.rows  %}
							<div class="item">
								<a class="ui large avatar pop image" href="{{ vote.user.home_url }}"  data-content="{{ vote.user.nickname }}" data-variation="inverted">
									<img src="{{ vote.user.medium_avatar_url }}" alt="{{ vote.user.nickname }}" />
								</a>
								<div class="content">
									<a class="ui link" href="{{ vote.user.home_url }}">{{ vote.user.nickname }}</a>
							      	<div class="sub header">
									  	{{ vote.user.city }}
								  	</div>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>
					
				</div>
			</div>
		</div>
	</div>
	
</div>
{% include "block/sharebox.html" %}
{% endblock %}