{%extends 'layout/mobile.html'%}
{% block title%}现在登录-{% endblock %}
{% block page_css %}
<style type="text/css">
.sign-up {
	text-align: center;
}
body{
  min-height:100%;
  height:auto;
  background:url({{ app_url_packaged }}/images/landbj.jpg) center center no-repeat;
  background-size:cover;
}
#mfrbird {
    height: 480px;
    margin: 0;
    width: 100%;
    top: 50%;
    position: absolute;
    margin-top: -250px;
}
.ui.wap,.mmfoot{
  display:none;
}
.ui.log-in>.ui.header.logo {
  background-color: #F2F2F2;
  padding: 0;
  text-align: center;
}
.ui.bottom.attached{
  height:379px;
  position:relative;
  padding-top:25px;
}
.third.login{
  position: absolute;
  bottom: 0;
  width: 100%;
  left: 0;
  padding: 20px 40px;
  text-align:center;
}
.third.login .three.fields{
  font-size:0;
}
.third.login .inline.field{
  display:inline-block;
  width:33.33%;
}
.third.login .inline.field i.icon{
  height:1em;
}
</style>
{% endblock %}

{% block layout_js %}
  <script type="text/javascript">

  </script>
{% endblock %}

{% block jquery %}
  phenix.build_auth_page();
	
	var wait = 60,can_send=true;
	var limitime = function(){
		if(wait == 0){
			can_send = true;
			wait = 60;
			$('#fetch-verify-code').removeClass('active').text('获取验证码');
		}else{
			can_send = false;
			
			wait--;
			$('#fetch-verify-code').addClass('active').text('重新发送('+wait+')');
			setTimeout(function(){
				limitime();
			}, 1000);
		}
	}
		
	$('#fetch-verify-code').click(function(){
		var phone = $('#account').val();
		if(!can_send){
		    return false;
		}
		if(phone){
	        // 先输入验证码再发送
	        var captcha = $('#captcha').val();
	        if(captcha == ''){
			    phenix.show_error_note('请先输入验证码！');
	    	    return false;
	        }
	        // 验证验证码
	        var url = '/app/site/captcha/check';
	        $.get(url, {code: captcha, type: 0}, function(result){
			  if(result == '0'){
				  phenix.show_error_note('验证码不正确！');
				  // 刷新验证码
	          	  $('#captcha-img img').click();
	          	  return false;
	        }else{
            //验证手机是否注册过
            var check_phone_url = '/app/site/auth/check_account';
            $.get(check_phone_url, {phone: phone}, function(r){
              if(r == 1){
         			  phenix.show_error_note('手机号已存在！');
	    	        return false;     
              }else{
                // 添加发送频率
                limitime();
            
                $this = $('#fetch-verify-code');
                $.getJSON('/app/site/auth/verify_code', {'phone': phone}, function(result){
                  if(result.errorCode == 200){
                    $this.removeClass('disabled').text('获取验证码');
                  }
                });            
              }
            });

			  }
	        });
		}else{
			phenix.show_error_note('请正确填写手机号码！');
		}
	});

  $('.ui.no-weixin').click(function(){
    phenix.show_error_note('请使用微信客户端登录!');
    return false;
    phenix.redirect("{{ app_url_wap }}/auth/qr_code");
  });
{% endblock %}

{% block content %}
<div class="auth page">
	<div class="ui responsive grid">
		<div class="ui column width">
			<div class="ui log-in signup">
			  <div class="ui top attached header logo">
			    <a href="{{ app_url_wap }}" title="返回首页">
  					<img src="{{ app_url_packaged }}/images/auth-logo.png" />
  				</a>
  			</div>
				
				<div class="ui bottom attached segment">
				  <form action="{{ app_url_wap }}/auth/do_login" class="ui small top form" method="post" id="login-form">
				    <div class="field">
				      <input type="text" name="account" placeholder="手机号">
				    </div>
				    
				    <!-- 用户存在 输入密码 -->
				    
				    <!--
				    <div class="field">
				      <input type="password" name="password" id="password" placeholder="登录密码" />
				    </div>-->
				    
				    <!-- end -->
				    
				    <!-- 用户不存在 注册 -->
				    <div class="inline field">
  						<input type="text" name="captcha" placeholder="验证码" id="captcha" style="margin-top:-27px;width:48%;" />
              			<a href="javascript:void(0);" class="ui gray" id="captcha-img">
  							<img src="/app/site/captcha/view" onclick="this.src='/app/site/captcha/view?'+Math.random();" />
  						</a>
  					</div>
  					
  					<div class="inline field">
  						<input name="verify_code" type="text" placeholder="短信验证码" id="verify_code" style="width:48%;" />
  						<a href="javascript:void(0);" class="ui small inverted magenta button" id="fetch-verify-code">获取验证码</a>
  					</div>

  					<div class="field">
  						<input type="password" name="password" id="password" placeholder="设置至少6位登录密码" />
  					</div>
  					
  					<!-- end -->
				    
				    
				    
				    
				    
				    <div class="field ">
              <div class="fluid ui active magenta inverted submit button">登录/注册</div>
            </div>
            
            <!-- 登陆时存在  -->
            <div class="inline field">
              <a href="{{ app_url_wap }}/auth/forget" title="忘记密码？" class="ui link forgot">忘记密码？</a>
  					</div>
  					<!-- end -->
				  </form>
				  
				  
				  
				  
				  <!-- 第三方帐号登录 -->
				  <!-- 验证手机之后隐藏 -->
				  <div class="third login">
            <h4>第三方帐号登录</h4>
            
            <div class="ui center aligned three fields">
  						<div class="inline field" style="text-align:center;">
  							<a href="{{ weibo_auth_url }}" class="ui big weibo red circular share icon button">
  								<i class="large weibo icon"></i> 
  							</a>
  						</div>

  						<div class="inline field" style="text-align:center;">
                  <a href="{{ app_url_qq_login_wap }}" class="ui big qq blue circular share icon button">
                    <i class="large qq icon"></i>
                  </a>
  						</div>
  						<div class="inline field" style="text-align:center;">
                {% if is_weixin %}
  							<a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid={{wx_params.app_id}}&redirect_uri={{wx_params.redirect_uri}}&response_type=code&scope=snsapi_login&state={{wx_params.state}}" class="ui big green circular share icon button">
  								<i class="large weixin icon"></i>
  							</a>
                {%else%}
                <a href="javascript:void(0);" class="ui big green no-weixin circular share icon button">
  								<i class="flat large weixin icon"></i>
  							</a>
                {%endif%}
  						</div>
  					</div>
  					
				  </div>
				  
				  
				  <!-- end -->
				  
				  
				  
				  
				  
				</div>
			  
			  
			</div>
		</div>
	</div>
</div>
{% endblock %}
