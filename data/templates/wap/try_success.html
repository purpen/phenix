{%extends 'layout/mobile.html'%}
{% block title %}{% endblock %}
{% block page_css %}
<style type="text/css">
#mfrbird{
	margin-top:0;
	margin-bottom:0;
}
.try-top{
	position: relative;
	overflow: hidden;
  padding-bottom: 20px;
  background: #fff;
}
.blur-image-block {
  height: 248px;
  overflow: hidden;
  position: absolute;
  left: 0;
  top: 0;
  z-index: 1;
  width: 100%;
}
.blur-image-block .blur-image {
  margin: -4px;
  background-repeat: no-repeat;
  background-position: center top;
  background-size: cover;
  height: 100%;
  display: block;
}
.blur-image {
  filter: url(blur.svg#blur);
  -webkit-filter: blur(4px);
  -moz-filter: blur(4px);
  -ms-filter: blur(4px);
  filter: blur(4px);
  filter: progid:DXImageTransform.Microsoft.Blur(PixelRadius=4, MakeShadow=false);
}
.top-content .text-block {
  padding: 0 12px;
  line-height: 20px;
  color: #fff;
}
.top-content .text-block::before {
  height: 145px;
  display: inline-block;
  vertical-align: middle;
  content: "";
}
.top-content .round-bg {
  background-image: url("{{ app_url_packaged }}/images/round_bg.png");
  background-position: center top;
  background-repeat: no-repeat;
  height: 44px;
  position: absolute;
  top: 213px;
  width: 100%;
  background-size: 414px;
}
.top-content .avatar {
  width: 92px;
  height: 92px;
  display: inline-block;
  margin: 0 auto;
  border: 4px solid #fff;
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
  -ms-border-radius: 50%;
  -o-border-radius: 50%;
  border-radius: 50%;
}
.top-content .avatar img {
  width: 92px;
  height: 92px;
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
  -ms-border-radius: 50%;
  -o-border-radius: 50%;
  border-radius: 50%;
}
.top-content .avatar-name {
  position: relative;
  z-index: 3;
  padding-top: 20px;
}
.top-content .avatar-name span {
  color: #474747;
}
.top-content {
  position: relative;
  z-index: 5;
  text-align: center;
}
.say-con {
  padding: 0 12px;
  background: #fff;
}
.say-con p {
  padding: 11px;
  background: #f7f7f7;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  -ms-border-radius: 3px;
  -o-border-radius: 3px;
  border-radius: 3px;
  position: relative;
  font-size: 15px;
  color: #474747;
  font-weight: bold;
  line-height: 22px;
	margin:0;
}
.say-con p::before {
  content: '';
  position: absolute;
  display: block;
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 10px solid #f7f7f7;
  top: -7px;
  left: 35%;
  -webkit-transform: rotate(135deg);
  -moz-transform: rotate(135deg);
  -ms-transform: rotate(135deg);
  -o-transform: rotate(135deg);
  transform: rotate(135deg);
}
.myCard {
  background: #fff;
  padding: 24px 12px;
}
.myCard a{
	text-decoration: none;
}
.myCard .card {
  display: -moz-box;
  display: -webkit-box;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  background: #f7f7f7;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  -ms-border-radius: 3px;
  -o-border-radius: 3px;
  border-radius: 3px;
  overflow: hidden;
}
.myCard .pic {
  width: 80px;
  height: 80px;
  position: relative;
  float: left;
}
.myCard .pic img {
  width: 100%;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  -ms-border-radius: 3px;
  -o-border-radius: 3px;
  border-radius: 3px;
}
.myCard .des {
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  -moz-flex: 1;
  -o-flex: 1;
  flex: 1;
  display: block;
  position: relative;
  padding: 14px 12px;
  overflow: hidden;
}
.myCard .des .tit {
  color: #474747;
  height: 38px;
  overflow: hidden;
  text-overflow: ellipsis;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  display: -webkit-box;
	margin:0;
}
.myCard .des .xinxi {
  color: #f36;
  font-size: 12px;
	margin:0;
}
.myCard .des .xinxi span {
  position: relative;
  padding-left: 8px;
}
.myCard .des .xinxi span::before {
  content: '';
  position: absolute;
  width: 4px;
  height: 4px;
  background: #fe5341;
  top: 6px;
  left: 0;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  -ms-border-radius: 4px;
  -o-border-radius: 4px;
  border-radius: 4px;
}
.try-user{
	padding-bottom: 0px;
	background: #f7f7f7;
}
.try-user .tabTit {
  background: #fff;
  padding: 0 12px;
}
.try-user .show ul {
  display: -moz-box;
  display: -webkit-box;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
}
.tab .tabLabel {
  display: -moz-box;
  display: -webkit-box;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  -ms-border-radius: 5px;
  -o-border-radius: 5px;
  border-radius: 5px;
}
.try-user .show ul li {
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  -moz-flex: 1;
  -o-flex: 1;
  flex: 1;
  display: block;
  text-align: center;
}
.tab .tabLabel li {
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  -moz-flex: 1;
  -o-flex: 1;
  flex: 1;
  display: block;
  text-align: center;
}
.try-user .show ul li a {
  border: 1px solid #b8b7bb;
  -webkit-border-radius: 100%;
  -moz-border-radius: 100%;
  -ms-border-radius: 100%;
  -o-border-radius: 100%;
  border-radius: 100%;
  height: 80px;
  width: 80px;
  text-align: center;
  display: inline-block;
  color: #b8b7bb;
}
.try-user .show ul li a p {
  line-height: 30px;
	margin:0;
}
.try-user .show ul li a p {
  padding-top: 20px;
  font-size: 30px;
}
.try-user .show ul li a em {
  display: block;
  font-size: 12px;
}
.try-user .show ul li .tit {
  padding: 10px 0;
}
.tab .tabLabel li:last-child {
  border-right: 0 none;
}
.try-user .show ul .on {
  border-bottom: 2px solid #f36;
}
.noDis {
  display: none;
}
.try-user .rank {
  margin-bottom: 15px;
  padding: 10px 12px;
}
.try-user .rank .tips {
  color: #a3a3a3;
  font-size: 10px;
  padding: 2px 0 12px 0;
}
.try-user .rank li {
	display: inline-block;
  padding: 0;
}
.rank .avt {
  height: 32px;
}
.avt a {
  border: none!important;
}
.avt a {
  border-color: #fff !important;
}
.try-user .avt a {
  width: 30px;
  height: 30px;
  -webkit-border-radius: 30px;
  -moz-border-radius: 30px;
  -ms-border-radius: 30px;
  -o-border-radius: 30px;
  border-radius: 30px;
  border: 1px solid #fff;
  display: inline-block;
  background-size: 100%;
}
.try-user .ticket {
  color: #474747;
}
.try-user .ticket li {
  display: -moz-box;
  display: -webkit-box;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  padding: 10px 12px;
}
.try-user .ticket li .progressBar {
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  -moz-flex: 1;
  -o-flex: 1;
  flex: 1;
  display: block;
  padding: 0 20px;
}
.try-user .ticket li .progressBar .ticketInfo {
  overflow: hidden;
  line-height: 20px;
  height: 20px;
  margin: 0;
}
.try-user .ticket li .progressBar .ticketInfo .name i {
  width: 17px;
  height: 17px;
  display: inline-block;
  margin-left: 10px;
}
.try-user .ticket li .progressBar .ticketInfo .name i img {
  width: 100%;
}
.try-user .ticket li .progressBar .ticketInfo .progressNum {
  float: right;
  line-height: 20px;
  height: 20px;
}
.try-user .ticket li .progressBar .bar {
  background: #ebebeb;
  height: 2px;
  margin-top: 25px;
}
.try-user .ticket li .progressBar .bar span {
  display: block;
  height: 2px;
}
.try-user .ticket li:nth-child(even) {
  background: #fff;
}
ul,li{
	margin: 0;
	padding: 0;
	list-style: none;
}
ul a{
	text-decoration: none;
}
.layer {
  margin: 0;
  height: 72px;
  line-height: 72px;
}
.submitBtn {
  border: 0 none;
  padding: 0;
  display: -moz-box;
  display: -webkit-box;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
}
.layer {
  background: rgba(0,0,0,0.7);
  position: fixed;
  bottom: 0;
  width: 100%;
  z-index: 12;
}
.submitBtn .play {
  background: #80c269;
}
.layer a {
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  -ms-border-radius: 5px;
  -o-border-radius: 5px;
  border-radius: 5px;
}
.submitBtn a {
  position: relative;
}
.layer a {
  height: 46px;
  line-height: 46px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  -ms-border-radius: 10px;
  -o-border-radius: 10px;
  border-radius: 10px;
}
.submitBtn a {
  text-align: center;
  height: 46px;
  line-height: 46px;
  color: #fff;
  background: #fe5341;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  -ms-border-radius: 5px;
  -o-border-radius: 5px;
  border-radius: 5px;
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  -moz-flex: 1;
  -o-flex: 1;
  flex: 1;
  display: block;
  font-size: 20px;
}
.layer a {
  float: right;
  margin: 13px 15px 0 17px;
  color: #fff;
  text-decoration: none;
}
.shareLayer {
  background: rgba(0,0,0,0.5);
  position: fixed;
  bottom: 0;
  width: 100%;
  height: 100%;
  z-index: 13;
}
</style>
{% endblock %}

{% block layout_js %}
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">

    var m_name = '我正在申请【{{ try.short_title }}】免费试用,大家来为我拉票吧!';
    {% if try.cover %}
      var img_url = '{{ try.cover.thumbnails.resp.view_url }}';
    {%else%}
      var img_url = 'http://frstatic.qiniudn.com/images/logo/logo.png';
    {%endif%}
    var link = '{{ app_url_wap }}/try/apply_success?apply_id={{ apply._id }}';
    var desc_str = '太火鸟-新品试用';

    wx.config({
        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: '{{ app_id }}', // 必填，公众号的唯一标识
        timestamp: {{ timestamp }}, // 必填，生成签名的时间戳
        nonceStr: '{{ wxnonceStr }}', // 必填，生成签名的随机串
        signature: '{{ wxSha1 }}',// 必填，签名，见附录1
        jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideMenuItems'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
    });

  wx.ready(function(){
    // 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口
     wx.onMenuShareAppMessage({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
      }
    });      

    // 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口
    wx.onMenuShareTimeline({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
      }
    });

    // 2.3 监听“分享到QQ”按钮点击、自定义分享内容及分享结果接口
    wx.onMenuShareQQ({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
      }
    });

    // 2.4 监听“分享到微博”按钮点击、自定义分享内容及分享结果接口
    wx.onMenuShareWeibo({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
      }
    });
  });

  //记录分享数/同时送积分
  function record_share_num(){

  }

  //拉票排行
  function fetch_rank(){
    var url = "{{ app_url_wap }}/try/ajax_fetch_rank";
    var apply_id = "{{ apply._id }}";
    $.get(url, {apply_id:apply_id, type:1});
  }

</script>
{% endblock %}

{% block jquery %}

  //弹出登录框
	phenix.wap_show_sign_box('', 1);

$('.showdiv').click(function(){
    $('#mask').css('display','');
});
$('#mask').click(function(){
    $('#mask').css('display','none');
});

$(document).ready(function(){

        $('.tabLabel li').on('click', function(e){
            handleTab(e);
        });

        $('.InviteBtn a').on('click', function(e) {
            e.preventDefault();
            $('.bgLayer').addClass('cover');
        });

        function handleTab(e) {
            var oDiv = $('.tab');
            var target = e.currentTarget,
                index = $(target).index(),
                aBtn = $(target),
                aDiv = $(target).parent().parent().parent().parent().find('.tabCont > div:eq('+index+')');
            if($('.selTeam').length){
                $('.selTeam').removeClass('on');
                $('.teamListSel .state').addClass('noDis');
            }
            $(target).parent().find('li').removeClass('on');
            $(target).parent().parent().parent().parent().find('.tabCont > div').addClass('noDis');
            aBtn.addClass('on');
            aDiv.removeClass('noDis');
        }
        //loadApprove();

    });


$('[data-countdown]').each(function() {
	var $this = $(this), finalDate = $(this).data('countdown');
	$this.countdown(finalDate, function(event) {
		$this.html(event.strftime('%D天%H时%M分钟'));
	});
});

//我要支持
$('.support-btn').click(function(){
		// 所有ajax请求，验证是否登录
		if (!phenix.visitor.is_login){
      $('.ui.sign-box.modal').modal('show');
			return false;
		}
    var url = "{{ app_url_wap }}/try/ajax_support";
    var apply_id = "{{ apply._id }}";
    $.post(url, {apply_id:apply_id, type:1 });
});

//获取拉票排行
fetch_rank();

{% endblock %}
{% block content %}
<div class="try-top">
	<div class="blur-image-block">
		<i class="blur-image" style="background:url('{{ try.cover.thumbnails.resp.view_url }}');background-size: 100%"></i>
	</div>
	<div class="top-content">
		<div class="text-block"></div>
		<div class="round-bg"></div>
		<div class="avatar avatar-92">
			<img src="{{ apply.user.big_avatar_url }}">
		</div>	
		<div class="avatar-name">
      <span class="wish-name">{{ apply.user.nickname }}</span>
		</div>
	</div>
</div>
<div class="say-con">
	<p>
		我正在申请{{ try.title }}免费试用机会，
		{% if !try.is_end %}离投票结束还有
		<span data-countdown="{{ try.end_time|date 'Y/m/d H:i:s' }}"></span>，投我一票吧！
		{% else %}
		投票已结束！
		{% endif %}
	</p>
</div>
<div class="myCard">
	<a href="{{ try.view_url }}" title="{{ try.title }}" target="_blank">
		<div class="card">
			<div class="pic">
				<img src="{{ try.cover.thumbnails.resp.view_url }}" alt="{{ try.title }}" width="80" height="80">
			</div>
			<div class="des">
			  <p class="tit">{{ try.title }}</p>
        <p class="xinxi">
          <span>免费试用</span>
          <span>{{ try.try_count }} 台</span>
          <span>{{ try.apply_count }} 人申请</span>
         </p>
       </div>
		</div>
	</a>
</div>

<div class="try-user" id="rank-box">
  <!--ajax fetch rank-->
</div>


{% if !try.is_end %}
  {% if is_current_user %}
    <div class="layer submitBtn showdiv"><a class="play">立即拉票</a></div>
  {%else%}
    <div class="layer"><a href="javascript:void(0);" class="play support-btn">我要支持</a></div>
  {%endif%}
{%endif%}
<div id="mask" style="position: fixed; width: 100%; height: 100%; z-index: 100; top: 0px; opacity: 0.9; display: none; background: rgb(0, 0, 0);" align="center">
  <div class="shareLayer">
	<img src="{{ app_url_packaged }}/images/H5_htc.png" width="100%" >
  </div>
</div>
{% include "mm/loginbox.html" %}
{% endblock %}
