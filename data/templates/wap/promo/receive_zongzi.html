{%extends 'layout/mobile.html'%}
{% block title %}  {% endblock %}
{% block page_css %}
<style type="text/css">
html, body {
    margin:0;
    padding:0;
}
.ui.wap{
	display:none;
}
#mfrbird{
	margin:0;
}
* { -webkit-appearance: none; }

html, body { width: 100%; margin: 0px; }
section { display: block; height: 100%; }


</style>
{% endblock %}

{% block layout_js %}
  <script type="text/javascript">

  </script>
{% endblock %}

{% block jquery %}
    /* 表单验证 */
	$('#submit-form').form({
		phone: {
			identifier  : 'phone',
			rules: [
				{
					type   : 'empty',
					prompt : '请输入您的手机号码'
				}
			]
		},
		verify_code: {
			identifier  : 'verify_code',
			rules: [
				{
					type   : 'empty',
					prompt : '验证码不能为空!'
				},
				{
					type   : 'length[6]',
					prompt : '请输入6位验证码'
				}
			]
		},
		username: {
			identifier  : 'username',
			rules: [
				{
					type   : 'empty',
					prompt : '请输入您的真实姓名'
				}
			]
		},
		address: {
			identifier  : 'address',
			rules: [
				{
					type   : 'empty',
					prompt : '请输入您的邮寄地址'
				}
			]
		}
	}, {
		inline : true,
		onSuccess: function(event){
			event.preventDefault();
			$(this).ajaxSubmit({
				dataType: 'json',
				beforeSubmit: function(){
					phenix.before_submit();
				},
				success: function(data){
					phenix.after_submit();
					
					if(data.is_error){
						phenix.show_error_note(data.message, 5000);
					}else{
						phenix.redirect(data.redirect_url);
					}
					
				}
			});
		}
	});
	
	var wait = 60,can_send=true;
	var limitime = function(){
		if(wait == 0){
			can_send = true;
			wait = 60;
			$('#fetch-verify-code').removeClass('active').text('获取验证码');
		}else{
			can_send = false;
			
			wait--;
			$('#fetch-verify-code').addClass('active').text('重新发送('+wait+')');
			setTimeout(function(){
				limitime();
			}, 1000);
		}
	}
		
	$('#fetch-verify-code').click(function(){
		var phone = $('#account').val();
		if(!can_send){
		    return false;
		}
		if(phone){
      //验证手机是否注册过
      var check_phone_url = '/app/site/auth/check_account';
      $.get(check_phone_url, {phone: phone}, function(r){
        if(r == 1){
          phenix.show_error_note('手机号已存在！');
          return false;     
        }else{
          // 添加发送频率
          limitime();
      
          $this = $('#fetch-verify-code');

          $.post('/app/site/auth/verify_code', {'phone': phone, 'code': "{{ captcha_code }}"}, function(result){
            if(result.errorCode == 200){
              $this.removeClass('disabled').text('获取验证码');
            }           
          }, 'json');

        }
      });
		}else{
			phenix.show_error_note('请正确填写手机号码！');
		}
	});
{% endblock %}

{% block content %}

  <div class="auth page">
    <div class="ui responsive grid">
      <div class="row">
        <div class="column">
          <form action="{{ app_url_wap }}/app/wap/promo_func/save_receive_zz" class="ui small form segment" method="post" id="submit-form">
            <input type="hidden" name="t" value="{{ login_token }}" />
            <h4 class="center aligned ui dividing header">
              添写联系方式
            </h4>
            
            <div class="field">
              <input type="text" name="phone" placeholder="手机号码" id="phone" />
            </div>

            <div class="inline field">
              <input name="verify_code" type="text" placeholder="短信验证码" id="verify_code" style="width:48%;" />
              <a href="javascript:void(0);" class="ui small magenta button" id="fetch-verify-code">获取验证码</a>
            </div>
            <div class="field">
              <input type="text" name="username" placeholder="真实姓名" id="username" />
            </div>
            <div class="field">
              <input type="text" name="address" placeholder="完整的邮寄地址" id="address" />
            </div>
            
            <div class="field">
                <div class="fluid ui active magenta submit button" >提交</div>
            </div>
          </form>

        </div>
        
      </div>
    </div>
  </div>


{% endblock %}
