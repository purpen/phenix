{%extends 'layout/mobile.html'%}
{% block title%}试用福利-{% endblock %}
{% block page_css %}
<style type="text/css">
  .draw{width:320px; height:320px; position:relative; margin:20px auto;overflow:hidden;}
  #disk{width:320px; height:320px; background:url({{ app_url_packaged }}/images/promo/draw1.png) no-repeat;background-size:cover;}
  #start{width:30%; height:30%; position:absolute; top:35%; left:35%;}
  #start img{cursor:pointer;width:100%}
  .ui.red.button{
    margin:5px;
  }
</style>
{% endblock %}

{% block layout_js %}
  <script type="text/javascript" src="http://frstatic.qiniudn.com/wechat/jsjQueryRotate.2.2.js"></script>

{% endblock %}

{% block jquery %}

  	var rotateTimeOut = function (){
  		$('#disk').rotate({
  			angle:0,
  			animateTo:2160,
  			duration:8000,
  			callback:function (){
  				alert('网络超时，请检查您的网络设置！');
  			}
  		});
  	};
  	var bRotate = false;

  	var rotateFn = function (awards, angles, txt){
  		bRotate = !bRotate;
  		$('#disk').stopRotate();
  		$('#disk').rotate({
  			angle:0,
  			animateTo:angles+1800,
  			duration:8000,
  			callback:function (){
          $('.content .desc').text(txt);
  				$('.ui.drawmes.modal')
          .modal('setting', 'closable', false)
          .modal('setting', 'transition', 'vertical  flip')
          .modal('show');
  				//alert(txt);
  				bRotate = !bRotate;
  			}
  		})
  	};


  // 抽奖点击事件
  $('#start').click(function(){
		// 所有ajax请求，验证是否登录
		if (!phenix.visitor.is_login){
      phenix.redirect('{{ app_url_wap }}/auth/login');
      return;
    }
    var url = "{{ app_url_wap }}/app/wap/promo_func/fetch_draw";
    $.post(url, {type: 1}, function(result){
      if(result.success){
        // 是否可以分享再玩
        if(result.data.can_play==1){
          $('.share_show').show();
        }else{
          $('.share_show').hide();
        }
        rotateFn(result.data.id, result.data.code, result.data.desc);
      }else{
        phenix.show_error_note(result.message);
      }
    
    }, 'json');
  });
  
  //分享
  $('.red.fenxiang').click(function(){
      $('#mask').css('display','');
  });
  $('#mask').click(function(){
      $('#mask').css('display','none');
  });

{% endblock %}

{% block content %}
<div class="draw">
  <div id="disk"></div>
  <div id="start"><img src="{{ app_url_packaged }}/images/promo/draw3.png" id="startbtn"></div>
</div>


<!-- 弹出层   -->
<div class="ui drawmes small modal transition">
  <div class="header" style="position:relative;">
	   试用抽奖
	    <i class="close icon" style="right: 0.5em !important;top: 0.5em !important;position:absolute;width: 30px;height: 30px;z-index:3;"></i>
	</div>
  <div class="container">
    <div class="content" style="text-align:center;">
      <p class="desc"></p>
      <a class="ui red fenxiang deny button" style="display:none;">
      					分享再玩一次
      </a>
      <br/>
      <a class="ui red deny button">
      					前往兑换中心
      </a>
      <br/>
      <a class="ui red deny button">
      					直接申请云马试用
      </a>
    </div>
      
  </div>
</div>
<div id="mask" style="position: fixed; width: 100%; height: 100%; z-index: 100; top: 0px; opacity: 0.9; display: none; background: rgb(0, 0, 0);">
  <div class="frideshare">
	<img src="http://frstatic.qiniudn.com/images/fenxiang.png" width="100%" >
  </div>
</div>
{% endblock %}
