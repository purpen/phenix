{%extends 'layout/weixin.html'%}
{% block title %}{% endblock %}
{% block page_css %}
<style type="text/css">
.loading{
	background: url({{ app_url_packaged }}/images/promo/mini/loading2.jpg);
	background-size: cover;
	position: absolute;
	top: 0;
    left: 0;
}
.loading__inner{
    background-color:rgba(0,0,0,0); 
	position: absolute;
    top: 50%;
    left: 50%;
}
.loading-num{
    position: absolute;
    left: 50%;
    margin-left: 14px;
    top: 50%;
    text-align: center;
    width: 40px;
    height: 12px;
    margin-top: -32px;
}
.screen__bg {
	background-size: 100%;
	position: absolute;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	background-repeat: no-repeat;
	background-position: center bottom;
}
.screen1 .screen__bg{
	background-image: url({{ app_url_packaged }}/images/promo/mini/p1.jpg);
	background-color:#e1e3e4; 
}
.screen2 .screen__bg{
	background-color: #17181a;
}
</style>
{% endblock %}
{% block layout_js %}
<script type="text/javascript">
    /* 加载 */
    var basePath = "{{ app_url_packaged }}/images/promo/mini/";
    if (!(typeof webpsupport == 'function')) {
        var webpsupport = function (cb) {
            cb();
        }
    }
    webpsupport(function (webpa) {
    var loader = new WxMoment.Loader(),
     fileList =[
		'loading2.jpg','p1.jpg'
	];
     
     for (var i = 0; i < fileList.length; i++) {
         var basename = fileList[i].substring(fileList[i].lastIndexOf('/') + 1);

         if (webpa && img_map && (basename in img_map) && img_map[basename]) { //if webp
             var path = fileList[i].replace(/\.\w+/, '.webp');
         } else {
             var path = fileList[i];
         }

         loader.addImage(basePath + path);
         $('#app_bgm').get(0).pause();
     }

     loader.addCompletionListener(function () {
         $('.loading').remove();
         $('.screen').eq(0).addClass('current');
         $('.wrap').show();
         //$('#app_bgm').get(0).play();
         //$('.music').show();
     });

     //loading 进度监听
     loader.addProgressListener(function (e) {
         var percentUp = Math.round((e.completedCount / e.totalCount) * 100), //正序, 1-100
             progressDown = 100 - percentUp;                                   //倒序, 100-1
         $('.loading-num').text(percentUp + '%');
     });

     //启动
     loader.start();
    });
    /*
    // 微信分享统计
    var m_name = '[ 创 x 造 ] 京东众筹BIGGER大会';
    var img_url = '{{ app_url_packaged }}/images/promo/coin/2.pic2.jpg';
    var link = '{{ app_url_wap }}/promo/ym';
    var desc_str = '跨界融合 · 裂变重生，一场极具高逼格的众筹新品牌运动盛宴。';

    wx.config({
        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: '{{ app_id }}', // 必填，公众号的唯一标识
        timestamp: {{ timestamp }}, // 必填，生成签名的时间戳
        nonceStr: '{{ wxnonceStr }}', // 必填，生成签名的随机串
        signature: '{{ wxSha1 }}',// 必填，签名，见附录1
        jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideMenuItems'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
   });

	wx.ready(function(){
    // 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口
     wx.onMenuShareAppMessage({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
        $('.loading').remove();
        $('.wrap').show();
      }
    });      

    // 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口
    wx.onMenuShareTimeline({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
      }
    });

    // 2.3 监听“分享到QQ”按钮点击、自定义分享内容及分享结果接口
    wx.onMenuShareQQ({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
      }
    });

    // 2.4 监听“分享到微博”按钮点击、自定义分享内容及分享结果接口
    wx.onMenuShareWeibo({
      title: m_name,
      desc: desc_str,
      link: link,
      imgUrl: img_url,
      success: function (res) {
        record_share_num();
      }
    });
  });

  //记录分享数
  function record_share_num(){
    var url = '{{ app_url_wap }}/app/site/promo/ajax_stat_sum_record';
    $.get(url, { target_id: 23, count_name:'count', type: 4, kind:4 });
  }
*/
</script>

{% endblock %}
{% block content %}
<img src="{{ app_url_packaged }}/images/promo/coin/2.pic2.jpg" style="display:none;">
<div class="wrap"  style="display: none">
	<section class="screen screen1">
		<div class="screen__bg"></div>
	</section>
	<section class="screen screen2">
		<div class="screen__bg"></div>
	</section>
</div>
<div class="music playing" style="display:none;"></div>
<audio id="app_bgm" src="" loop="true" autoplay></audio>
{% endblock %}