{%extends 'layout/shop.html'%}
{% block title%}商城-{% endblock %}
{% block page_css %}
<style type="text/css">
.sfooter.nav-menu{
	display: none;
}
body {
    position: relative;
    margin: 0 auto!important;
    width: 10rem;
}
*, :after, :before {
    box-sizing: inherit;
}
#lottery{
    width:10.0rem;
	height:12.8rem;
    margin:0 auto;
    background:url({{ app_url_packaged }}/images/fiushop/drew/dbg.jpg) no-repeat;
    background-size:cover;
    /*padding: 0.73rem 0.7981rem;*/
    padding: 3.533333rem 0.84rem 0;
}

#lottery table td{
    text-align:center;
    vertical-align:middle;
    color:#333;
    font-index:-999;
    position: relative;
}
#lottery table{
    width: 8.32rem;
    height: 8.32rem;
    background: #d82622;
}
#lottery table td img{
    /*width:2.02rem;
    height:2.02rem;*/
    width:2.733333rem;
    height:2.73333rem;
    vertical-align: middle;
}
.d1{
    background-image: url({{ app_url_packaged }}/images/fiushop/drew/d1.jpg);
    width:2.733333rem;
    height:2.73333rem;
    vertical-align: middle;
    background-repeat: no-repeat;
    background-size: cover;
}
#lottery table td a{
    width:2.733333rem;
    height:2.733333rem;
    display:block;
    background:url({{ app_url_packaged }}/images/fiushop/drew/go.jpg) no-repeat;
    background-size:cover;
    text-decoration:none;
    vertical-align: middle;
}
#lottery table td.active{
    /*background-color:#ea0000;*/
    background:#d82622; 
}
#lottery table td .active{
    position: absolute;
    top: 0;
    left: 0;
    display: none;
    width: 100%;
    height: 100%;
}
#lottery table td.active .active{
    display: block;
}

.ui.modalt.page{
    background: rgba(0,0,0,0.5);
    width: 100%;
    height: 100%;
    position: fixed;
    top: 0;
    left: 0;
    text-align: center;
    display: none;
}
@-webkit-keyframes zoomIn {
    0% {
        opacity: 0;
        -webkit-transform: scale3d(.3,.3,.3);
        transform: scale3d(.3,.3,.3)
    }

    50% {
        opacity: 1
    }
}

@keyframes zoomIn {
    0% {
        opacity: 0;
        -webkit-transform: scale3d(.3,.3,.3);
        transform: scale3d(.3,.3,.3)
    }

    50% {
        opacity: 1
    }
}
@-webkit-keyframes fadeIn {
    0% {
        opacity: 0;
    }

    50% {
        opacity: 1
    }
}

@keyframes fadeIn {
    0% {
        opacity: 0;
    }

    50% {
        opacity: 1
    }
}
.ui.modalt.page.show{
    animation: 0.3s fadeIn 1s both;
    -webkit-animation: 0.3s fadeIn 1s both;
    display: block;
}
.address.messge{
    width:8.32rem;
    height: 8.626667rem;
    position: fixed;
    top: 3.4rem;
    left: 0.84rem;
    background-image: url({{ app_url_packaged }}/images/fiushop/drew/modal.png);
    background-size:cover;
    color: #d82622;
    display: none;
}
.bounds.messge{
    width:8.32rem;
    height: 5.066667rem;
    position: fixed;
    top: 5.266667rem;
    left: 0.84rem;
    background-image: url({{ app_url_packaged }}/images/fiushop/drew/modalt.png);
    background-size:cover;
    color: #d82622;
    display: none;
}
.ui.messge.show{
    animation: 0.3s zoomIn 1.1s both;
    -webkit-animation: 0.3s zoomIn 1.1s both;
    display: block;
}
.ui.messge .close{
    width: 1.066667rem;
    height: 1.066667rem;
    background-image: url({{ app_url_packaged }}/images/fiushop/drew/close.png);
    background-size:cover;
    position: absolute;
    right: -0.35rem;
    top: -0.35rem;
}
.ui.messge h2.ui.header{
    font-size: 0.586667rem;
    color: #d82622 !important;
    margin-top: 0.733333rem;
    margin-bottom: 0.066667rem;
}
.ui.messge p{
    font-size: 0.32rem;
    margin-top: 0.066667rem;
}
.ui.form{
    margin-top: 0.666667rem;
}
.ui.form .field{
    display: block;
    margin-bottom: 0.373333rem;
    font-size: 0;
}
.ui.form .field>label{
    font-size: 0.266667rem;
    display: inline-block;
    margin: 0;
    color: #d82622;
    text-transform: none;
    vertical-align: middle;
    font-weight: 400;
    line-height: 0.666667rem;
}
.ui.form .field>input{
    width: 4.533333rem !important;
    height: 0.666667rem;
    padding: 0 0.106667rem!important;
    margin:0 0 0 0.24rem !important;
    border-radius: 4px !important;
    font-size: 0.266667rem;
    line-height: 0.666667rem;
    border:1px solid rgba(216,38,34,0.5);
}
.ui.form .field>input:focus{
    border:1px solid rgba(216,38,34,0.8);
}
.ui.form .ui.submit.button{
    width: 4.533333rem;
    height: 0.746667rem;
    background:#d82622;
    color: #fff;
    font-size: 0.32rem;
    text-align: center;
    line-height: 0.746667rem; 
    padding: 0;
    margin: 0.4rem 0 0;
    border-radius: 4px;
}
.view.button{
    width: 4.533333rem;
    height: 0.746667rem;
    background: #d82622 !important;
    color: #fff !important;
    font-size: 0.32rem;
    text-align: center;
    line-height: 0.746667rem;
    padding: 0;
    margin: 0.853333rem 0 0;
    border-radius: 4px;
}
</style>
{% endblock %}

{% block layout_js %}
	<script type="text/javascript" src="{{ app_url_packaged }}/javascript/flexible.min.js"></script>

{% endblock %}
{% block jquery %} 
    var lottery = {
        index: -1, //当前转动到哪个位置，起点位置
        count: 0, //总共有多少个位置
        timer: 0, //setTimeout的ID，用clearTimeout清除
        speed: 20, //初始转动速度
        times: 0, //转动次数
        cycle: 50, //转动基本次数：即至少需要转动多少次再进入抽奖环节
        prize: -1, //中奖位置
        init: function(id) {
            if ($("#" + id).find(".lottery-unit").length > 0) {
                $lottery = $("#" + id);
                $units = $lottery.find(".lottery-unit");
                this.obj = $lottery;
                this.count = $units.length;
                $lottery.find(".lottery-unit-" + this.index).addClass("active");
            }
        },
        roll: function() {
            var index = this.index;
            var count = this.count;
            var lottery = this.obj;
            $(lottery).find(".lottery-unit-" + index).removeClass("active");
            index += 1;
            if (index > count - 1) {
                index = 0;
            }
            $(lottery).find(".lottery-unit-" + index).addClass("active");
            this.index = index;
            return false;
        },
        stop: function(index) {
            this.prize = index;
            return false;
        }
    };

    function roll() {
        lottery.times += 1;
        lottery.roll();
        var prize_site = $("#lottery").attr("prize_site");
        if (lottery.times > lottery.cycle + 10 && lottery.index== prize_site ) {
            var prize_id = $("#lottery").attr("prize_id");
            var prize_name = $("#lottery").attr("prize_name");
            var prize_event = $("#lottery").attr("prize_event");
            if ( prize_event == 3 ){
                $('.ui.messge p span').html(prize_name);
                $('.ui.modalt.page,.ui.address.messge').addClass('show');
            }else{
                $('.ui.modalt.page,.ui.bounds.messge').addClass('show');
                if( prize_id == 4 ){
                    $('.ui.bounds p span').html('30元现金红包');
                }else{
                    $('.ui.bounds p span').html('10元现金红包');
                }
            }
            clearTimeout(lottery.timer);
            lottery.prize = -1;
            lottery.times = 0;
            click = false;

        } else {
            if (lottery.times < lottery.cycle) {
                lottery.speed -= 10;
            } else if (lottery.times == lottery.cycle) {
                var index = Math.random() * (lottery.count) | 0;
                lottery.prize = index;
            } else {
                if (lottery.times > lottery.cycle + 10 && ((lottery.prize == 0 && lottery.index == 7) || lottery.prize == lottery.index + 1)) {
                    lottery.speed += 110;
                } else {
                    lottery.speed += 20;
                }
            }
            if (lottery.speed < 40) {
                lottery.speed = 40;
            }
            lottery.timer = setTimeout(roll, lottery.speed);
        }
        return false;
    }

    var click = false;

    $(function() {
        lottery.init('lottery');
        $("#lottery a").click(function() {
             if (click) {
                return false;
            } else {
                lottery.speed = 100;  
                var url ="{{ app_url_wap }}/promo/ajax_lottery";
                $.post(url, {uid: 1}, function(rs) { //获取奖品，也可以在这里判断是否登陆状态
                    if(rs.success){
                        $("#lottery").attr("prize_site", rs.data.prize_site);
                        $("#lottery").attr("prize_id", rs.data.prize_id);
                        $("#lottery").attr("prize_name", rs.data.prize_name);
                        $("#lottery").attr("prize_event", rs.data.event);
                        //lottery.index = rs.data.prize_id;
                        roll();
                        click = true;
                        return false;                   
                    }else{
                        phenix.show_error_note(rs.message, 3000);
                        return false;
                    }
                }, "json")
            }
        });
    });

    $('.close').click(function(){
        $('.ui.modalt.page,.ui.messge').removeClass('show');
    });
{% endblock %}
{% block content %}
<div class="container">
    <div id="lottery">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td class="lottery-unit lottery-unit-0"><img src="{{ app_url_packaged }}/images/fiushop/drew/d1.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
                <td class="lottery-unit lottery-unit-1"><img src="{{ app_url_packaged }}/images/fiushop/drew/d2.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
                <td class="lottery-unit lottery-unit-2"><img src="{{ app_url_packaged }}/images/fiushop/drew/d3.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
            </tr>
            <tr>
                <td class="lottery-unit lottery-unit-7"><img src="{{ app_url_packaged }}/images/fiushop/drew/d8.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
                <td class="active"><a href="javascript:void(0);"></a></td>
                <td class="lottery-unit lottery-unit-3"><img src="{{ app_url_packaged }}/images/fiushop/drew/d4.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
            </tr>
            <tr>
                <td class="lottery-unit lottery-unit-6"><img src="{{ app_url_packaged }}/images/fiushop/drew/d7.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
                <td class="lottery-unit lottery-unit-5"><img src="{{ app_url_packaged }}/images/fiushop/drew/d6.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
                <td class="lottery-unit lottery-unit-4"><img src="{{ app_url_packaged }}/images/fiushop/drew/d5.jpg"><img class="active" src="{{ app_url_packaged }}/images/fiushop/drew/active.png"></td>
            </tr>
        </table>
    </div>
</div>

<!-- 弹出层 -->
<div class="ui modalt page">

    <div class="ui address messge">
        <div class="close"></div>
        <h2 class="ui header">恭喜您</h2>
        <img src="{{ app_url_packaged }}/images/fiushop/drew/line.png" align="absmiddle" width="100%">
        <p>抽中<span></span>一个，请填写收货信息!</p>
        <form action=" " class="ui form" method="post">
            <div class="field">
                <label>姓名</label>
                <input type="text" name="name" value=" ">
            </div>
            <div class="field">
                <label>手机</label>
                <input type="text" name="phone" value=" " placeholder="填写手机号，方便信息核实">
            </div>
            <div class="field">
                <label>地址</label>
                <input type="text" name="address" value=" ">
            </div>
            <div class="ui inverted active submit button">
              确认收货地址
            </div>
        </form>
    </div>

    <div class="ui bounds messge">
        <div class="close"></div>
        <h2 class="ui header">恭喜您</h2>
        <img src="{{ app_url_packaged }}/images/fiushop/drew/line.png" align="absmiddle" width="100%">
        <p>抽中<span></span>，请去我的红包查看!</p>
        <a class="ui inverted active view button" href="">
              立即查看
        </a>
    </div>



</div>



{% endblock %}
