{%extends 'layout/mobile.html'%}
{% block title %}{{ topic.title }}-{% endblock %}
{% block page_css %}
<style type="text/css">
  .ui.comments .comment>.content>.laud {
    float: right;
  }	
</style>
{% endblock %}
{% block jquery %}
	phenix.hook_comment_page();
{% endblock %}
{% block content %}
<div id="topicpage">
	<section class="ui big block">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<div class="ui breadcrumb">
					  	<a class="section" href="{{ app_url_wap }}">
							<i class="icon home"></i>首页
						</a>
					  	<div class="divider"> / </div>
					  	<a class="section" href="{{ app_url_wap }}/social">社区</a>
					  	<div class="divider"> / </div>
					  	<a class="section" href="{{ app_url_wap }}/social/c{{ topic.category._id }}">{{ topic.category.title }}</a>
					  	<div class="divider"> / </div>
					  	<div class="active section">{{ topic.title|truncate 30 }}</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
						<div class="ui big topic segment">
							<div class="ui header">
								<div class="content">
									{{ topic.title }}
									<div class="sub header attribute">
										<span class="category"><a href="{{ app_url_topic }}/c{{ topic.category._id }}" class="ui magenta link">{{ topic.category.title }}</a></span> | 
										<span class="date">{{ topic.user.nickname }} 发表于 {{ topic.created_on|relative_datetime }}</span> | 
										<span class="count">浏览数: {{ topic.view_count }}</span>
									</div>
								</div>
							</div>
					
							{% if is_match_idea %}
							<div class="post">
								<div class="ui contest">
									<a href="{{ app_url_wap }}/dream" target="_blank" class="ui magenta link">太火鸟-十万火计产品创意与创新想法征集活动</a> 参赛作品
								</div>
							</div>
							{% endif %}
					
							<div class="post froala-element clearfix">
								{{ topic.description }}
							</div>
					
							{% if topic.tags %}
							<div class="tags">
								{% for tag in topic.tags %}
									{% if tag %}
									<a href="{{ app_url_domain }}/tag/{{ tag }}" class="ui icon link">
										<i class="tag icon"></i>{{ tag }}
									</a>
									{% endif %}
								{% endfor %}
							</div>
							{% endif %}
						</div>
				
					</div>
				</div>
			</div>
		</div>
	</section>

<div class="ui white background block">
  <div class="ui responsive grid">
    <div class="row">
				<div class="column">
				<a name="comment"></a>
				<div class="ui big reply segment">
					<div class="ui threaded minimal comments">
						{% comment_list var:'comments' page:page target_id:topic._id type:2 %}
						{% for comment in comments.rows %}
						<div class="comment" id="{{ comment._id }}">
							<a class="avatar" href="{{ comment.user.home_url }}">
								<img src="{{ comment.user.small_avatar_url }}" alt="{{ comment.user.nickname }}" />
							</a>
							<div class="content">
								<a class="author ui magenta link" href="{{ comment.user.home_url }}">{{ comment.user.nickname }}</a>
								<div class="metadata">
									<div class="date">{{ comment.created_on }}</div>
								</div>
								<div class="laud">
									<a class="ui link icon pop ajax" href="{{ app_url_comment }}/ajax_laud?id={{ comment._id }}" id="laud_{{ comment._id}}" data-content="有用" data-variation="inverted" >
										<i class="icon empty heart"></i>
									</a>
								</div>
								<div class="text">
									{{ comment.content }}
								</div>
								{% if visitor.is_login %}
								<div class="actions">
									<a class="reply showbox" href="#reply_{{ comment._id }}">回复</a>
                  {% if visitor.id==comment.user_id %}
									  <a class="delete confirm-request" href="{{ app_url_wap }}/app/site/comment/delete?id={{ comment._id }}">删除</a>
                  {% endif %}
								</div>
								<form class="ui reply hide form" action="{{ app_url_wap }}/app/site/comment/ajax_reply" method="post" id="reply_{{ comment._id }}">
									<input type="hidden" name="type" value="2" />
									<input type="hidden" name="comment_id" value="{{ comment._id }}" />
									<input type="hidden" name="target_id" value="{{ topic._id }}" />
									<div class="field">
										<textarea name="content" class="reply-content"></textarea>
									</div>
									<div class="ui active button magenta submit labeled icon">
										<i class="icon location"></i> 回复
									</div>
								</form>
								{% endif %}
							</div>
							
							{% if comment.reply %}
							<div class="comments">
								{% for reply in comment.reply %}
									<div class="comment">
										<a class="avatar" href="{{ reply.user.home_url }}" title="{{ reply.user.nickname }}">
											<img src="{{ reply.user.small_avatar_url }}" alt="{{ reply.user.nickname }}" />
										</a>
										<div class="content">
											<a class="author ui magenta link" href="{{ reply.user.home_url }}">{{ reply.user.nickname }}</a>
											<div class="metadata">
												<div class="date">{{ reply.replied_on }}</div>
											</div>
											<div class="text">
												{{ reply.content }}
											</div>
										</div>
									</div>
								{% endfor %}
							</div>
							{% endif %}
							
						</div>
						{% endfor %}
					</div>
					
          {% if visitor.is_login %}
					<div class="post comment">
						<p><a href="{{ visitor.home_url }}" class="ui link">{{ visitor.nickname }}</a> 发表回应</p>
						<form class="ui reply form" action="{{ app_url_wap }}/app/site/comment/do_save" method="post" id="comment-form">
							<input type="hidden" name="target_id" value="{{ topic._id }}" />
							<input type="hidden" name="type" value="2" />
							<input type="hidden" name="star" value="0" />
							<div class="field">
								<textarea name="content" class="comment-textarea" ></textarea>
								<div id="comment"></div>
							</div>
							<div class="right aligned column">
								<input type="submit" class="ui small magenta button" value="添加评论" />
							</div>

						</form>
					</div>
						{% else %}
							<div class="not login">
								<div class="ui grid">
									<div class="row">
										<div class="center aligned column">
											<a href="{{ app_url_wap }}/auth/signup" class="ui green btn-4 btn-4c icon-arrow-right checkout btn">注册</a> <a href="{{ app_url_wap }}/auth/login" class="ui magenta btn-4 btn-4c icon-arrow-right checkout btn">登录</a>
											<p class="ui gray text">注册登录后可发评论</p>
										</div>
									</div>
								</div>
							</div>
					{% endif %}

					
				</div>
				{% if comments.rows %}
				<div class="ui pagination">
					{% pager url:pager_url,total_rows:comments.total_rows,total_page:comments.total_page,current_page:page,var:'pager',pager_size:9 %}
					{%include 'block/pager.html'%}
				</div>
				{% endif %}
			</div>

					
				</div>


    </div>
  </div>
</div>


</div>
{% endblock %}
