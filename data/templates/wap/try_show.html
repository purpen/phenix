{%extends 'layout/mobile.html'%}
{% block title %}{{ try.title }}-{% endblock %}
{% block page_css %}
<style type="text/css">
	.try .masthead {
		{% if try.banner_id %}
		background: url("{{ try.banner.fileurl }}") no-repeat scroll center center / cover rgba(45, 53, 56, 1);
		{% else %}
	    background: no-repeat scroll center center / cover rgba(45, 53, 56, 1);
		{% endif %}
	    height: 500px;
		color: #fff;
	}
	.try h1.ui.header {
		font-size: 1.5rem;
	}
	.try .apply {
		margin-top: 1em;
	}
	.try .ui.btn:hover,.try .ui.btn{
		padding:1em 2em;
	}
	#trypage .product.people {
		margin: 1em auto;
	}
	.try .masthead .column {
		padding-top: 120px;
	}
	.try .masthead > .masthead-cover {
	    background-color: rgba(0, 0, 0, 0.15);
	    height: 100%;
	}
	.try .ui.header .sub.header {
		color: rgba(255, 255, 255, 0.9);
		font-size: 1.1rem;
	}
	.try .ui.list .count span{
		font-size:16px !important;
	}
	.try td.hide-on-mobile + td ,.try td.two.wide{
		display:none;
	}
	.try .ui.horizontal.list{
		text-align:center;
	}
	.try .ui.horizontal.list .ui.larg.avatar.pop.image + .content{
		min-width:60px;
	}
	
	
	
	/*.ui.tabox {
		border-bottom: 1px solid #e4e5e7;
		margin: 2.5em auto 1.5em;
	}
	.ui.tabox .ui.tabs {
		display: block;
		font-size: 0rem;
		width: 100%!important;
	}
	.ui.tabox .ui.four.tabs .tab {
		width: 25%;
	}
	.ui.tabox .ui.tabs .tab {
		border-bottom: 2px solid transparent;
		-webkit-box-sizing: border-box;
		-moz-box-sizing: border-box;
		box-sizing: border-box;
		cursor: pointer;
		color: #444;
		display: inline-block;
		font-size: 1rem;
		padding-bottom: .8%;
		padding-top: .8%;
		text-align: left;
		text-decoration: none;
	}
	.ui.tabox .ui.tabs .tab:hover, .ui.tabox .ui.tabs .active.tab{
		border-bottom: 2px solid #f36;
		color: #f36;
		-webkit-transition: all .3s ease-in-out 0s;
		transition: all .3s ease-in-out 0s;
	}
	.ui.tabox.smint.fxd {
		background-color: #fff;
		margin-top: 0;
		width: 100%;
		z-index: 99;
	}*/
	
	
	
</style>
{% endblock %}
{% block layout_js %}
<script type="text/javascript">

  var per_page = 10;
  function fetch_comment(current_page, per_page){
    var url = '{{ app_url_wap }}/app/site/comment/ajax_fetch_comment_wap';
    $.get(url, {target_id: {{ try._id }}, type: 3, page: current_page, per_page: per_page});
  }

</script>
{% endblock %}
{% block jquery %}
	$('.ui.applytry.btn').click(function(){
		// 所有ajax请求，验证是否登录
		if (!phenix.visitor.is_login){
			phenix.show_login_box();
			return false;
		}
		
		$('.ui.applytry.modal').modal('show');
		return false;
	});
	
	$('.ui.deny.button').click(function(){
		$('.ui.applytry.modal').modal('hide');
	});
	
	// 申请表地址信息
	$('.ui.district.dropdown').livequery(function(){
		$(this).dropdown();
	});
	
	$('.ui.province.dropdown').livequery(function(){
		$(this).dropdown({
			onChange : function(value, text){
				if (value) {
					$.get('{{ app_url_wap }}/app/site/address/ajax_fetch_districts', {id: value});
				}
			}
		});
	});
	
	$('.ui.district.dropdown').livequery(function(){
		$(this).dropdown();
	});
	
	$('#apply-form').livequery(function(){
		$(this).form({
			name: {
				identifier  : 'name',
				rules: [
					{
						type   : 'empty',
						prompt : '姓名不能为空'
					}
				]
			},
			phone: {
				identifier  : 'password',
				rules: [
					{
						type   : 'empty',
						prompt : '电话不能为空'
					},
					{
						type   : 'length[11]',
						prompt : '电话必须11位字符'
					}
				]
			},
			address: {
				identifier  : 'address',
				rules: [
					{
						type   : 'empty',
						prompt : '地址区域不能为空'
					}
				]
			},
			content: {
				identifier  : 'content',
				rules: [
					{
						type   : 'empty',
						prompt : '申请理由不能为空'
					}
				]
			}
		}, {
			inline : true,
			onSuccess: function(event){
				event.preventDefault();
				$(this).ajaxSubmit();
			}
		});
	});
	
	phenix.hook_comment_page();
	
	//ajax加载评论
	  fetch_comment(1, per_page);
	
	// ajax加载更多评论
	$('.ui.more.button').livequery(function(){
		$(this).click(function(){
			if (!$(this).hasClass('disabled')){
				var p = $(this).data('page');
				$.get('{{ app_url_wap }}/app/site/comment/ajax_fetch_list', {target_id: {{try._id}}, type:3, page:p});
			}
		});
	});
	
	$('.ui.tabox').smint({
    	'scrollSpeed': 1000
    });
	
	$('[data-countdown]').each(function() {
		var $this = $(this), finalDate = $(this).data('countdown');
		$this.countdown(finalDate, function(event) {
			$this.html(event.strftime('<div class="item"><div class="count">%D<span>&nbsp;天</span></div></div><div class="item"><div class="count">%H<span>&nbsp;时</span></div></div> <div class="item"><div class="count">%M<span>&nbsp;分</span></div></div><div class="magenta item"><div class="count">%S<span>&nbsp;秒</span></div></div>'));
		});
	});
	
    $('textarea.comment-textarea').maxlength({
        'feedback' : '.wordscount'
    });
{% endblock %}

{% block content %}
<div class="ui try" id="trypage"> 
	<div class="masthead">
		<div class="masthead-cover">
			<div class="ui responsive grid">
				<div class="column">
					<h1 class="ui header">
						<div class="content">
							{{ try.title }}
							<div class="sub header">
								{{ try.description }}
							</div>
						</div>
					</h1>
					<div class="ui buttons">
						{% if !try.is_end %}
						<a href="javascript:void(0);" class="ui white btn-4 btn-4c icon-arrow-right applytry btn">
							申请试用
						</a>
						{% else %}
						<a href="javascript:void(0);" class="ui active white btn-4 btn-4c icon-arrow-right btn">
							已结束
						</a>
						{% endif %}
						<a href="{{ try.product.wap_view_url }}" class="ui white btn-4 btn-4c icon-arrow-right btn" target="_blank">
							产品详情
						</a>
					</div>
					<div class="apply"><b class="big">{{ try.apply_count }}</b> 人预约{% if !try.is_end %}, 剩余时间：<div class="ui divided horizontal timer list" data-countdown="{{ try.end_time|date 'Y/m/d H:i:s' }}"></div>{% else %}, 结束时间：{{ try.end_time }}{% endif %}</div>
				</div>
			</div>
		</div>
	</div>
	
	<!--<div class="ui tabox">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<div class="ui four tabs">
					  	<a class="active tab" href="#overview">试用介绍</a>
					  	<a class="tab" href="#reviews">讨论 ({{ try.comment_count||default 0 }})</a>
						<a class="tab" href="#people">名单公布</a>
						<a class="tab" href="#report">试用报告</a>
					</div>
				</div>
			</div>
		</div>
	</div>-->
	
    <div class="product overview">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<div class="product content froala-element">
						{{ try.content }}
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="product reviews">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<h3 class="ui dividing header">
						讨论 <small>（{{ try.comment_count||default 0 }}）</small>
					</h3>
					
					<!--  讨论    -->
					<div class="ui big reply segment">
		              <!--ajax comment-->
		              <div id="comment-list"></div>
		              {% include "block/comment_box_wap.html" %}
		            </div>
				<!--  讨论    -->
				</div>
			</div>
		</div>
	</div>
	
	<div class="product people">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<h3 class="ui dividing header">
						试用达人
					</h3>
					
					{% if try.pass_users %}
					<div class="avatars" id="product-apply-people">
						{% user_list var:'userlist' user_ids:try.pass_users %}
					    <div class="ui horizontal list">
							{% for user in userlist  %}
							<div class="item">
								<a class="ui small avatar pop image" href="{{ user.home_url }}"  data-content="{{ user.summary|truncate 38 }}" data-variation="inverted">
									<img src="{{ user.medium_avatar_url }}" alt="{{ user.nickname }}" />
								</a>
								<div class="content">
								      <div class="header">
										  <a href="{{ user.home_url }}" class="ui link" target="_blank">{{ user.nickname }}</a>
									  </div>
								      <span>{{ user.city }}</span>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>
					{% else %}
					<div class="ui gray message">没有你的支持，这世界将失去一个伟大的产品!</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
	
	<div class="product report">
		<div class="ui responsive grid">
			<div class="row">
				<div class="column">
					<h3 class="ui dividing header">
						评测报告
					</h3>
					<div class="social">
						<table class="ui topic table">
							<tbody>
							{% topic_list var:'list' try_id:try._id time:'latest' %}
							{% for topic in list.rows %}
								{% include "block/report_item.html" %}
							{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="center aligned column">
          <!--<a href="{{ app_url_wap }}/social/report?tid={{ try._id }}" class="ui black btn-4 btn-4c icon-arrow-right btn" target="_blank">全部报告</a>-->
					<!--通过审核的用户才能提交报告-->
					{% if visitor.is_login %}
					<a href="{{ app_url_wap }}/social/submit?cid={{ report_category_id }}&tid={{ try._id }}" class="ui magenta btn-4 btn-4c icon-arrow-right btn" target="_blank">提交报告</a>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
	
</div>
{% include "block/apply_try.html" %}
{% endblock %}
