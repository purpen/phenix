{%extends 'layout/mobile.html'%}
{% block title%}{{ special_subject.title }}-{% endblock %}
{% block page_css %}
<style type="text/css">
	#mfrbird{
		margin-top:0;
	}

	.ui.speshare.grid>.row.iswidth{
	    margin-left: 10px;
	    margin-right: 10px;
	    width: auto!important;
	}
	.ui.speshare.grid>.row.iswidth:before {
	    content: '';
	    width: 94%;
	    height: 1px;
	    background: rgba(0,0,0,.1);
	    position: absolute;
	    top: 60px;
	    left: 3%;
	}
	.ui.speshare.grid>.row.iswidth .ui.support.button {
	    display: inline-block;
	    margin-right: 8px;
	    height: 44px;
	    line-height: 44px;
	    padding: 0!important;
	    background: 0 0;
	    font-weight: 400;
	}
	
	.ui.speshare.grid>.row.iswidth .ui.support.button .heart.icon {
	    font-size: 1.5em;
	    color: #f36;
	    height: 44px;
	    vertical-align: middle;
	    line-height: 44px;
	}
	.ui.speshare.grid>.row.iswidth .ui.support.button.active .empty.heart.icon:before {
	    content: "\f004";
	}
	.ui.speshare.grid>.row.iswidth .ui.support.button .love.count {
	    display: inline-block;
	    margin-left: 3px;
	    vertical-align: middle;
	}
	.ui.speshare.grid>.row.iswidth .ui.commenting {
	    display: inline-block;
	    height: 44px;
	    line-height: 44px;
	}
	.ui.speshare.grid>.row.iswidth .ui.commenting .comment.icon {
	    font-size: 1.5em;
	    height: 44px;
	    vertical-align: middle;
	    line-height: 42px!important;
	    margin-right: 0;
	    color: rgba(0,0,0,.5);
	}
	.ui.speshare.grid>.row.iswidth .ui.commenting .love.count{
	    display: inline-block;
	    margin-left: 3px;
	    vertical-align: middle;
	}
	.ui.speshare.grid>.row.iswidth .right.aligned {
	    float: right;
	}
	.ui.speshare.grid>.row.iswidth .right.aligned .topicshare {
	    display: none;
	}
	.ui.speshare.grid>.row.iswidth .right.aligned .topicshare a.share.btn i.icon.inverted {
	    background-color: transparent!important;
	    color: rgba(0,0,0,.4)!important;
	    text-align: center;
	    padding: 0!important;
	    height: 44px!important;
	    line-height: 44px!important;
	    vertical-align: middle;
	    margin: 0;
	    width: 1.8em!important;
	}
	.ui.speshare.grid>.row.iswidth .right.aligned .topicshare a.share.btn i.icon.inverted {
	    background-color: transparent!important;
	    color: rgba(0,0,0,.4)!important;
	    text-align: center;
	    padding: 0!important;
	    height: 44px!important;
	    line-height: 44px!important;
	    vertical-align: middle;
	    margin: 0;
	    width: 1.8em!important;
	}
	.specont{
		position:fixed;
		bottom:0;
		left:0;
		width:100%;
		background:#fff;
		z-index: 3;
	    padding: 2px 0;
	    max-width: 767px;
	    margin: 0 auto;
	}
	.specont i.icon{
		color:#f36 !important;
	}
	.specont .loveicon,.specont .shareicon,.specont .commenticon{
	    width: 60%;
	    padding: 10px 0;
	    margin: auto;
	}
	.specialshare{
		position: fixed;
	    width: 100%;
	    height: 100%;
	    z-index: 100;
	    top: 0;
	    display: none;
	    background: rgba(0,0,0,.9);
	}
	.speview .ui.title.header{
		font-size:16px;
		font-weight:400;
		margin-top: 2px;
		margin-bottom:5px;
	}
	.speview .ui.title.header .sub.header{
		font-size: 14px;
	    line-height: 20px;
	    margin-top: 10px;
	}
	
	.speview .recommend-topic{
		padding-top:0;
	}
	.speview .recommend-topic .recom-item .recom-cell.one:first-child{
		margin-top:0;
	}
	.speview .recommend-topic .recom-item .recom-cell.one{
		margin:8px 0;
	}
	.speview .recommend-topic .recom-item .recom-cell.one a{
		background:#fff;
	    padding-top: 0;
	    padding-bottom: 0;
	}
	.speview .recommend-topic .recom-item .recom-cell.one a h3.ui.header{
		font-size:14px;
		font-weight:0;
		height:36px;
		line-height:36px;
		text-overflow: ellipsis;
		white-space: nowrap;
		overflow:hidden;
		padding:0 8px;
		position:relative;
		margin: 0;
	}
	.speview .recommend-topic .recom-item .recom-cell.one a img{
		height:auto;
		top:36px;
	}
	.speview .recommend-topic .recom-item .recom-cell.one a .desc{
	    z-index: 2;
	    background: #fff;
	    height: 60px;
		text-align:left;
		line-height: 44px;
	    position: relative;
	    margin-top: 56%;
	}
	.speview .recommend-topic .recom-item .recom-cell.one a .desc .price{
		color:#f36;
		font-size:14px;
	}
	.speview .recommend-topic .recom-item .recom-cell.one a .desc .like{
		color: #5d6266;
	    position: absolute;
	    left: 7px;
	    top: 24px;
	    line-height: 36px;
	    font-size: 12px;
	    transform: scale(0.9);
	    -webkit-transform: scale(0.9);
	}
	.speview .recommend-topic .recom-item .recom-cell.one a .desc .magenta.button{
	    width: 80px;
	    height: 30px;
	    padding: 0;
	    line-height: 30px;
	    position: absolute;
	    right: 10px;
	    top: 50%;
	    margin-top: -15px;
	    margin-right: 0;
	}
</style>
{% endblock %}

{% block layout_js %}
<script type="text/javascript">

  var per_page = 10, sort = 0;
  function fetch_comment(current_page, per_page, sort){
    var url = '{{ app_url_wap }}/app/site/comment/ajax_fetch_comment_wap';
    $.get(url, {target_id: '{{ special_subject._id }}', type: 9, page: current_page, per_page: per_page, sort:sort});
  }

</script>
{% endblock %}

{% block jquery %}

	phenix.hook_comment_page('wap');

  //ajax加载评论
  fetch_comment(1, per_page, 0);

// 评论排序
$('.fitsort .ui.list .item').bind('click', function(){
    sort = parseInt($(this).data('sort'));
    $(this)
        .siblings().removeClass('active')
        .end()
        .addClass('active');
    fetch_comment(1, per_page, sort);
});
//分享
phenix.bind_share_list();

	/* 登录用户行为 */
	{% if visitor.is_login %}
		// 初始化互动，是否收藏、点赞
		
		// 验证点赞
		$.get('{{ app_url_wap }}/app/site/favorite/ajax_done', {id: {{special_subject._id}},type:9,event:2}, function(result){
			if (result.success) {
				if (result.data.loved) {
					$('.ui.support.button')
						.data('content', '取消支持')
						.data('mark', 'y')
						.addClass('active');
				}
			}
		}, 'json');

		/* 登录用户行为 */
	{% endif %}

	// 喜欢
	$('.ui.support.button').bind('click', function(){
		var id = $(this).data('id'),mark = $(this).data('mark'),$btn = $(this);
		// 所有ajax请求，验证是否登录
		if (!phenix.visitor.is_login){
      phenix.redirect("{{ app_url_wap }}/auth/login_signup");
			return false;
		}
		if (mark == 'n') {
			$.post('{{ app_url_wap }}/app/site/favorite/ajax_laud', {id: id, type:9}, function(result){
				if (result.success) {
					$btn
						.data('content', '取消赞')
						.data('mark', 'y')
						.addClass('active')									
						.html('<i class="empty heart icon"></i> <div class="love count">'+ result.data.love_count +'</div>');
				} else {
					phenix.show_error_note(result.message);
				}
			}, 'json');
		} else {
			$.post('{{ app_url_wap }}/app/site/favorite/ajax_cancel_laud', {id: id, type:9}, function(result){
				if (result.success) {
					$btn
						.data('content', '点赞')
						.data('mark', 'n')
						.removeClass('active')
						.html('<i class="empty heart icon"></i> <div class="love count">'+ result.data.love_count +'</div>');
				} else {
					phenix.show_error_note(result.message);
				}
			}, 'json');
		}
	});


//微信 qq 打开隐藏
var ua = navigator.userAgent.toLowerCase();
if (ua.match(/MicroMessenger/i)=="micromessenger" || ua.match(/QQ/i) == "qq"){
	$('.topicshare').css('display','none');
}else{
	$('.topicshare').css('display','block');
}

//点击评论icon 滚动到评论
$('.commenticon').click(function(){
	$('html,body').animate({scrollTop:$('#comment-box').offset().top - 100},500);
});
$('.loveicon').click(function(){
	$('html,body').animate({scrollTop:$('.ui.speshare.grid').offset().top },500);
});
$('.shareicon').click(function(){
	var ua = navigator.userAgent.toLowerCase();
	if (ua.match(/MicroMessenger/i)=="micromessenger" || ua.match(/QQ/i) == "qq"){
		$('.specialshare').css('display','block');
	}else{
		$('html,body').animate({scrollTop:$('.ui.speshare.grid').offset().top },500);
	}
});
$('.specialshare').click(function(){
	$(this).removeAttr('style');
});

$('.buy_now').click(function(){
  var url = $(this).attr('wap_view_url');
  return window.location.href=url;
});

{% endblock %}
{% block content %}
<div id="special-view">
  <img src="{{ special_subject.cover.thumbnails.aub.view_url }}" width="100%" align="absmiddle">
	<div class="ui responsive speview grid">
		<div class="row">
			<div class="column">
				<h4 class="ui title header">
          {{ special_subject.title }}
					<div class="sub header">
            {{ special_subject.summary }}
					</div>
				</h4>
			</div>
		</div>
		
		<div class="row">
			<div class="column">
				<div class="recommend-topic">
					<div class="recom-item">

            {% for d in products %}
						<div class="recom-cell one">
              <a href="{{ d.wap_view_url }}">
                <h3 class="ui header">{{ d.title }}</h3>
                <img class="lazy" data-original="{{ d.cover_url }}" src="{{ app_url_packaged }}/images/icon/load750-422.png" title="qweqw">
								<div class="desc">
                  <span class="price"> ¥ {{ d.sale_price }}</span><br/>
                  <span class="like">{{ d.love_count }}人喜欢</span>
									<div class="ui magenta inverted active button buy_now" wap_view_url="{{ d.wap_view_url }}">立即购买</div>
								</div>
							</a>
						</div>
            {%endfor%}
						
					</div>
				</div>
				
			
			</div>
		</div>
		
		
	</div>
	


	<div class="ui speshare grid" style="margin:0 0 10px;">
	    <div class="row iswidth">
	        <div class="eight wide column">
	            <div class="ui icon support button" data-variation="inverted" data-id="{{ special_subject._id }}"
	            data-mark="n">
	                <i class="empty heart icon">
	                </i>
	                <div class="love count">
	                    {{ special_subject.love_count|default 0 }}
	                </div>
	            </div>
	            <div class="ui commenting">
	                <i class="comment outline icon">
	                </i>
	                <div class="love count">
	                    {{ special_subject.comment_count|default 0 }}
	                </div>
	            </div>
	        </div>
	        <div class="eight right aligned wide column">
	            <div class="phenix-share topicshare">
	                <a href="javascript:void(0);" id="sina-share" class="ui weibo circular share icon btn"
	                title="新浪微博">
	                    <i class="large weibo icon circular red inverted">
	                    </i>
	                </a>
	                <a href="javascript:void(0);" id="qzone-share" class="ui qzone circular share icon btn"
	                title="QQ空间">
	                    <i class="large qq icon circular blue inverted">
	                    </i>
	                </a>
	            </div>
	        </div>
	    </div>
	</div>

	<div class="ui responsive grid" style="margin:0;padding:0;" id="postpage">
	    <div class="row pt-0">
	        <div class="block title">
	            全部评论
	            <small>
	                （{{ special_subject.comment_count|default 0 }}）
	            </small>
	            <div class="fitsort">
	                <div class="ui horizontal bulleted list">
	                    <a class="active item" href="javascript:void(0);" data-sort="0">
	                        默认
	                    </a>
	                    <a class="item" href="javascript:void(0);" data-sort="1">
	                        最新
	                    </a>
	                </div>
	            </div>
	        </div>
	        <div class="ui big reply segment">
            
	            <!--ajax comment-->
	            <div id="comment-list" style="padding-bottom:20px;">
	            </div>
	            {% include "block/comment_box_wap.html" %}
	        </div>
	    </div>
	
	</div>

	<!-- fixed -->
	<div class="specont">
		<div class="ui responsive grid">
			<div class="row pt-0 pb-0">
				<div class="ui center aligned five wide column">
					<div class="loveicon">
						<i class="empty heart icon"></i> {{ special_subject.love_count|default 0 }}
					</div>
				</div>
				<div class="ui center aligned six wide column">
					<div class="shareicon">
						<i class="external share icon"></i>
					</div>
				</div>
				<div class="ui center aligned five wide column">
					<div class="commenticon">
						<i class="comment outline icon"></i>{{ special_subject.comment_count|default 0 }}
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="specialshare">
		<img src="{{ app_url_packaged }}/images/fenxiang.png" width="100%">
	</div>
</div>
{% endblock %}
