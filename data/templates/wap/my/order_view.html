{%extends 'layout/shop.html'%}
{% block title%}订单详情-{% endblock %}
{% block page_css %}
<style type="text/css">
#mfrbird{
	margin-top:0;
}
h3.ui.header{
	font-weight:400;
}
.addressitem {
    display: block;
    padding: 0 !important;
    text-align: left;
}
.addressitem .item .content {
    display: flex;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: -webkit-box;
    align-items: center;
    -webkit-box-align: center;
    padding: 0.7145rem;
    background: #fff;
}
.addr {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    -ms-flex: 1;
    flex: 1;
    -webkit-flex-basis: 0;
    -ms-flex-preferred-size: 0;
    flex-basis: 0;
    flex-grow: 1;
    position: relative;
    margin-left: 0.35725rem;
    color: #5d6266;
}
.addr span {
    font-size: 0.92885rem;
    padding: 0.07145rem 0;
    display: block;
}
.cartitem {
    display: flex;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: -webkit-box;
    align-items: center;
    -webkit-box-align: center;
    background: #fff;
    padding: 10px;
    position: relative;
}
.column .cartitem+.cartitem{
	border-top:1px solid rgba(0,0,0,0.1);
}
.cartitem .img img {
    width: 80px;
    height: 60px;
    position: relative;
    border: 1px solid #eee;
}
.cartitem .cartinfo {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    -ms-flex: 1;
    flex: 1;
    -webkit-flex-basis: 0;
    -ms-flex-preferred-size: 0;
    flex-basis: 0;
    flex-grow: 1;
    position: relative;
    margin-right: 10px;
    margin-left: 10px;
}
.cartitem .cartinfo h3.title {
    font-size: 1rem;
    margin-bottom: 10px;
    max-height: 38px;
    overflow: hidden;
    font-weight: 400;
    color: #000;
}
.cartitem .cartinfo p.checkt {
    font-size: 12px;
    margin-bottom: 8px;
    color: #666;
}
.cartitem .cartinfo p.price {
    color: #be8914;
}
.cartitem .cartinfo p.price .rmb.icon {
    font-size: 14px;
    font-weight: 400;
    margin: 0;
    padding: 0;
    width: auto;
}
.desitem{
	background:#fff;
	font-size:0.92885rem;
	margin:0.7145rem 0;
	padding:0.7145rem;
	position:relative;
}
.desitem span{
	color: #000;
}
.ordertbtn{
	text-align: right;
    padding: 0;
    background: #fff;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
}
.ordertbtn .ui.button.color-be,.ordertbtn .ui.button.color-be:hover {
    box-shadow: 0 0 0 1px #be8914 inset!important;
    color: #be8914;
    font-weight: 400;
    padding: 0.5716rem 0.7145rem;
    margin: 0.7145rem 0;
    margin-left: 0.5716rem;
    font-size: 0.92885rem;
    background: transparent !important;
}
.ordertbtn .ui.button.color-bd,.ordertbtn .ui.button.color-bd:hover {
    box-shadow: 0 0 0 1px #ccc inset!important;
    color: #666 !important;
    font-weight: 400;
    padding: 0.5716rem 0.7145rem;
    margin: 0.7145rem 0;
    margin-left: 0.5716rem;
    font-size: 0.92885rem;
    background: transparent !important;
}
.ordertbtn .ui.button:last-child{
	margin-right:0.7145rem !important;
}
.color-be.link{
  color:#be8914 !important;
}
.ui.medel.color.button{
  width: 100%;
  margin: 5px 0;
  background: transparent !important;
  color: #666;
  box-shadow: 0 0 0 1px #eee inset,0 0 0 0 #eee inset!important;
}
.ui.server{
    width: 50%;
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    padding: 2px 6px 5px;
    margin: 4px;
    color: #999;
}
.ui.server .bgimg{
    display: block;
    margin: 1px auto 3px;
    vertical-align: middle;
    background-image: url({{ app_url_packaged }}/images/icon/serve.png);
    background-repeat: no-repeat;
    background-size: 18px 18px;
    height: 18px;
    width: 18px;
    background-position: 0 0;
}
.desitem.descrit span{
    font-size: 12px;
    display: block;
    color:#999;
}
span.kefu{
    display: inline-block;
    margin: 0 3px;
    vertical-align: middle;
    background-image: url({{ app_url_packaged }}/images/icon/serve.png);
    background-repeat: no-repeat;
    background-size: 18px 18px;
    height: 18px;
    width: 18px;
    background-position: 0 0;
}
.deal{
  color:#be8914;
  font-size: 12px;
  position:absolute;
  top: 50%;
  transform: translateY(-50%);
  -webkit-transform: translateY(-50%);
  right: 10px;
}
.mtbb{
  border-top: 1px solid rgba(0,0,0,0.1);
  border-bottom: 1px solid rgba(0,0,0,0.1);
}
.tx-r{
  text-align: right;
}
.detx{
  font-size: 12px;
  color: #797979;
  border-top: 1px solid rgba(0,0,0,0.1);
}
.dealesc .ui.button.color-bd,.dealesc .ui.button.color-bd:hover{
    font-weight: 400;
    padding: 0.5716rem 0.7145rem;
    margin: 0;
    margin-left: 0.5716rem;
    font-size: 0.92885rem;
    background: transparent;
    box-shadow: 0 0 0 1px #333 inset!important;
    color: #333;
    min-width: 72px;
}
.showbt .refund-box,.showcan .cancel-box {
    visibility: visible;
    -webkit-transform: translate3d(0,0,0);
    transform: translate3d(0,0,0);
}
.refund-box,.cancel-box{
    max-width: 767px;
    margin: 0 auto;
    background: #f5f5f5;
    position: fixed;
    width: 100%;
    height: 100%;
    bottom: 0;
    z-index: 100;
    visibility: hidden;
    -webkit-transform: translate3d(0,100%,0);
    transform: translate3d(0,100%,0);
    -webkit-transition: all 0.3s ease 0.05s;
    transition: all 0.3s ease 0.05s;
    padding: 0 !important;
}
.nextbtn {
    display: flex;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: -webkit-box;
    align-items: center;
    -webkit-box-align: center;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    z-index: 3;
}
.nextbtn .close-btn {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    -ms-flex: 1;
    flex: 1;
    -webkit-flex-basis: 0;
    -ms-flex-preferred-size: 0;
    flex-basis: 0;
    flex-grow: 1;
    font-size: 1rem;
    background: #fff;
    text-align: center;
    line-height: 2.1435rem;
    padding: 0.7145rem;
}
.nextbtn .submit {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    -ms-flex: 1;
    flex: 1;
    -webkit-flex-basis: 0;
    -ms-flex-preferred-size: 0;
    flex-basis: 0;
    flex-grow: 1;
    font-size: 1rem;
    background: #be8914;
    color: #fff;
    text-align: center;
    line-height: 2.1435rem;
    padding: 0.7145rem;
}
.refund_content,.cancel_content {
    display: none;
}
.refund-box .ui.header,.cancel-box .ui.header{
    font-weight: 400;
}
.ui.form select{
    appearance:none;
    -moz-appearance:none;
    -webkit-appearance:none;
    background: url("{{ app_url_packaged }}/images/fiushop/re-arrow.png") no-repeat scroll right center #fff;
    background-size: 15px 8px;
    background-position: 96% center;
}
.ui.form select::-ms-expand { display: none; }
.mb-7{
    margin-bottom: 7px !important;
}
.dealesc .ui.button.color-be,.dealesc .ui.button.color-be:hover{
    background: #000 !important;
    color: #fff;
    box-shadow: 0 0 0 1px #000 inset!important;
}
.sfooter.nav-menu{
    display: none;
}
.mtzz{
    font-size: 12px;
    border-top:1px solid rgba(0,0,0,0.1);
}
</style>
{% endblock %}

{% block jquery %}

  // 确认收货
	$('.take_delivery_btn').livequery(function(){
    $(this).click(function(){
      var rid = $(this).attr('rid');
      url = "{{ app_url_wap }}/app/site/my/ajax_take_over";
      $.post(url, {rid: rid, from_to: 2}, function(result){
        if(result.success){
          phenix.redirect(result.redirect_url);
        }else{
          phenix.show_error_note(result.message, 3000);  
        }
      }, 'json');
    });
  });

  // 取消订单
	$('.cancel_order_btn').livequery(function(){
    $(this).click(function(){
      var rid = $(this).attr('rid');
      var url = "{{ app_url_wap }}/app/site/my/ajax_disabled_order";
      $.post(url, {rid: rid, type:1}, function(result){
        if(result.success){
          window.location.reload();
          phenix.show_error_note('提交成功，正在为您取消订单', 3000);
        }else{
          phenix.show_error_note(result.message, 3000);          
        }
      }, 'json');
    });
  });

  // 删除订单
	$('.remove_order_btn').livequery(function(){
    $(this).click(function(){
      var rid = $(this).attr('rid');
      url = "{{ app_url_wap }}/app/site/my/ajax_remove_order";
      $.post(url, {rid: rid, type:1}, function(result){
        if(result.success){
        phenix.show_error_note('订单删除成功', 2000);
        setTimeout("window.location.href='{{ app_url_wap }}/my/orders'",2000);
        }else{
          phenix.show_error_note(result.message, 3000);  
        }
      }, 'json');
    });
  });

	$('.ui.medel.button').click(function(){
    $('.ui.server-show').modal('show');
  })

  // 申请退款
  $('.apply_refund').livequery(function(){
    $(this).bind('click',function(){
      $('.ordeshow').addClass('showbt');
    });
  });
  $('.close-btn').bind('click',function(){
    $('.ordeshow').removeClass('showbt showcan');
  });

  // 退款选项
  $('#refund_reason_select').change(function(){
    var refund_type = $(this).val();
    if(refund_type==0){
      $('.refund_content').show();
    }else{
      $('.refund_content').hide();
    }
  });

  // 申请退货
  $('.apply_cancel').livequery(function(){
    $(this).bind('click',function(){
      $('.ordeshow').addClass('showcan');
    });
  });

  // 退货选项
  $('#cancel_reason_select').change(function(){
    var cancel_type = $(this).val();
    if(cancel_type==0){
      $('.cancel_content').show();
    }else{
      $('.cancel_content').hide();
    }
  });

{% endblock %}

{% block content %}
<div class="ui fiushop pb-0">
    <div class="ui sheader">
        <a class="return" href="{{ back_url }}"><i class="angle float left icon"></i></a>
        <p>订单详情</p>
    </div>
</div>
<div class="ui responsive grid mt-0 ordeshow" style="padding-bottom: 50px;">
	<div class="row pt-0">
		<div class="column p-0">
			<div class="addressitem mb-2r">
				<div class="item">
					<div class="content">
						<i class="map marker icon"></i>
						
						{% if order_info.express_info %}
						<div class="addr ml-2r">
							<h5 class="ui header pt-r mb-2r">收货人：{{ order_info.express_info.name }}</h5>
							<span>{{ order_info.express_info.province }} {{ order_info.express_info.city }}{{ order_info.express_info.county }} {{ order_info.express_info.town }}</span>
							<span>  {{ order_info.express_info.address }}</span>
							<span>{{ order_info.express_info.phone }}</span>
						</div>
					{% else %}
						<div class="addr ml-2r">
							<h5 class="ui header pt-r mb-2r">收货人：{{ order_info.addbook.name }}</h5>
							<span>{{ order_info.addbook.area_province.city }} {{ order_info.addbook.area_district.city }}</span>
							<span> {{ order_info.addbook.address }}</span>
							<span>{{ order_info.addbook.phone }}</span>
						</div>	
					{% endif %}			
					 </div>
				</div>
			</div>

            <div class="desitem mtb-0">
                订单号：<span>{{ order_info.rid }}</span> <span class="flt-r color-be link">{{ order_info.status_label }}</span>
            </div>
			
            {% if !order_info.exist_sub_order %}
                {% for product in order_info.items %}
                    <div class="cartitem mtbb">
                        <a href="{{ product.wap_view_url }}" class="img"> <img class="lazy" src="{{ product.cover_url }}"></a>
                        <div class="cartinfo">
                            <a class="ui link" href="{{ product.wap_view_url }}"><h3 class="title">{{ product.name }}</h3></a>
                            
                            <p class="checkt">颜色／分类：{% if product.sku_name %}{{ product.sku_name }}{%else%}默认{%endif%}  &nbsp;&nbsp;数量＊{{ product.quantity }}</p>
                            <p class="price"><i class="rmb icon"></i>  {{ product.subtotal }}</p>
                        </div>
                        <div class="deal">
                          退款中
                        </div>
                    </div>

                    <div class="desitem mtb-0 tx-r dealesc">
                        <a href="javascript:void(0);" class="ui small color-bd inverted button apply_refund">退款</a>
                        <a href="javascript:void(0);" class="ui small color-bd inverted button apply_cancel">退货</a>
                    </div>

                {% endfor %}

                {% if order_info.status >= 15 %}
                    <div class="desitem mtb-0 detx">
                    承运来源：{{ order_info.express_company.title }} <text class="ml-3r">快递编号：{{ order_info.express_no }}</text>
                    </div>
                {% endif %}

                <div class="desitem mtb-0 tx-r detx">
                    共{{ product.quantity }}件商品   <text class="ml-r">合计：{{ product.subtotal }} (含运费¥6.00)</text>
                </div>

            {%else%}
                {% for d in order_info.sub_orders %}

                    <div class="desitem mtb-0 mtzz">
                        子订单号：<span>{{ d.id }}</span> 
                    </div>

                    {% for product in d.items %}
                        <div class="cartitem mtbb">
                            <a href="{{ product.wap_view_url }}" class="img"> <img class="lazy" src="{{ product.cover_url }}"></a>
                            <div class="cartinfo">
                                <a class="ui link" href="{{ product.wap_view_url }}"><h3 class="title">{{ product.name }}</h3></a>
                                
                                <p class="checkt">颜色／分类：{% if product.sku_name %}{{ product.sku_name }}{%else%}默认{%endif%}  &nbsp;&nbsp;数量＊{{ product.quantity }}</p>
                                <p class="price"><i class="rmb icon"></i>  {{ product.subtotal }}</p>
                            </div>
                            <div class="deal">
                              退款中
                            </div>
                        </div>
                        <!--
                        <div class="desitem mtb-0 tx-r detx">
                            共{{ product.quantity }}件商品   <text class="ml-r">合计：{{ product.subtotal }} (含运费¥6.00)</text>
                        </div>
                        -->
                        <div class="desitem mtb-0 tx-r dealesc">
                            <a href="javascript:void(0);" class="ui small color-bd inverted button apply_refund">退款</a>
                            <a href="javascript:void(0);" class="ui small color-bd inverted button apply_cancel">退货</a>
                        </div>
                    {% endfor %}

                    {% if d.is_sended %}
                        <div class="desitem mtb-0 detx">
                        承运来源：{{ d.express_company }} <text class="ml-3r">快递编号：{{ d.express_no }}</text>
                        </div>
                    {% endif %}

                {%endfor%}

            {%endif%}
			
			<!-- <div class="desitem">
				支付方式：<span class="flt-r">在线支付</span>
			</div> -->

      
		
		<div class="desitem mb-0 pb-r">
			运费：<span class="ui color-be text link flt-r">￥&nbsp;{{ order_info.freight }}</span>
		</div>
        <div class="desitem m-0 pt-0 pb-r">
            支付方式：<span class="ui color-be text link flt-r">在线支付</span>
        </div>
        <div class="desitem m-0 pt-0 pb-r">
            商品总额：<span class="ui color-be text link flt-r">￥&nbsp;{{ order_info.total_money }}</span>
        </div>
        <!-- <div class="desitem m-0 pt-0 pb-r">
            优惠：<span class="ui color-be text link flt-r">-￥&nbsp;{{ order_info.card_money }}</span>
        </div> -->
		<div class="desitem mt-0 pt-0">
			应付金额：<span class="ui color-be text link flt-r">￥&nbsp;{{ order_info.pay_money }}</span>
		</div>
    
        <div class="desitem">
            <div class="ui medel color button">
              <span class="kefu"></span>
              联系客服
            </div>
        </div>
      <!-- <div class="desitem descrit">
        <span>订单号：&nbsp;{{ order_info.rid }}</span>
        <span>创建时间：{{ order_info.created_on|date 'Y-m-d H:i' }}</span>
        {% if order_info.payed_date %}
            <span>付款时间：{{ order_info.payed_date|date 'Y-m-d H:i' }}</span>
        {%endif%}
        {% if order_info.sended_date %}
            <span>发货时间：{{ order_info.sended_date|date 'Y-m-d H:i' }}</span>
        {%endif%}
        {% if order_info.finished_date %}
            <span>成交时间：{{ order_info.finished_date|date 'Y-m-d H:i' }}</span>
        {%endif%}
      </div> -->
			
			<div class="ordertbtn dealesc">
        {% if order_info.status == '-1' %}
          <a href="javascript:void(0);" rid="{{ order_info.rid }}" class="ui color-bd small magenta inverted button remove_order_btn">删除订单</a>
        {%endif%}
        {% if order_info.status == 0 %}
          <a href="javascript:void(0);" rid="{{ order_info.rid }}" class="ui color-bd small inverted button remove_order_btn">删除订单</a>
        {%endif%}
        {% if order_info.status == 16 %}
          <a href="{{ app_url_wap }}/my/evaluate?rid={{ order.rid }}" rid="{{ order_info.rid }}" class="ui small magenta inverted button">评价</a>
        {%endif%}
        {% if order_info.status == 20 %}
          <a href="javascript:void(0);" rid="{{ order_info.rid }}" class="ui color-bd small inverted button remove_order_btn">删除订单</a>
        {%endif%}
				{% if order_info.status == 1 %}
        <a href="javascript:void(0);" class="ui color-bd small gray inverted button cancel_order_btn" rid="{{ order_info.rid }}">取消订单</a>
        <a href="{{ app_url_wap }}/shop/success?rid={{ order_info.rid }}" class="ui color-be small inverted button">立即支付</a>
				{% endif %}
				{% if order_info.status == 15 %}
        <a href="javascript:void(0);" class="ui color-be small ajax inverted button take_delivery_btn" rid="{{ order_info.rid }}">确认收货</a>
				{% endif %}
			</div>
			
				
		</div>	
	</div>


    <div class="refund-box">
        <div class="ui fiushop pb-0">
            <div class="ui sheader">
                <a class="return close-btn" href="javascript:void(0);"><i class="angle float left icon"></i></a>
                <p>退款</p>
            </div>
        </div>
        <div class="ui grid m-0 plr-2r">
            <div class="row pt-3r">
                <div class="column">
                    <form action="{{ app_url_wap }}/app/site/my/ajax_apply_refund" class="ui form" method="post" id="refund-form">
                        <div class="field mb-3r">
                            <h5 class="ui header mb-7">退款金额</h5>
                            <input type="text" name="name" value="123">
                        </div>
                        <div class="field mb-3r">
                            <h5 class="ui header mb-7">退款原因</h5>
                            <select name="refund_reason" value="0" id="refund_reason_select" class="refundwhy">
                                <option value="1">我不想要了</option>
                                <option value="0">其他</option>
                            </select>
                        </div>
                        <div class="field mb-3r refund_content">
                            <h5 class="ui header mb-7">退款说明</h5>
                            <textarea name="refund_content" rows="3"></textarea>
                        </div>
                        <div class="nextbtn">
                            <div class="close-btn">
                              取消
                            </div>  
                            <div class="submit">
                              提交
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="cancel-box">
        <div class="ui fiushop pb-0">
            <div class="ui sheader">
                <a class="return close-btn" href="javascript:void(0);"><i class="angle float left icon"></i></a>
                <p>退货</p>
            </div>
        </div>
        <div class="ui grid m-0 plr-2r">
            <div class="row pt-3r">
                <div class="column">
                    <form action="{{ app_url_wap }}/app/site/my/ajax_apply_refund" class="ui form" method="post" id="cancel-form">
                        <div class="field mb-3r">
                            <h5 class="ui header mb-7">退货金额</h5>
                            <input type="text" name="name" value="123">
                        </div>
                        <div class="field mb-3r">
                            <h5 class="ui header mb-7">退货原因</h5>
                            <select name="cancel_reason" value="0" id="cancel_reason_select" class="refundwhy">
                                <option value="1">收到商品破损</option>
                                <option value="2">商品错发／漏发</option>
                                <option value="3">商品需要维修</option>
                                <option value="4">收到商品与描述不符</option>
                                <option value="5">商品质量问题</option>
                                <option value="0">其他</option>
                            </select>
                        </div>
                        <div class="field mb-3r cancel_content">
                            <h5 class="ui header mb-7">退货说明</h5>
                            <textarea name="cancel_content" rows="3"></textarea>
                        </div>
                        <div class="nextbtn">
                            <div class="close-btn">
                              取消
                            </div>  
                            <div class="submit">
                              提交
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>


<div class="ui small server-show modal">
  <i class="close icon"></i>
  <div class="content">
    <div class="ui center aligned grid">
      <div class="row">
        <div class="column">
          <p style="line-height: 24px;font-size: 17px;">客服电话<br>4008-798-751</p>
          <p class="mb-0">长按识别二维码 直接呼叫客服</p>
          <img src="{{ app_url_packaged }}/images/icon/servess.jpg" width="80%" />
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
