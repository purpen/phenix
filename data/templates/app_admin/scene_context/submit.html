{%extends 'layout/app_admin.html'%}
{% block title %}新增/编辑语境-{% endblock %}

{% block jquery %}
	
	// 表单验证
	$('#active-form').form({
		title: {
			identifier  : 'title',
			rules: [
				{
					type   : 'empty',
					prompt : '名称不能为空'
				}
			]
		},
		des: {
			identifier  : 'des',
			rules: [
				{
					type   : 'empty',
					prompt : '语境详情不能为空'
				}
			]
		}
	}, {
		inline : true,
		onSuccess: function(event){
			event.preventDefault();
			$(this).ajaxSubmit({
				dataType: 'json',
				beforeSubmit: function(){
					// 点击前触发的事件
					//phenix.before_submit();
				},
				success: function(data){
					// 点击后触发的事件
					//phenix.after_submit();
					if(data.is_error){
						$(event.target).addClass('error');
						phenix.show_error_note(data.message, 3000);
					}else{
						phenix.redirect(data.redirect_url);
					}
				}
			});
		}
	});
	
	// 选择分类
	$('.ui.options').on('click', '.option', function(){
		var id = $(this).attr('data-value');
		if ($(this).hasClass('active')){
			$(this)
				.removeClass('active');
			$('#topic-category').val('');
		}else{
			$(this)
				.siblings('.ui.option').removeClass('active')
				.end()
				.addClass('active');
			$('#scene_context_category').val(id);
		}
	});

{% endblock %}

{% block content %}
<div class="admin">
	
	<h3 class="ui header">语境管理</h3>
	<div class="ui secondary pointing magenta menu">
		<a href="{{ app_url_app_admin_base }}/scene_context" class="item">
			全部
		</a>
	  	<div class="right menu">	
			<a href="{{ app_url_app_admin_base }}/scene_context/add" class="item">
				<i class="add icon"></i>新增语境
			</a>
			<!--
            <a href="javascript:void(0);" class="item ajax-delete">
				<i class="remove icon"></i>批量删除
			</a>
			-->
	    </div>
	</div>	
	
	<form action="{{ app_url_app_admin_base }}/scene_context/save" class="ui form" method="post" id="active-form">
		<!-- 隐藏表单 -->
		<input type="hidden" name="id" value="{{ date._id }}" />
		
		<div class="ui segment from">
			<h3 class="ui dividing header">填写语境信息</h3>
            <div class="field">
                <label>语境名称</label>
				<input type="text" name="title" placeholder="品牌名称" value="{{ date.title }}" />
			</div>
			<div class="field">
				<label>语境分类</label>
				<div class="ui options">
						<input type="hidden" name="category_id" value="{{ date.category_id }}" id="scene_context_category" />
						{% category_list var:'category' only_open:1 domain:9 %}
						{% for cat in category.rows %}
							<div class="ui magenta alt option left {% if date.category_id == cat._id %} active {%endif%}" data-value="{{ cat._id }}">
								<i class="check circle outline icon"></i>
								{{ cat.title }}
							</div>
						{% endfor %}			
					 </div>			
			</div>
            <div class="field">
                <label>语境详情</label>
                <textarea name="des" placeholder="语境详情">{{ date.des }}</textarea>
            </div>
			
			<div class="ui right aligned grid">
				<div class="column">
                    <div class="ui inverted grey button cancel">
						点击取消
					</div>
					<div class="ui magenta inverted button submit save">
						确认提交
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
{% endblock %}
