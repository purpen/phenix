{%extends 'layout/admin.html'%}
{% block page_css %}
{% endblock %}

{% block jquery %}
	// 发布上架
	$('.item.publish-onsale').bind('click', function(){
		var selected_ids = [];
		
		$('input.checkbox:checked').each(function(){
			var v = $(this).val();
			selected_ids.push(v);
		});
		
		if (!selected_ids.length){
			alert('请选择发布产品');
		}
		
		var url = $(this).attr('href');
		$.get(url, {id: selected_ids.join(',')});
		
		return false;
	});
	
	// 删除产品
	$('.item.ajax-delete').bind('click', function(){
		var selected_ids = [];
		
		$('input.checkbox:checked').each(function(){
			var v = $(this).val();
			selected_ids.push(v);
		});
		
		if (!selected_ids.length){
			alert('请选择想删除的产品');
		}
		
		var url = $(this).attr('href');
		$.get(url, {id: selected_ids.join(',')});
		
		return false;
	});
	
{% endblock %}
	
{% block content %}
	<h3 class="ui header">订单管理</h3>
	
	<div class="ui secondary pointing magenta menu">
		<a href="{{ app_url_admin_base }}/orders" class="{% if !s %}active{%endif%} item">
			全部
		</a>
		<a href="{{ app_url_admin_base }}/orders?s=1" class="{% if s == 1 %}active{%endif%} item">
			未支付
		</a>
		<a href="{{ app_url_admin_base }}/orders?s=2" class="{% if s == 2 %}active{%endif%} item">
			待发货
		</a>
		<a href="{{ app_url_admin_base }}/orders?s=3" class="{% if s == 3 %}active{%endif%} item">
			已发货
		</a>
		<a href="{{ app_url_admin_base }}/orders?s=4" class="{% if s == 4 %}active{%endif%} item">
			已完成
		</a>
	  	
	</div>
	
	<div class="ui sub nav">
		<form action="{{ app_url_admin_base }}/orders" method="post">
			<label>搜索：</label>
			<div class="ui icon input">
				<input placeholder="Search..." type="text" name="q">
				<i class="search icon"></i>
			</div>
		</form>
	</div>
	
	{% order_list var:'list' user_id:user_id status:s size:10 %}
	
	{% for order in list.rows %}
	<div class="ui top attached header">
		<div class="ui horizontal bulleted list">
		  	<div class="item">
		      	订单号：{{ order.rid }}
		  	</div>
		  	<div class="item">
				{% if order.from_site == 5 %}
					{{ order.express_info.name }} 
				{% else %}
		      		{{ order.addbook.name|default '太火鸟用户'}} 
				{% endif %}
		  	</div>
		  	<div class="item">
		      	下单时间：{{ order.created_on|date }}
		  	</div>
		</div>
	</div>
	<div class="middle aligned ui celled white grid">
		<div class="row">
			<div class="seven wide column">
				<table class="ui basic table">
					<tbody>
						{% for item in order.items %}
						{% product_list var:'product' product_id:item.product_id %}
						<tr>
							<td>
								<a href="{{ product.view_url }}" class="ui cover image" target="_blank">
						      		<img src="{{ product.cover.thumbnails.mini.view_url }}" alt="{{ product.title }}" />
								</a>
							</td>
							<td>
						      	<div class="content">
						          	<div class="header">
										<a href="{{ product.view_url }}" class="ui link">{{ product.title }}</a>
									</div>
						          	<p class="attribute">编号：{{ item.sku }}</p>
						      	</div>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="center aligned three wide column">
				<p>
					订单金额：{{ order.pay_money }} 元
				</p>
				<p>
					<small>（运费：{{ order.freight }} 元）</small>
				</p>
				<p>
					{{ order.payment.name }}
				</p>
			</div>
			<div class="center aligned three wide column">
				<p>
					{% if order.status == 1 %}
					<label class="ui orange label">{{ order.status_label }}</label>
					{% endif %}
					
					{% if order.status == 10 %}
					<label class="ui blue label">{{ order.status_label }}</label>
					{% endif %}
					
					{% if order.status == 15 %}
					<label class="ui magenta label">{{ order.status_label }}</label>
					{% endif %}
					
					{% if order.status == 20 %}
					<label class="ui green label">{{ order.status_label }}</label>
					{% endif %}
				</p>
			</div>
			<div class="center aligned three wide column">
				<p>
					<a href="{{ app_url_admin_base }}/orders/show?rid={{ order.rid }}" class="ui link">订单详情 »</a>
				</p>
				
				{% if order.status < 5 %}
				<a href="" class="ui small gray button">关闭</a>
				{% endif %}
			</div>
		</div>
	</div>
	{% else %}
	<div class="ui center aligned segment">
		<p>没有相关订单</p>
	</div>
	{% endfor %}
	
	{% if list.rows %}
	<div class="ui pagination">
		{% pager url:pager_url,total_rows:list.total_rows,total_page:list.total_page,current_page:page,var:'pager',pager_size:9 %}
		{% include 'block/pager.html' %}
	</div>
	{% endif %}
	
{% endblock %}