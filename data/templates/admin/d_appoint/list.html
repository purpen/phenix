{%extends 'layout/admin.html'%}
{% block page_css %}
{% endblock %}

{% block content %}
	<h3 class="ui header">预约管理</h3>
	
	<div class="ui secondary pointing magenta menu">
		<a href="{{ app_url_admin_base }}/d_appoint" class="{{ css_all }} item">
			全部
		</a>
		<a href="{{ app_url_admin_base }}/d_appoint?state=1" class="{{ css_ing }} item">
			进行中
		</a>
		<a href="{{ app_url_admin_base }}/d_appoint?state=2" class="{{ css_over }} item">
			结束
		</a>
		<a href="{{ app_url_admin_base }}/d_appoint?state=-1" class="{{ css_close }} item">
			关闭
		</a>

	</div>
	
  <!--
	<div class="ui grid">
		<div class="middle aligned row">

			<div class="ten wide column">
				<div class="ui sub nav">
					<form action="{{ app_url_admin_base }}/d_appoint" method="post">
						<label>搜索：</label>
						<div class="ui icon input">
							<input placeholder="标题..." type="text" name="q">
							<i class="flat search link icon"></i>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
  -->
	
			{% d_appoint_list var:'list' load_item:1 state:state size:30 %}
			
			{% for d in list.rows %}

            <div id="order-{{ d._id }}" class="order-item">
              <div class="ui top attached header">
                <div class="ui horizontal bulleted list">
                    <div class="item">
                        预约号：{{ d.number }}
                    </div>
                    <div class="item">
                      {{ d.user.nickname }} 
                    </div>
                    <div class="item">
                        预约时间：{{ d.created_on|date }}
                    </div>
                    {% if admin %}
                      <div class="item">
                          来源: {{ order.from_site_label }}
                      </div>

                    {%endif%}
                </div>
              </div>
              <div class="middle aligned ui celled white grid">
                <div class="row">
                  <div class="seven wide column">
                    <table class="ui basic table">
                      <tbody>
                        {% for i in d.items %}
                        <tr>
                          <td>
                                <div class="content">
                                    <div class="header">
                                {{ i.item_name }}
                              </div>
                                    <p class="attribute">ID：{{ i.item_id }}</p>
                                </div>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <div class="center aligned three wide column">
                    <p>
                      订单金额：{{ order.pay_money }} 元
                    </p>
                    <p>
                      <small>（运费：{{ order.freight }} 元）</small>
                    </p>
                      {% if admin %}
                              
                        {% if order.card_code %}
                          <p>红包码: {{ order.card_code }}</p>
                        {%endif%}
                        {% if order.gift_code %}
                          <p>礼品券: {{ order.gift_code }}</p>
                        {%endif%}
                        {% if order.bird_coin_count %}
                          <p>鸟币: {{ order.bird_coin_count }}</p>
                        {%endif%}
                            
                      {% endif %}
                  </div>
                  <div class="center aligned three wide column">
                    <div id="order-{{ order.rid }}-label" class="status-label">
                      {{ order.status_label }}
                    </div>
                            {% if my %}
                              {% if order.status == 1 %}
                              <a href="{{ app_url_shopping }}/success?rid={{ order.rid }}" class="ui small inverted magenta button">立即支付</a>
                              {% endif %}

                            {% endif %}

                            {% if admin %}
                              {% if order.status == 12 %}
                                <div>理由: {{ order.refund_reason }}</div>
                              {% endif %}
                            {% endif %}
                  </div>
                  <div class="center aligned three wide column">
                    {% if my %}
                      <p>
                        <a href="{{ order.view_url }}" class="ui line">订单详情 »</a>
                      </p>
                      {% if order.status == 1 %}
                      <a href="{{ app_url_my }}/ajax_cancel_order?rid={{ order.rid }}" class="ui small inverted gray ajax button">取消订单</a>
                      {% endif %}
                      {% if order.status == 10 %}
                      <a href="javascript:void(0);" class="ui small gray inverted button" name="apply-refund" rid="{{ order.rid }}">申请退款</a>
                      {% endif %}

                                {% if order.status == 20 %}
                        <a href="{{ app_url_my }}/evaluate?rid={{ order.rid }}" class="ui magenta line">售后评价 »</a>
                      {% endif %}
                    {% endif %}
                    
                    {% if admin %}
                      <p>
                        <a href="{{ app_url_admin }}/orders/show?rid={{ order.rid }}" class="ui line">订单详情 »</a>
                      </p>
                      {% if order.status == 1 %}
                      <a href="{{ app_url_admin }}/orders/ajax_close_order?rid={{ order.rid }}" class="ui small gray ajax button">关闭</a>
                      {% endif %}
                      {% if order.status == 12 %}
                      <a href="javascript:void(0);" class="ui small gray inverted button" name="confirm-refund" rid="{{ order.rid }}" pay_money="{{ order.pay_money }}" user_id="{{ order.user_id }}" >确认退款</a>
                      {% endif %}
                    {% endif %}
                    
                  </div>
                </div>
              </div>
            </div>

			{% endfor %}

	
	{% if list.total_rows %}
	<div class="ui pagination">
		{% pager url:pager_url,total_rows:list.total_rows,total_page:list.total_page,current_page:page, var:'pager',pager_size:9 %}
		{%include 'block/pager.html'%}
		<label class="page_count">{{ list.total_rows }}个</label>
	</div>
	{% endif %}
	
{% endblock %}
