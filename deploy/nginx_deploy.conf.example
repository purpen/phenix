server {
        listen       80;
        #edit this!
        server_name  www.taihuoniao.com taihuoniao.com;
        charset utf-8;
        index  app;
        root /www/phenix/web;
		
        location  /app {
            fastcgi_split_path_info ^(/app)(.*)$;
            fastcgi_intercept_errors on;
            include fastcgi_params;
        }
		
        location /topic {
          rewrite ^/topic[/]?$ /app/site/topic last;
          rewrite ^/topic/c(\d+)[/]?$ /app/site/topic?category_id=$1 last;
          rewrite ^/topic/c(\d+)/(\w+)[/]?$ /app/site/topic?category_id=$1&type=$2 last;
		  rewrite ^/topic/list-c(\d+)-t(\d+)-d(\d+)-t(\d)-p(\d+).*$ /app/site/topic?category_id=$1&type=$2&time=$3&sort=$4&page=$5 last;
          rewrite ^/topic/c(\d+)/(\w+)/p(\d+).*$ /app/site/topic?category_id=$1&type=$2&page=$3 last;
		  rewrite ^/topic/view-(\d+).html$ /app/site/topic/view?id=$1 last;
          rewrite ^/topic/view-(\d+)-(\d+).html$ /app/site/topic/view?id=$1&page=$2 last;
          rewrite ^/topic(.*)$ /app/site/topic$1 last;
        }
		
		location /search {
	        rewrite ^/search[/]?$ /app/site/search last;
	        rewrite ^/search/([^/]+)[/]?$ /app/site/search?q=$1 last;
	        rewrite ^/search/([^/]+)/p(\d+).html$ /app/site/search?q=$1&page=$2 last;
	    }

	    location /tag {
	        rewrite /tag(\/*)$ /tags/ last;
	        rewrite /tag/([^/]+)/p(\d+)/([a-zA-Z_]+)[/]?$ /app/site/search/tag?q=$1&page=$2&sort=$3 last;
	        rewrite /tag/([^/]+)[/]?$ /app/site/search/tag?q=$1 last;
	    }
		
		location /my {
	        rewrite ^/my/like/p(\d+).*$ /app/site/my/like?page=$1 last;
			rewrite ^/my/love/p(\d+).*$ /app/site/my/love?page=$1 last;
			rewrite ^/my/fans/p(\d+).*$ /app/site/my/fans?page=$1 last;
			rewrite ^/my/comment/p(\d+).*$ /app/site/my/comment?page=$1 last;
			rewrite ^/my/follow/p(\d+).*$ /app/site/my/follow?page=$1 last;
	        rewrite ^/my(.*)$ /app/site/my$1 last;
	    }

	    location /user {
		  rewrite ^/user/(\d+)[/]?$ /app/site/user?user_id=$1 last;
	      rewrite ^/user/(\d+)/like[/]?$ /app/site/user/like?user_id=$1 last;
	      rewrite ^/user/(\d+)/like/p(\d+).*$ /app/site/user/like?user_id=$1&page=$2 last;
		  rewrite ^/user/(\d+)/follow[/]?$ /app/site/user/follow?user_id=$1 last;
	      rewrite ^/user/(\d+)/follow/p(\d+).*$ /app/site/user/follow?user_id=$1&page=$2 last;
	      rewrite ^/user/(\d+)/fans[/]?$ /app/site/user/fans?user_id=$1 last;
	      rewrite ^/user/(\d+)/fans/p(\d+).*$ /app/site/user/fans?user_id=$1&page=$2 last;
	    }

		location /js {
	        expires 30d;
	        rewrite ^/js/bundle_(.*)_jquery.js$ /js/bundle.jquery.js last;
	        rewrite ^/js/bundle_(.*)_lgk.js$ /js/bundle.lgk.js last;
	    }
	    location /css {
	        rewrite ^/css/bundle_(.*)_common.css$ /css/bundle.common.css last;
	    }
		
	    location /images {
	        expires 30d;
	    }
	
		location /about {
	        rewrite ^/about[/]?$ /app/site/index/about last;
	    }
		
		location /contact {
	        rewrite ^/contact[/]?$ /app/site/index/contact last;
	    }
		
	    location /__file_result__/ {
	        internal;
	        alias /;
	    }
}

server {
    listen       80;
    server_name  img.taihuoniao.com;
	charset utf-8;
	index  index.html;
	root /data/uploads;
	
    access_log  off;
	
    client_max_body_size 60m;
    
	expires 30d;
}
